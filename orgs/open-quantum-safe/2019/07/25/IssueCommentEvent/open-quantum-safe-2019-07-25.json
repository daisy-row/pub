{"id":"10083161219","type":"IssueCommentEvent","actor":{"id":8843219,"login":"dstebila","display_login":"dstebila","gravatar_id":"","url":"https://api.github.com/users/dstebila","avatar_url":"https://avatars.githubusercontent.com/u/8843219?"},"repo":{"id":66578799,"name":"open-quantum-safe/openssl","url":"https://api.github.com/repos/open-quantum-safe/openssl"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103","repository_url":"https://api.github.com/repos/open-quantum-safe/openssl","labels_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103/comments","events_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103/events","html_url":"https://github.com/open-quantum-safe/openssl/issues/103","id":472766958,"node_id":"MDU6SXNzdWU0NzI3NjY5NTg=","number":103,"title":"Failing to compile NGINX with PQ openssl fork","user":{"login":"RicardoGaGu","id":25283073,"node_id":"MDQ6VXNlcjI1MjgzMDcz","avatar_url":"https://avatars3.githubusercontent.com/u/25283073?v=4","gravatar_id":"","url":"https://api.github.com/users/RicardoGaGu","html_url":"https://github.com/RicardoGaGu","followers_url":"https://api.github.com/users/RicardoGaGu/followers","following_url":"https://api.github.com/users/RicardoGaGu/following{/other_user}","gists_url":"https://api.github.com/users/RicardoGaGu/gists{/gist_id}","starred_url":"https://api.github.com/users/RicardoGaGu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RicardoGaGu/subscriptions","organizations_url":"https://api.github.com/users/RicardoGaGu/orgs","repos_url":"https://api.github.com/users/RicardoGaGu/repos","events_url":"https://api.github.com/users/RicardoGaGu/events{/privacy}","received_events_url":"https://api.github.com/users/RicardoGaGu/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2019-07-25T09:42:07Z","updated_at":"2019-07-25T13:05:17Z","closed_at":null,"author_association":"NONE","body":"HI! I'm trying to compile the PQ OpenSSL fork into NGINX, I've run into some problems when building nginx wirth openssl underneath. I'll show my Dockerfile to clarify my procedure for installing Nginx. I have tested the TLS demo and works fine, but when configuring Nginx on Ubuntu 18.04 it fails. I kindly ask if anyone know how to solve this problem.\r\n\r\n```\r\nFROM ubuntu:18.04\r\n\r\n### Building NGINX from source with post quantum openssl for TLS connections\r\nRUN apt update && apt upgrade -y\r\nRUN apt install wget autoconf automake libtool libssl-dev make unzip xsltproc git -y\r\nRUN apt install build-essential -y\r\n\r\n### Step 1: Build required libraries: pcre, zlib and quantum safe openssl\r\n\r\n### PCRE\r\nRUN wget ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.42.tar.gz && \\\r\n tar -zxf pcre-8.42.tar.gz && \\\r\n cd pcre-8.42 && \\\r\n ./configure && \\\r\n make && \\\r\n make install\r\n### ZLIB\r\nRUN wget http://zlib.net/zlib-1.2.11.tar.gz && \\\r\n tar -zxf zlib-1.2.11.tar.gz && \\\r\n cd zlib-1.2.11 && \\\r\n ./configure && \\\r\n make && \\\r\n make install\r\n\r\n\r\n### Install liboqs\r\nWORKDIR /usr/local/\r\n\r\nRUN git clone --branch OQS-OpenSSL_1_1_1-stable https://github.com/open-quantum-safe/openssl.git\r\n\r\nRUN git clone --branch master https://github.com/open-quantum-safe/liboqs.git\r\n\r\nWORKDIR /usr/local/liboqs\r\nRUN autoreconf -i\r\nRUN ./configure --prefix=/usr/local/openssl/oqs --enable-shared=no\r\nRUN make -j\r\nRUN make install\r\n\r\n### Install openssl\r\nWORKDIR /usr/local/openssl\r\nRUN ./config --prefix=/usr/local/openssl -Wl,-rpath -Wl,/usr/local/openssl/oqs/lib\r\nRUN make -j\r\n\r\nRUN cp libcrypto.so.1.1 ./oqs/lib\r\nRUN cp libssl.so.1.1 ./oqs/lib\r\n\r\nWORKDIR /\r\n\r\n### Step 2: Download NGINX and RTMP module\r\nRUN wget https://nginx.org/download/nginx-1.15.11.tar.gz && \\\r\n tar zxf nginx-1.15.11.tar.gz\r\n\r\nRUN wget https://github.com/arut/nginx-rtmp-module/archive/master.zip && \\\r\n unzip master.zip\r\n\r\nRUN rm -rf *.tar.gz\r\n\r\n### Step 3: Build and install NGINX\r\nRUN wget https://nginx.org/download/nginx-1.15.11.tar.gz && \\\r\n tar zxf nginx-1.15.11.tar.gz\r\n\r\nRUN   cd nginx-1.15.11 && ./configure \\\r\n--with-cc-opt=\"-I /usr/local/openssl/oqs/include/\" \\\r\n--with-ld-opt=\"-L /usr/local/openssl/oqs/lib/\"\\\r\n--sbin-path=/usr/local/nginx/nginx \\\r\n--conf-path=/usr/local/nginx/nginx.conf \\\r\n--pid-path=/usr/local/nginx/nginx.pid \\\r\n--with-pcre=../pcre-8.42 \\\r\n--with-zlib=../zlib-1.2.11 \\\r\n--with-openssl=/usr/local/openssl \\\r\n--with-http_ssl_module \\\r\n--with-stream \\\r\n--with-mail=dynamic \\\r\n--add-module=/nginx-rtmp-module-master && \\\r\nmake && \\\r\nmake install\r\n```\r\n\r\nThe error is the following:\r\n\r\n/usr/local/openssl/.openssl/lib/libssl.a(s3_lib.o): In function `ssl3_clear':\r\ns3_lib.c:(.text+0x51b): undefined reference to `OQS_KEM_free'\r\n/usr/local/openssl/.openssl/lib/libssl.a(extensions_clnt.o): In function `tls_construct_ctos_key_share':\r\nextensions_clnt.c:(.text+0x18af): undefined reference to `OQS_KEM_new'\r\nextensions_clnt.c:(.text+0x1952): undefined reference to `OQS_KEM_keypair'\r\nextensions_clnt.c:(.text+0x199c): undefined reference to `OQS_MEM_secure_free'\r\nextensions_clnt.c:(.text+0x19a4): undefined reference to `OQS_MEM_insecure_free'\r\nextensions_clnt.c:(.text+0x19c2): undefined reference to `OQS_KEM_free'\r\n/usr/local/openssl/.openssl/lib/libssl.a(extensions_clnt.o): In function `tls_parse_stoc_key_share':\r\nextensions_clnt.c:(.text+0x3c96): undefined reference to `OQS_MEM_secure_free'\r\nextensions_clnt.c:(.text+0x3cb4): undefined reference to `OQS_MEM_secure_free'\r\nextensions_clnt.c:(.text+0x3cd2): undefined reference to `OQS_KEM_free'\r\nextensions_clnt.c:(.text+0x3d77): undefined reference to `OQS_KEM_decaps'\r\n/usr/local/openssl/.openssl/lib/libssl.a(extensions_srvr.o): In function `tls_construct_stoc_key_share':\r\nextensions_srvr.c:(.text+0x3769): undefined reference to `OQS_KEM_new'\r\nextensions_srvr.c:(.text+0x37be): undefined reference to `OQS_KEM_encaps'\r\nextensions_srvr.c:(.text+0x3906): undefined reference to `OQS_MEM_secure_free'\r\nextensions_srvr.c:(.text+0x390e): undefined reference to `OQS_KEM_free'\r\nextensions_srvr.c:(.text+0x3aeb): undefined reference to `OQS_MEM_secure_free'\r\nextensions_srvr.c:(.text+0x3af3): undefined reference to `OQS_KEM_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `pkey_oqs_digestverify':\r\noqs_meth.c:(.text+0x101): undefined reference to `OQS_SIG_verify'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `pkey_oqs_digestsign':\r\noqs_meth.c:(.text+0x62f): undefined reference to `OQS_SIG_sign'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_free':\r\noqs_meth.c:(.text+0x1d0e): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_key_init':\r\noqs_meth.c:(.text+0x1df9): undefined reference to `OQS_SIG_new'\r\noqs_meth.c:(.text+0x1f30): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_priv_decode':\r\noqs_meth.c:(.text+0x22f6): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `pkey_oqs_keygen':\r\noqs_meth.c:(.text+0x2528): undefined reference to `OQS_SIG_new'\r\noqs_meth.c:(.text+0x273c): undefined reference to `OQS_SIG_keypair'\r\noqs_meth.c:(.text+0x2778): undefined reference to `OQS_SIG_free'\r\noqs_meth.c:(.text+0x2810): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_pub_decode':\r\noqs_meth.c:(.text+0x2b6a): undefined reference to `OQS_SIG_free'\r\ncollect2: error: ld returned 1 exit status\r\nobjs/Makefile:323: recipe for target 'objs/nginx' failed\r\nmake[1]: Leaving directory '/nginx-1.15.11'\r\nmake[1]: *** [objs/nginx] Error 1\r\nMakefile:8: recipe for target 'build' failed\r\nmake: *** [build] Error 2\r\n\r\n\r\nThanks!"},"comment":{"url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/comments/515035047","html_url":"https://github.com/open-quantum-safe/openssl/issues/103#issuecomment-515035047","issue_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103","id":515035047,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNTAzNTA0Nw==","user":{"login":"dstebila","id":8843219,"node_id":"MDQ6VXNlcjg4NDMyMTk=","avatar_url":"https://avatars0.githubusercontent.com/u/8843219?v=4","gravatar_id":"","url":"https://api.github.com/users/dstebila","html_url":"https://github.com/dstebila","followers_url":"https://api.github.com/users/dstebila/followers","following_url":"https://api.github.com/users/dstebila/following{/other_user}","gists_url":"https://api.github.com/users/dstebila/gists{/gist_id}","starred_url":"https://api.github.com/users/dstebila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dstebila/subscriptions","organizations_url":"https://api.github.com/users/dstebila/orgs","repos_url":"https://api.github.com/users/dstebila/repos","events_url":"https://api.github.com/users/dstebila/events{/privacy}","received_events_url":"https://api.github.com/users/dstebila/received_events","type":"User","site_admin":false},"created_at":"2019-07-25T13:05:17Z","updated_at":"2019-07-25T13:05:17Z","author_association":"MEMBER","body":"Hi @RicardoGaGu, we haven't got build instructions for nginx (but probably should).  It looks to me like the nginx build system isn't being directed to link against liboqs.  Can you try adding `-loqs` somewhere, for example added on to the `--with-ld-opt` argument?"}},"public":true,"created_at":"2019-07-25T13:05:17Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
{"id":"10083545901","type":"IssueCommentEvent","actor":{"id":25283073,"login":"RicardoGaGu","display_login":"RicardoGaGu","gravatar_id":"","url":"https://api.github.com/users/RicardoGaGu","avatar_url":"https://avatars.githubusercontent.com/u/25283073?"},"repo":{"id":66578799,"name":"open-quantum-safe/openssl","url":"https://api.github.com/repos/open-quantum-safe/openssl"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103","repository_url":"https://api.github.com/repos/open-quantum-safe/openssl","labels_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103/comments","events_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103/events","html_url":"https://github.com/open-quantum-safe/openssl/issues/103","id":472766958,"node_id":"MDU6SXNzdWU0NzI3NjY5NTg=","number":103,"title":"Failing to compile NGINX with PQ openssl fork","user":{"login":"RicardoGaGu","id":25283073,"node_id":"MDQ6VXNlcjI1MjgzMDcz","avatar_url":"https://avatars3.githubusercontent.com/u/25283073?v=4","gravatar_id":"","url":"https://api.github.com/users/RicardoGaGu","html_url":"https://github.com/RicardoGaGu","followers_url":"https://api.github.com/users/RicardoGaGu/followers","following_url":"https://api.github.com/users/RicardoGaGu/following{/other_user}","gists_url":"https://api.github.com/users/RicardoGaGu/gists{/gist_id}","starred_url":"https://api.github.com/users/RicardoGaGu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RicardoGaGu/subscriptions","organizations_url":"https://api.github.com/users/RicardoGaGu/orgs","repos_url":"https://api.github.com/users/RicardoGaGu/repos","events_url":"https://api.github.com/users/RicardoGaGu/events{/privacy}","received_events_url":"https://api.github.com/users/RicardoGaGu/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-07-25T09:42:07Z","updated_at":"2019-07-25T13:54:02Z","closed_at":null,"author_association":"NONE","body":"HI! I'm trying to compile the PQ OpenSSL fork into NGINX, I've run into some problems when building nginx wirth openssl underneath. I'll show my Dockerfile to clarify my procedure for installing Nginx. I have tested the TLS demo and works fine, but when configuring Nginx on Ubuntu 18.04 it fails. I kindly ask if anyone know how to solve this problem.\r\n\r\n```\r\nFROM ubuntu:18.04\r\n\r\n### Building NGINX from source with post quantum openssl for TLS connections\r\nRUN apt update && apt upgrade -y\r\nRUN apt install wget autoconf automake libtool libssl-dev make unzip xsltproc git -y\r\nRUN apt install build-essential -y\r\n\r\n### Step 1: Build required libraries: pcre, zlib and quantum safe openssl\r\n\r\n### PCRE\r\nRUN wget ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.42.tar.gz && \\\r\n tar -zxf pcre-8.42.tar.gz && \\\r\n cd pcre-8.42 && \\\r\n ./configure && \\\r\n make && \\\r\n make install\r\n### ZLIB\r\nRUN wget http://zlib.net/zlib-1.2.11.tar.gz && \\\r\n tar -zxf zlib-1.2.11.tar.gz && \\\r\n cd zlib-1.2.11 && \\\r\n ./configure && \\\r\n make && \\\r\n make install\r\n\r\n\r\n### Install liboqs\r\nWORKDIR /usr/local/\r\n\r\nRUN git clone --branch OQS-OpenSSL_1_1_1-stable https://github.com/open-quantum-safe/openssl.git\r\n\r\nRUN git clone --branch master https://github.com/open-quantum-safe/liboqs.git\r\n\r\nWORKDIR /usr/local/liboqs\r\nRUN autoreconf -i\r\nRUN ./configure --prefix=/usr/local/openssl/oqs --enable-shared=no\r\nRUN make -j\r\nRUN make install\r\n\r\n### Install openssl\r\nWORKDIR /usr/local/openssl\r\nRUN ./config --prefix=/usr/local/openssl -Wl,-rpath -Wl,/usr/local/openssl/oqs/lib\r\nRUN make -j\r\n\r\nRUN cp libcrypto.so.1.1 ./oqs/lib\r\nRUN cp libssl.so.1.1 ./oqs/lib\r\n\r\nWORKDIR /\r\n\r\n### Step 2: Download NGINX and RTMP module\r\nRUN wget https://nginx.org/download/nginx-1.15.11.tar.gz && \\\r\n tar zxf nginx-1.15.11.tar.gz\r\n\r\nRUN wget https://github.com/arut/nginx-rtmp-module/archive/master.zip && \\\r\n unzip master.zip\r\n\r\nRUN rm -rf *.tar.gz\r\n\r\n### Step 3: Build and install NGINX\r\nRUN wget https://nginx.org/download/nginx-1.15.11.tar.gz && \\\r\n tar zxf nginx-1.15.11.tar.gz\r\n\r\nRUN   cd nginx-1.15.11 && ./configure \\\r\n--with-cc-opt=\"-I /usr/local/openssl/oqs/include/\" \\\r\n--with-ld-opt=\"-L /usr/local/openssl/oqs/lib/\"\\\r\n--sbin-path=/usr/local/nginx/nginx \\\r\n--conf-path=/usr/local/nginx/nginx.conf \\\r\n--pid-path=/usr/local/nginx/nginx.pid \\\r\n--with-pcre=../pcre-8.42 \\\r\n--with-zlib=../zlib-1.2.11 \\\r\n--with-openssl=/usr/local/openssl \\\r\n--with-http_ssl_module \\\r\n--with-stream \\\r\n--with-mail=dynamic \\\r\n--add-module=/nginx-rtmp-module-master && \\\r\nmake && \\\r\nmake install\r\n```\r\n\r\nThe error is the following:\r\n\r\n/usr/local/openssl/.openssl/lib/libssl.a(s3_lib.o): In function `ssl3_clear':\r\ns3_lib.c:(.text+0x51b): undefined reference to `OQS_KEM_free'\r\n/usr/local/openssl/.openssl/lib/libssl.a(extensions_clnt.o): In function `tls_construct_ctos_key_share':\r\nextensions_clnt.c:(.text+0x18af): undefined reference to `OQS_KEM_new'\r\nextensions_clnt.c:(.text+0x1952): undefined reference to `OQS_KEM_keypair'\r\nextensions_clnt.c:(.text+0x199c): undefined reference to `OQS_MEM_secure_free'\r\nextensions_clnt.c:(.text+0x19a4): undefined reference to `OQS_MEM_insecure_free'\r\nextensions_clnt.c:(.text+0x19c2): undefined reference to `OQS_KEM_free'\r\n/usr/local/openssl/.openssl/lib/libssl.a(extensions_clnt.o): In function `tls_parse_stoc_key_share':\r\nextensions_clnt.c:(.text+0x3c96): undefined reference to `OQS_MEM_secure_free'\r\nextensions_clnt.c:(.text+0x3cb4): undefined reference to `OQS_MEM_secure_free'\r\nextensions_clnt.c:(.text+0x3cd2): undefined reference to `OQS_KEM_free'\r\nextensions_clnt.c:(.text+0x3d77): undefined reference to `OQS_KEM_decaps'\r\n/usr/local/openssl/.openssl/lib/libssl.a(extensions_srvr.o): In function `tls_construct_stoc_key_share':\r\nextensions_srvr.c:(.text+0x3769): undefined reference to `OQS_KEM_new'\r\nextensions_srvr.c:(.text+0x37be): undefined reference to `OQS_KEM_encaps'\r\nextensions_srvr.c:(.text+0x3906): undefined reference to `OQS_MEM_secure_free'\r\nextensions_srvr.c:(.text+0x390e): undefined reference to `OQS_KEM_free'\r\nextensions_srvr.c:(.text+0x3aeb): undefined reference to `OQS_MEM_secure_free'\r\nextensions_srvr.c:(.text+0x3af3): undefined reference to `OQS_KEM_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `pkey_oqs_digestverify':\r\noqs_meth.c:(.text+0x101): undefined reference to `OQS_SIG_verify'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `pkey_oqs_digestsign':\r\noqs_meth.c:(.text+0x62f): undefined reference to `OQS_SIG_sign'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_free':\r\noqs_meth.c:(.text+0x1d0e): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_key_init':\r\noqs_meth.c:(.text+0x1df9): undefined reference to `OQS_SIG_new'\r\noqs_meth.c:(.text+0x1f30): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_priv_decode':\r\noqs_meth.c:(.text+0x22f6): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `pkey_oqs_keygen':\r\noqs_meth.c:(.text+0x2528): undefined reference to `OQS_SIG_new'\r\noqs_meth.c:(.text+0x273c): undefined reference to `OQS_SIG_keypair'\r\noqs_meth.c:(.text+0x2778): undefined reference to `OQS_SIG_free'\r\noqs_meth.c:(.text+0x2810): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_pub_decode':\r\noqs_meth.c:(.text+0x2b6a): undefined reference to `OQS_SIG_free'\r\ncollect2: error: ld returned 1 exit status\r\nobjs/Makefile:323: recipe for target 'objs/nginx' failed\r\nmake[1]: Leaving directory '/nginx-1.15.11'\r\nmake[1]: *** [objs/nginx] Error 1\r\nMakefile:8: recipe for target 'build' failed\r\nmake: *** [build] Error 2\r\n\r\n\r\nThanks!"},"comment":{"url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/comments/515052748","html_url":"https://github.com/open-quantum-safe/openssl/issues/103#issuecomment-515052748","issue_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103","id":515052748,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNTA1Mjc0OA==","user":{"login":"RicardoGaGu","id":25283073,"node_id":"MDQ6VXNlcjI1MjgzMDcz","avatar_url":"https://avatars3.githubusercontent.com/u/25283073?v=4","gravatar_id":"","url":"https://api.github.com/users/RicardoGaGu","html_url":"https://github.com/RicardoGaGu","followers_url":"https://api.github.com/users/RicardoGaGu/followers","following_url":"https://api.github.com/users/RicardoGaGu/following{/other_user}","gists_url":"https://api.github.com/users/RicardoGaGu/gists{/gist_id}","starred_url":"https://api.github.com/users/RicardoGaGu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RicardoGaGu/subscriptions","organizations_url":"https://api.github.com/users/RicardoGaGu/orgs","repos_url":"https://api.github.com/users/RicardoGaGu/repos","events_url":"https://api.github.com/users/RicardoGaGu/events{/privacy}","received_events_url":"https://api.github.com/users/RicardoGaGu/received_events","type":"User","site_admin":false},"created_at":"2019-07-25T13:54:02Z","updated_at":"2019-07-25T13:54:02Z","author_association":"NONE","body":"Hi @dstebila, thanks for the quick reply, adding -loqs on the --with-ld-opt argument does not seem to be a valid option:\r\n\r\nError:\r\n\r\n---> Running in 91952e53ed0a\r\nchecking for OS\r\n + Linux 4.18.0-15-generic x86_64\r\nchecking for C compiler ... found\r\n + using GNU C compiler\r\n + gcc version: 7.4.0 (Ubuntu 7.4.0-1ubuntu1~18.04.1) \r\nchecking for gcc -pipe switch ... found\r\nchecking for --with-ld-opt=\"-loqs\" ... not found\r\n./configure: error: the invalid value in --with-ld-opt=\"-loqs\"\r\n\r\nThe command '/bin/sh -c cd nginx-1.15.11 && ./configure --with-cc-opt=\"-I /usr/local/openssl/oqs/include/\" --with-ld-opt=\"-loqs\" --sbin-path=/usr/local/nginx/nginx --conf-path=/usr/local/nginx/nginx.conf --pid-path=/usr/local/nginx/nginx.pid --with-pcre=../pcre-8.42 --with-zlib=../zlib-1.2.11 --with-openssl=/usr/local/openssl --with-http_ssl_module --with-stream --with-mail=dynamic --add-module=/nginx-rtmp-module-master && make && make install' returned a non-zero code: 1\r\n"}},"public":true,"created_at":"2019-07-25T13:54:03Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
{"id":"10083573252","type":"IssueCommentEvent","actor":{"id":8843219,"login":"dstebila","display_login":"dstebila","gravatar_id":"","url":"https://api.github.com/users/dstebila","avatar_url":"https://avatars.githubusercontent.com/u/8843219?"},"repo":{"id":66578799,"name":"open-quantum-safe/openssl","url":"https://api.github.com/repos/open-quantum-safe/openssl"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103","repository_url":"https://api.github.com/repos/open-quantum-safe/openssl","labels_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103/comments","events_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103/events","html_url":"https://github.com/open-quantum-safe/openssl/issues/103","id":472766958,"node_id":"MDU6SXNzdWU0NzI3NjY5NTg=","number":103,"title":"Failing to compile NGINX with PQ openssl fork","user":{"login":"RicardoGaGu","id":25283073,"node_id":"MDQ6VXNlcjI1MjgzMDcz","avatar_url":"https://avatars3.githubusercontent.com/u/25283073?v=4","gravatar_id":"","url":"https://api.github.com/users/RicardoGaGu","html_url":"https://github.com/RicardoGaGu","followers_url":"https://api.github.com/users/RicardoGaGu/followers","following_url":"https://api.github.com/users/RicardoGaGu/following{/other_user}","gists_url":"https://api.github.com/users/RicardoGaGu/gists{/gist_id}","starred_url":"https://api.github.com/users/RicardoGaGu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RicardoGaGu/subscriptions","organizations_url":"https://api.github.com/users/RicardoGaGu/orgs","repos_url":"https://api.github.com/users/RicardoGaGu/repos","events_url":"https://api.github.com/users/RicardoGaGu/events{/privacy}","received_events_url":"https://api.github.com/users/RicardoGaGu/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-07-25T09:42:07Z","updated_at":"2019-07-25T13:57:09Z","closed_at":null,"author_association":"NONE","body":"HI! I'm trying to compile the PQ OpenSSL fork into NGINX, I've run into some problems when building nginx wirth openssl underneath. I'll show my Dockerfile to clarify my procedure for installing Nginx. I have tested the TLS demo and works fine, but when configuring Nginx on Ubuntu 18.04 it fails. I kindly ask if anyone know how to solve this problem.\r\n\r\n```\r\nFROM ubuntu:18.04\r\n\r\n### Building NGINX from source with post quantum openssl for TLS connections\r\nRUN apt update && apt upgrade -y\r\nRUN apt install wget autoconf automake libtool libssl-dev make unzip xsltproc git -y\r\nRUN apt install build-essential -y\r\n\r\n### Step 1: Build required libraries: pcre, zlib and quantum safe openssl\r\n\r\n### PCRE\r\nRUN wget ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.42.tar.gz && \\\r\n tar -zxf pcre-8.42.tar.gz && \\\r\n cd pcre-8.42 && \\\r\n ./configure && \\\r\n make && \\\r\n make install\r\n### ZLIB\r\nRUN wget http://zlib.net/zlib-1.2.11.tar.gz && \\\r\n tar -zxf zlib-1.2.11.tar.gz && \\\r\n cd zlib-1.2.11 && \\\r\n ./configure && \\\r\n make && \\\r\n make install\r\n\r\n\r\n### Install liboqs\r\nWORKDIR /usr/local/\r\n\r\nRUN git clone --branch OQS-OpenSSL_1_1_1-stable https://github.com/open-quantum-safe/openssl.git\r\n\r\nRUN git clone --branch master https://github.com/open-quantum-safe/liboqs.git\r\n\r\nWORKDIR /usr/local/liboqs\r\nRUN autoreconf -i\r\nRUN ./configure --prefix=/usr/local/openssl/oqs --enable-shared=no\r\nRUN make -j\r\nRUN make install\r\n\r\n### Install openssl\r\nWORKDIR /usr/local/openssl\r\nRUN ./config --prefix=/usr/local/openssl -Wl,-rpath -Wl,/usr/local/openssl/oqs/lib\r\nRUN make -j\r\n\r\nRUN cp libcrypto.so.1.1 ./oqs/lib\r\nRUN cp libssl.so.1.1 ./oqs/lib\r\n\r\nWORKDIR /\r\n\r\n### Step 2: Download NGINX and RTMP module\r\nRUN wget https://nginx.org/download/nginx-1.15.11.tar.gz && \\\r\n tar zxf nginx-1.15.11.tar.gz\r\n\r\nRUN wget https://github.com/arut/nginx-rtmp-module/archive/master.zip && \\\r\n unzip master.zip\r\n\r\nRUN rm -rf *.tar.gz\r\n\r\n### Step 3: Build and install NGINX\r\nRUN wget https://nginx.org/download/nginx-1.15.11.tar.gz && \\\r\n tar zxf nginx-1.15.11.tar.gz\r\n\r\nRUN   cd nginx-1.15.11 && ./configure \\\r\n--with-cc-opt=\"-I /usr/local/openssl/oqs/include/\" \\\r\n--with-ld-opt=\"-L /usr/local/openssl/oqs/lib/\"\\\r\n--sbin-path=/usr/local/nginx/nginx \\\r\n--conf-path=/usr/local/nginx/nginx.conf \\\r\n--pid-path=/usr/local/nginx/nginx.pid \\\r\n--with-pcre=../pcre-8.42 \\\r\n--with-zlib=../zlib-1.2.11 \\\r\n--with-openssl=/usr/local/openssl \\\r\n--with-http_ssl_module \\\r\n--with-stream \\\r\n--with-mail=dynamic \\\r\n--add-module=/nginx-rtmp-module-master && \\\r\nmake && \\\r\nmake install\r\n```\r\n\r\nThe error is the following:\r\n\r\n/usr/local/openssl/.openssl/lib/libssl.a(s3_lib.o): In function `ssl3_clear':\r\ns3_lib.c:(.text+0x51b): undefined reference to `OQS_KEM_free'\r\n/usr/local/openssl/.openssl/lib/libssl.a(extensions_clnt.o): In function `tls_construct_ctos_key_share':\r\nextensions_clnt.c:(.text+0x18af): undefined reference to `OQS_KEM_new'\r\nextensions_clnt.c:(.text+0x1952): undefined reference to `OQS_KEM_keypair'\r\nextensions_clnt.c:(.text+0x199c): undefined reference to `OQS_MEM_secure_free'\r\nextensions_clnt.c:(.text+0x19a4): undefined reference to `OQS_MEM_insecure_free'\r\nextensions_clnt.c:(.text+0x19c2): undefined reference to `OQS_KEM_free'\r\n/usr/local/openssl/.openssl/lib/libssl.a(extensions_clnt.o): In function `tls_parse_stoc_key_share':\r\nextensions_clnt.c:(.text+0x3c96): undefined reference to `OQS_MEM_secure_free'\r\nextensions_clnt.c:(.text+0x3cb4): undefined reference to `OQS_MEM_secure_free'\r\nextensions_clnt.c:(.text+0x3cd2): undefined reference to `OQS_KEM_free'\r\nextensions_clnt.c:(.text+0x3d77): undefined reference to `OQS_KEM_decaps'\r\n/usr/local/openssl/.openssl/lib/libssl.a(extensions_srvr.o): In function `tls_construct_stoc_key_share':\r\nextensions_srvr.c:(.text+0x3769): undefined reference to `OQS_KEM_new'\r\nextensions_srvr.c:(.text+0x37be): undefined reference to `OQS_KEM_encaps'\r\nextensions_srvr.c:(.text+0x3906): undefined reference to `OQS_MEM_secure_free'\r\nextensions_srvr.c:(.text+0x390e): undefined reference to `OQS_KEM_free'\r\nextensions_srvr.c:(.text+0x3aeb): undefined reference to `OQS_MEM_secure_free'\r\nextensions_srvr.c:(.text+0x3af3): undefined reference to `OQS_KEM_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `pkey_oqs_digestverify':\r\noqs_meth.c:(.text+0x101): undefined reference to `OQS_SIG_verify'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `pkey_oqs_digestsign':\r\noqs_meth.c:(.text+0x62f): undefined reference to `OQS_SIG_sign'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_free':\r\noqs_meth.c:(.text+0x1d0e): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_key_init':\r\noqs_meth.c:(.text+0x1df9): undefined reference to `OQS_SIG_new'\r\noqs_meth.c:(.text+0x1f30): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_priv_decode':\r\noqs_meth.c:(.text+0x22f6): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `pkey_oqs_keygen':\r\noqs_meth.c:(.text+0x2528): undefined reference to `OQS_SIG_new'\r\noqs_meth.c:(.text+0x273c): undefined reference to `OQS_SIG_keypair'\r\noqs_meth.c:(.text+0x2778): undefined reference to `OQS_SIG_free'\r\noqs_meth.c:(.text+0x2810): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_pub_decode':\r\noqs_meth.c:(.text+0x2b6a): undefined reference to `OQS_SIG_free'\r\ncollect2: error: ld returned 1 exit status\r\nobjs/Makefile:323: recipe for target 'objs/nginx' failed\r\nmake[1]: Leaving directory '/nginx-1.15.11'\r\nmake[1]: *** [objs/nginx] Error 1\r\nMakefile:8: recipe for target 'build' failed\r\nmake: *** [build] Error 2\r\n\r\n\r\nThanks!"},"comment":{"url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/comments/515053963","html_url":"https://github.com/open-quantum-safe/openssl/issues/103#issuecomment-515053963","issue_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103","id":515053963,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNTA1Mzk2Mw==","user":{"login":"dstebila","id":8843219,"node_id":"MDQ6VXNlcjg4NDMyMTk=","avatar_url":"https://avatars0.githubusercontent.com/u/8843219?v=4","gravatar_id":"","url":"https://api.github.com/users/dstebila","html_url":"https://github.com/dstebila","followers_url":"https://api.github.com/users/dstebila/followers","following_url":"https://api.github.com/users/dstebila/following{/other_user}","gists_url":"https://api.github.com/users/dstebila/gists{/gist_id}","starred_url":"https://api.github.com/users/dstebila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dstebila/subscriptions","organizations_url":"https://api.github.com/users/dstebila/orgs","repos_url":"https://api.github.com/users/dstebila/repos","events_url":"https://api.github.com/users/dstebila/events{/privacy}","received_events_url":"https://api.github.com/users/dstebila/received_events","type":"User","site_admin":false},"created_at":"2019-07-25T13:57:09Z","updated_at":"2019-07-25T13:57:09Z","author_association":"MEMBER","body":"I think you'd have to *add* `-loqs` to the existing argument, so it becomes:\r\n```\r\n--with-ld-opt=\"-L /usr/local/openssl/oqs/lib/ -loqs\"\r\n```"}},"public":true,"created_at":"2019-07-25T13:57:10Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
{"id":"10083671427","type":"IssueCommentEvent","actor":{"id":25283073,"login":"RicardoGaGu","display_login":"RicardoGaGu","gravatar_id":"","url":"https://api.github.com/users/RicardoGaGu","avatar_url":"https://avatars.githubusercontent.com/u/25283073?"},"repo":{"id":66578799,"name":"open-quantum-safe/openssl","url":"https://api.github.com/repos/open-quantum-safe/openssl"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103","repository_url":"https://api.github.com/repos/open-quantum-safe/openssl","labels_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103/comments","events_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103/events","html_url":"https://github.com/open-quantum-safe/openssl/issues/103","id":472766958,"node_id":"MDU6SXNzdWU0NzI3NjY5NTg=","number":103,"title":"Failing to compile NGINX with PQ openssl fork","user":{"login":"RicardoGaGu","id":25283073,"node_id":"MDQ6VXNlcjI1MjgzMDcz","avatar_url":"https://avatars3.githubusercontent.com/u/25283073?v=4","gravatar_id":"","url":"https://api.github.com/users/RicardoGaGu","html_url":"https://github.com/RicardoGaGu","followers_url":"https://api.github.com/users/RicardoGaGu/followers","following_url":"https://api.github.com/users/RicardoGaGu/following{/other_user}","gists_url":"https://api.github.com/users/RicardoGaGu/gists{/gist_id}","starred_url":"https://api.github.com/users/RicardoGaGu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RicardoGaGu/subscriptions","organizations_url":"https://api.github.com/users/RicardoGaGu/orgs","repos_url":"https://api.github.com/users/RicardoGaGu/repos","events_url":"https://api.github.com/users/RicardoGaGu/events{/privacy}","received_events_url":"https://api.github.com/users/RicardoGaGu/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2019-07-25T09:42:07Z","updated_at":"2019-07-25T14:08:47Z","closed_at":null,"author_association":"NONE","body":"HI! I'm trying to compile the PQ OpenSSL fork into NGINX, I've run into some problems when building nginx wirth openssl underneath. I'll show my Dockerfile to clarify my procedure for installing Nginx. I have tested the TLS demo and works fine, but when configuring Nginx on Ubuntu 18.04 it fails. I kindly ask if anyone know how to solve this problem.\r\n\r\n```\r\nFROM ubuntu:18.04\r\n\r\n### Building NGINX from source with post quantum openssl for TLS connections\r\nRUN apt update && apt upgrade -y\r\nRUN apt install wget autoconf automake libtool libssl-dev make unzip xsltproc git -y\r\nRUN apt install build-essential -y\r\n\r\n### Step 1: Build required libraries: pcre, zlib and quantum safe openssl\r\n\r\n### PCRE\r\nRUN wget ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.42.tar.gz && \\\r\n tar -zxf pcre-8.42.tar.gz && \\\r\n cd pcre-8.42 && \\\r\n ./configure && \\\r\n make && \\\r\n make install\r\n### ZLIB\r\nRUN wget http://zlib.net/zlib-1.2.11.tar.gz && \\\r\n tar -zxf zlib-1.2.11.tar.gz && \\\r\n cd zlib-1.2.11 && \\\r\n ./configure && \\\r\n make && \\\r\n make install\r\n\r\n\r\n### Install liboqs\r\nWORKDIR /usr/local/\r\n\r\nRUN git clone --branch OQS-OpenSSL_1_1_1-stable https://github.com/open-quantum-safe/openssl.git\r\n\r\nRUN git clone --branch master https://github.com/open-quantum-safe/liboqs.git\r\n\r\nWORKDIR /usr/local/liboqs\r\nRUN autoreconf -i\r\nRUN ./configure --prefix=/usr/local/openssl/oqs --enable-shared=no\r\nRUN make -j\r\nRUN make install\r\n\r\n### Install openssl\r\nWORKDIR /usr/local/openssl\r\nRUN ./config --prefix=/usr/local/openssl -Wl,-rpath -Wl,/usr/local/openssl/oqs/lib\r\nRUN make -j\r\n\r\nRUN cp libcrypto.so.1.1 ./oqs/lib\r\nRUN cp libssl.so.1.1 ./oqs/lib\r\n\r\nWORKDIR /\r\n\r\n### Step 2: Download NGINX and RTMP module\r\nRUN wget https://nginx.org/download/nginx-1.15.11.tar.gz && \\\r\n tar zxf nginx-1.15.11.tar.gz\r\n\r\nRUN wget https://github.com/arut/nginx-rtmp-module/archive/master.zip && \\\r\n unzip master.zip\r\n\r\nRUN rm -rf *.tar.gz\r\n\r\n### Step 3: Build and install NGINX\r\nRUN wget https://nginx.org/download/nginx-1.15.11.tar.gz && \\\r\n tar zxf nginx-1.15.11.tar.gz\r\n\r\nRUN   cd nginx-1.15.11 && ./configure \\\r\n--with-cc-opt=\"-I /usr/local/openssl/oqs/include/\" \\\r\n--with-ld-opt=\"-L /usr/local/openssl/oqs/lib/\"\\\r\n--sbin-path=/usr/local/nginx/nginx \\\r\n--conf-path=/usr/local/nginx/nginx.conf \\\r\n--pid-path=/usr/local/nginx/nginx.pid \\\r\n--with-pcre=../pcre-8.42 \\\r\n--with-zlib=../zlib-1.2.11 \\\r\n--with-openssl=/usr/local/openssl \\\r\n--with-http_ssl_module \\\r\n--with-stream \\\r\n--with-mail=dynamic \\\r\n--add-module=/nginx-rtmp-module-master && \\\r\nmake && \\\r\nmake install\r\n```\r\n\r\nThe error is the following:\r\n\r\n/usr/local/openssl/.openssl/lib/libssl.a(s3_lib.o): In function `ssl3_clear':\r\ns3_lib.c:(.text+0x51b): undefined reference to `OQS_KEM_free'\r\n/usr/local/openssl/.openssl/lib/libssl.a(extensions_clnt.o): In function `tls_construct_ctos_key_share':\r\nextensions_clnt.c:(.text+0x18af): undefined reference to `OQS_KEM_new'\r\nextensions_clnt.c:(.text+0x1952): undefined reference to `OQS_KEM_keypair'\r\nextensions_clnt.c:(.text+0x199c): undefined reference to `OQS_MEM_secure_free'\r\nextensions_clnt.c:(.text+0x19a4): undefined reference to `OQS_MEM_insecure_free'\r\nextensions_clnt.c:(.text+0x19c2): undefined reference to `OQS_KEM_free'\r\n/usr/local/openssl/.openssl/lib/libssl.a(extensions_clnt.o): In function `tls_parse_stoc_key_share':\r\nextensions_clnt.c:(.text+0x3c96): undefined reference to `OQS_MEM_secure_free'\r\nextensions_clnt.c:(.text+0x3cb4): undefined reference to `OQS_MEM_secure_free'\r\nextensions_clnt.c:(.text+0x3cd2): undefined reference to `OQS_KEM_free'\r\nextensions_clnt.c:(.text+0x3d77): undefined reference to `OQS_KEM_decaps'\r\n/usr/local/openssl/.openssl/lib/libssl.a(extensions_srvr.o): In function `tls_construct_stoc_key_share':\r\nextensions_srvr.c:(.text+0x3769): undefined reference to `OQS_KEM_new'\r\nextensions_srvr.c:(.text+0x37be): undefined reference to `OQS_KEM_encaps'\r\nextensions_srvr.c:(.text+0x3906): undefined reference to `OQS_MEM_secure_free'\r\nextensions_srvr.c:(.text+0x390e): undefined reference to `OQS_KEM_free'\r\nextensions_srvr.c:(.text+0x3aeb): undefined reference to `OQS_MEM_secure_free'\r\nextensions_srvr.c:(.text+0x3af3): undefined reference to `OQS_KEM_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `pkey_oqs_digestverify':\r\noqs_meth.c:(.text+0x101): undefined reference to `OQS_SIG_verify'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `pkey_oqs_digestsign':\r\noqs_meth.c:(.text+0x62f): undefined reference to `OQS_SIG_sign'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_free':\r\noqs_meth.c:(.text+0x1d0e): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_key_init':\r\noqs_meth.c:(.text+0x1df9): undefined reference to `OQS_SIG_new'\r\noqs_meth.c:(.text+0x1f30): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_priv_decode':\r\noqs_meth.c:(.text+0x22f6): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `pkey_oqs_keygen':\r\noqs_meth.c:(.text+0x2528): undefined reference to `OQS_SIG_new'\r\noqs_meth.c:(.text+0x273c): undefined reference to `OQS_SIG_keypair'\r\noqs_meth.c:(.text+0x2778): undefined reference to `OQS_SIG_free'\r\noqs_meth.c:(.text+0x2810): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_pub_decode':\r\noqs_meth.c:(.text+0x2b6a): undefined reference to `OQS_SIG_free'\r\ncollect2: error: ld returned 1 exit status\r\nobjs/Makefile:323: recipe for target 'objs/nginx' failed\r\nmake[1]: Leaving directory '/nginx-1.15.11'\r\nmake[1]: *** [objs/nginx] Error 1\r\nMakefile:8: recipe for target 'build' failed\r\nmake: *** [build] Error 2\r\n\r\n\r\nThanks!"},"comment":{"url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/comments/515058500","html_url":"https://github.com/open-quantum-safe/openssl/issues/103#issuecomment-515058500","issue_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103","id":515058500,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNTA1ODUwMA==","user":{"login":"RicardoGaGu","id":25283073,"node_id":"MDQ6VXNlcjI1MjgzMDcz","avatar_url":"https://avatars3.githubusercontent.com/u/25283073?v=4","gravatar_id":"","url":"https://api.github.com/users/RicardoGaGu","html_url":"https://github.com/RicardoGaGu","followers_url":"https://api.github.com/users/RicardoGaGu/followers","following_url":"https://api.github.com/users/RicardoGaGu/following{/other_user}","gists_url":"https://api.github.com/users/RicardoGaGu/gists{/gist_id}","starred_url":"https://api.github.com/users/RicardoGaGu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RicardoGaGu/subscriptions","organizations_url":"https://api.github.com/users/RicardoGaGu/orgs","repos_url":"https://api.github.com/users/RicardoGaGu/repos","events_url":"https://api.github.com/users/RicardoGaGu/events{/privacy}","received_events_url":"https://api.github.com/users/RicardoGaGu/received_events","type":"User","site_admin":false},"created_at":"2019-07-25T14:08:47Z","updated_at":"2019-07-25T14:08:47Z","author_association":"NONE","body":"Ok, I just tried it with no success, the same error keeps appearing.\r\n\r\ncollect2: error: ld returned 1 exit status\r\nobjs/Makefile:323: recipe for target 'objs/nginx' failed\r\nmake[1]: Leaving directory '/nginx-1.15.11'\r\nmake[1]: *** [objs/nginx] Error 1\r\nmake: *** [build] Error 2\r\nMakefile:8: recipe for target 'build' failed\r\n"}},"public":true,"created_at":"2019-07-25T14:08:47Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
{"id":"10083682110","type":"IssueCommentEvent","actor":{"id":25283073,"login":"RicardoGaGu","display_login":"RicardoGaGu","gravatar_id":"","url":"https://api.github.com/users/RicardoGaGu","avatar_url":"https://avatars.githubusercontent.com/u/25283073?"},"repo":{"id":66578799,"name":"open-quantum-safe/openssl","url":"https://api.github.com/repos/open-quantum-safe/openssl"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103","repository_url":"https://api.github.com/repos/open-quantum-safe/openssl","labels_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103/comments","events_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103/events","html_url":"https://github.com/open-quantum-safe/openssl/issues/103","id":472766958,"node_id":"MDU6SXNzdWU0NzI3NjY5NTg=","number":103,"title":"Failing to compile NGINX with PQ openssl fork","user":{"login":"RicardoGaGu","id":25283073,"node_id":"MDQ6VXNlcjI1MjgzMDcz","avatar_url":"https://avatars3.githubusercontent.com/u/25283073?v=4","gravatar_id":"","url":"https://api.github.com/users/RicardoGaGu","html_url":"https://github.com/RicardoGaGu","followers_url":"https://api.github.com/users/RicardoGaGu/followers","following_url":"https://api.github.com/users/RicardoGaGu/following{/other_user}","gists_url":"https://api.github.com/users/RicardoGaGu/gists{/gist_id}","starred_url":"https://api.github.com/users/RicardoGaGu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RicardoGaGu/subscriptions","organizations_url":"https://api.github.com/users/RicardoGaGu/orgs","repos_url":"https://api.github.com/users/RicardoGaGu/repos","events_url":"https://api.github.com/users/RicardoGaGu/events{/privacy}","received_events_url":"https://api.github.com/users/RicardoGaGu/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2019-07-25T09:42:07Z","updated_at":"2019-07-25T14:10:03Z","closed_at":null,"author_association":"NONE","body":"HI! I'm trying to compile the PQ OpenSSL fork into NGINX, I've run into some problems when building nginx wirth openssl underneath. I'll show my Dockerfile to clarify my procedure for installing Nginx. I have tested the TLS demo and works fine, but when configuring Nginx on Ubuntu 18.04 it fails. I kindly ask if anyone know how to solve this problem.\r\n\r\n```\r\nFROM ubuntu:18.04\r\n\r\n### Building NGINX from source with post quantum openssl for TLS connections\r\nRUN apt update && apt upgrade -y\r\nRUN apt install wget autoconf automake libtool libssl-dev make unzip xsltproc git -y\r\nRUN apt install build-essential -y\r\n\r\n### Step 1: Build required libraries: pcre, zlib and quantum safe openssl\r\n\r\n### PCRE\r\nRUN wget ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.42.tar.gz && \\\r\n tar -zxf pcre-8.42.tar.gz && \\\r\n cd pcre-8.42 && \\\r\n ./configure && \\\r\n make && \\\r\n make install\r\n### ZLIB\r\nRUN wget http://zlib.net/zlib-1.2.11.tar.gz && \\\r\n tar -zxf zlib-1.2.11.tar.gz && \\\r\n cd zlib-1.2.11 && \\\r\n ./configure && \\\r\n make && \\\r\n make install\r\n\r\n\r\n### Install liboqs\r\nWORKDIR /usr/local/\r\n\r\nRUN git clone --branch OQS-OpenSSL_1_1_1-stable https://github.com/open-quantum-safe/openssl.git\r\n\r\nRUN git clone --branch master https://github.com/open-quantum-safe/liboqs.git\r\n\r\nWORKDIR /usr/local/liboqs\r\nRUN autoreconf -i\r\nRUN ./configure --prefix=/usr/local/openssl/oqs --enable-shared=no\r\nRUN make -j\r\nRUN make install\r\n\r\n### Install openssl\r\nWORKDIR /usr/local/openssl\r\nRUN ./config --prefix=/usr/local/openssl -Wl,-rpath -Wl,/usr/local/openssl/oqs/lib\r\nRUN make -j\r\n\r\nRUN cp libcrypto.so.1.1 ./oqs/lib\r\nRUN cp libssl.so.1.1 ./oqs/lib\r\n\r\nWORKDIR /\r\n\r\n### Step 2: Download NGINX and RTMP module\r\nRUN wget https://nginx.org/download/nginx-1.15.11.tar.gz && \\\r\n tar zxf nginx-1.15.11.tar.gz\r\n\r\nRUN wget https://github.com/arut/nginx-rtmp-module/archive/master.zip && \\\r\n unzip master.zip\r\n\r\nRUN rm -rf *.tar.gz\r\n\r\n### Step 3: Build and install NGINX\r\nRUN wget https://nginx.org/download/nginx-1.15.11.tar.gz && \\\r\n tar zxf nginx-1.15.11.tar.gz\r\n\r\nRUN   cd nginx-1.15.11 && ./configure \\\r\n--with-cc-opt=\"-I /usr/local/openssl/oqs/include/\" \\\r\n--with-ld-opt=\"-L /usr/local/openssl/oqs/lib/\"\\\r\n--sbin-path=/usr/local/nginx/nginx \\\r\n--conf-path=/usr/local/nginx/nginx.conf \\\r\n--pid-path=/usr/local/nginx/nginx.pid \\\r\n--with-pcre=../pcre-8.42 \\\r\n--with-zlib=../zlib-1.2.11 \\\r\n--with-openssl=/usr/local/openssl \\\r\n--with-http_ssl_module \\\r\n--with-stream \\\r\n--with-mail=dynamic \\\r\n--add-module=/nginx-rtmp-module-master && \\\r\nmake && \\\r\nmake install\r\n```\r\n\r\nThe error is the following:\r\n\r\n/usr/local/openssl/.openssl/lib/libssl.a(s3_lib.o): In function `ssl3_clear':\r\ns3_lib.c:(.text+0x51b): undefined reference to `OQS_KEM_free'\r\n/usr/local/openssl/.openssl/lib/libssl.a(extensions_clnt.o): In function `tls_construct_ctos_key_share':\r\nextensions_clnt.c:(.text+0x18af): undefined reference to `OQS_KEM_new'\r\nextensions_clnt.c:(.text+0x1952): undefined reference to `OQS_KEM_keypair'\r\nextensions_clnt.c:(.text+0x199c): undefined reference to `OQS_MEM_secure_free'\r\nextensions_clnt.c:(.text+0x19a4): undefined reference to `OQS_MEM_insecure_free'\r\nextensions_clnt.c:(.text+0x19c2): undefined reference to `OQS_KEM_free'\r\n/usr/local/openssl/.openssl/lib/libssl.a(extensions_clnt.o): In function `tls_parse_stoc_key_share':\r\nextensions_clnt.c:(.text+0x3c96): undefined reference to `OQS_MEM_secure_free'\r\nextensions_clnt.c:(.text+0x3cb4): undefined reference to `OQS_MEM_secure_free'\r\nextensions_clnt.c:(.text+0x3cd2): undefined reference to `OQS_KEM_free'\r\nextensions_clnt.c:(.text+0x3d77): undefined reference to `OQS_KEM_decaps'\r\n/usr/local/openssl/.openssl/lib/libssl.a(extensions_srvr.o): In function `tls_construct_stoc_key_share':\r\nextensions_srvr.c:(.text+0x3769): undefined reference to `OQS_KEM_new'\r\nextensions_srvr.c:(.text+0x37be): undefined reference to `OQS_KEM_encaps'\r\nextensions_srvr.c:(.text+0x3906): undefined reference to `OQS_MEM_secure_free'\r\nextensions_srvr.c:(.text+0x390e): undefined reference to `OQS_KEM_free'\r\nextensions_srvr.c:(.text+0x3aeb): undefined reference to `OQS_MEM_secure_free'\r\nextensions_srvr.c:(.text+0x3af3): undefined reference to `OQS_KEM_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `pkey_oqs_digestverify':\r\noqs_meth.c:(.text+0x101): undefined reference to `OQS_SIG_verify'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `pkey_oqs_digestsign':\r\noqs_meth.c:(.text+0x62f): undefined reference to `OQS_SIG_sign'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_free':\r\noqs_meth.c:(.text+0x1d0e): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_key_init':\r\noqs_meth.c:(.text+0x1df9): undefined reference to `OQS_SIG_new'\r\noqs_meth.c:(.text+0x1f30): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_priv_decode':\r\noqs_meth.c:(.text+0x22f6): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `pkey_oqs_keygen':\r\noqs_meth.c:(.text+0x2528): undefined reference to `OQS_SIG_new'\r\noqs_meth.c:(.text+0x273c): undefined reference to `OQS_SIG_keypair'\r\noqs_meth.c:(.text+0x2778): undefined reference to `OQS_SIG_free'\r\noqs_meth.c:(.text+0x2810): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_pub_decode':\r\noqs_meth.c:(.text+0x2b6a): undefined reference to `OQS_SIG_free'\r\ncollect2: error: ld returned 1 exit status\r\nobjs/Makefile:323: recipe for target 'objs/nginx' failed\r\nmake[1]: Leaving directory '/nginx-1.15.11'\r\nmake[1]: *** [objs/nginx] Error 1\r\nMakefile:8: recipe for target 'build' failed\r\nmake: *** [build] Error 2\r\n\r\n\r\nThanks!"},"comment":{"url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/comments/515059030","html_url":"https://github.com/open-quantum-safe/openssl/issues/103#issuecomment-515059030","issue_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103","id":515059030,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNTA1OTAzMA==","user":{"login":"RicardoGaGu","id":25283073,"node_id":"MDQ6VXNlcjI1MjgzMDcz","avatar_url":"https://avatars3.githubusercontent.com/u/25283073?v=4","gravatar_id":"","url":"https://api.github.com/users/RicardoGaGu","html_url":"https://github.com/RicardoGaGu","followers_url":"https://api.github.com/users/RicardoGaGu/followers","following_url":"https://api.github.com/users/RicardoGaGu/following{/other_user}","gists_url":"https://api.github.com/users/RicardoGaGu/gists{/gist_id}","starred_url":"https://api.github.com/users/RicardoGaGu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RicardoGaGu/subscriptions","organizations_url":"https://api.github.com/users/RicardoGaGu/orgs","repos_url":"https://api.github.com/users/RicardoGaGu/repos","events_url":"https://api.github.com/users/RicardoGaGu/events{/privacy}","received_events_url":"https://api.github.com/users/RicardoGaGu/received_events","type":"User","site_admin":false},"created_at":"2019-07-25T14:10:03Z","updated_at":"2019-07-25T14:10:03Z","author_association":"NONE","body":"This the command with I think ld parameters that appear in my nginx compile logs:\r\n\r\n-L /usr/local/openssl/oqs/lib/ -loqs -ldl -lpthread -lcrypt ../pcre-8.42/.libs/libpcre.a /usr/local/openssl/.openssl/lib/libssl.a /usr/local/openssl/.openssl/lib/libcrypto.a -ldl -lpthread ../zlib-1.2.11/libz.a \\\r\n-Wl,-E"}},"public":true,"created_at":"2019-07-25T14:10:03Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
{"id":"10083737115","type":"IssueCommentEvent","actor":{"id":8843219,"login":"dstebila","display_login":"dstebila","gravatar_id":"","url":"https://api.github.com/users/dstebila","avatar_url":"https://avatars.githubusercontent.com/u/8843219?"},"repo":{"id":66578799,"name":"open-quantum-safe/openssl","url":"https://api.github.com/repos/open-quantum-safe/openssl"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103","repository_url":"https://api.github.com/repos/open-quantum-safe/openssl","labels_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103/comments","events_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103/events","html_url":"https://github.com/open-quantum-safe/openssl/issues/103","id":472766958,"node_id":"MDU6SXNzdWU0NzI3NjY5NTg=","number":103,"title":"Failing to compile NGINX with PQ openssl fork","user":{"login":"RicardoGaGu","id":25283073,"node_id":"MDQ6VXNlcjI1MjgzMDcz","avatar_url":"https://avatars3.githubusercontent.com/u/25283073?v=4","gravatar_id":"","url":"https://api.github.com/users/RicardoGaGu","html_url":"https://github.com/RicardoGaGu","followers_url":"https://api.github.com/users/RicardoGaGu/followers","following_url":"https://api.github.com/users/RicardoGaGu/following{/other_user}","gists_url":"https://api.github.com/users/RicardoGaGu/gists{/gist_id}","starred_url":"https://api.github.com/users/RicardoGaGu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RicardoGaGu/subscriptions","organizations_url":"https://api.github.com/users/RicardoGaGu/orgs","repos_url":"https://api.github.com/users/RicardoGaGu/repos","events_url":"https://api.github.com/users/RicardoGaGu/events{/privacy}","received_events_url":"https://api.github.com/users/RicardoGaGu/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2019-07-25T09:42:07Z","updated_at":"2019-07-25T14:16:32Z","closed_at":null,"author_association":"NONE","body":"HI! I'm trying to compile the PQ OpenSSL fork into NGINX, I've run into some problems when building nginx wirth openssl underneath. I'll show my Dockerfile to clarify my procedure for installing Nginx. I have tested the TLS demo and works fine, but when configuring Nginx on Ubuntu 18.04 it fails. I kindly ask if anyone know how to solve this problem.\r\n\r\n```\r\nFROM ubuntu:18.04\r\n\r\n### Building NGINX from source with post quantum openssl for TLS connections\r\nRUN apt update && apt upgrade -y\r\nRUN apt install wget autoconf automake libtool libssl-dev make unzip xsltproc git -y\r\nRUN apt install build-essential -y\r\n\r\n### Step 1: Build required libraries: pcre, zlib and quantum safe openssl\r\n\r\n### PCRE\r\nRUN wget ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.42.tar.gz && \\\r\n tar -zxf pcre-8.42.tar.gz && \\\r\n cd pcre-8.42 && \\\r\n ./configure && \\\r\n make && \\\r\n make install\r\n### ZLIB\r\nRUN wget http://zlib.net/zlib-1.2.11.tar.gz && \\\r\n tar -zxf zlib-1.2.11.tar.gz && \\\r\n cd zlib-1.2.11 && \\\r\n ./configure && \\\r\n make && \\\r\n make install\r\n\r\n\r\n### Install liboqs\r\nWORKDIR /usr/local/\r\n\r\nRUN git clone --branch OQS-OpenSSL_1_1_1-stable https://github.com/open-quantum-safe/openssl.git\r\n\r\nRUN git clone --branch master https://github.com/open-quantum-safe/liboqs.git\r\n\r\nWORKDIR /usr/local/liboqs\r\nRUN autoreconf -i\r\nRUN ./configure --prefix=/usr/local/openssl/oqs --enable-shared=no\r\nRUN make -j\r\nRUN make install\r\n\r\n### Install openssl\r\nWORKDIR /usr/local/openssl\r\nRUN ./config --prefix=/usr/local/openssl -Wl,-rpath -Wl,/usr/local/openssl/oqs/lib\r\nRUN make -j\r\n\r\nRUN cp libcrypto.so.1.1 ./oqs/lib\r\nRUN cp libssl.so.1.1 ./oqs/lib\r\n\r\nWORKDIR /\r\n\r\n### Step 2: Download NGINX and RTMP module\r\nRUN wget https://nginx.org/download/nginx-1.15.11.tar.gz && \\\r\n tar zxf nginx-1.15.11.tar.gz\r\n\r\nRUN wget https://github.com/arut/nginx-rtmp-module/archive/master.zip && \\\r\n unzip master.zip\r\n\r\nRUN rm -rf *.tar.gz\r\n\r\n### Step 3: Build and install NGINX\r\nRUN wget https://nginx.org/download/nginx-1.15.11.tar.gz && \\\r\n tar zxf nginx-1.15.11.tar.gz\r\n\r\nRUN   cd nginx-1.15.11 && ./configure \\\r\n--with-cc-opt=\"-I /usr/local/openssl/oqs/include/\" \\\r\n--with-ld-opt=\"-L /usr/local/openssl/oqs/lib/\"\\\r\n--sbin-path=/usr/local/nginx/nginx \\\r\n--conf-path=/usr/local/nginx/nginx.conf \\\r\n--pid-path=/usr/local/nginx/nginx.pid \\\r\n--with-pcre=../pcre-8.42 \\\r\n--with-zlib=../zlib-1.2.11 \\\r\n--with-openssl=/usr/local/openssl \\\r\n--with-http_ssl_module \\\r\n--with-stream \\\r\n--with-mail=dynamic \\\r\n--add-module=/nginx-rtmp-module-master && \\\r\nmake && \\\r\nmake install\r\n```\r\n\r\nThe error is the following:\r\n\r\n/usr/local/openssl/.openssl/lib/libssl.a(s3_lib.o): In function `ssl3_clear':\r\ns3_lib.c:(.text+0x51b): undefined reference to `OQS_KEM_free'\r\n/usr/local/openssl/.openssl/lib/libssl.a(extensions_clnt.o): In function `tls_construct_ctos_key_share':\r\nextensions_clnt.c:(.text+0x18af): undefined reference to `OQS_KEM_new'\r\nextensions_clnt.c:(.text+0x1952): undefined reference to `OQS_KEM_keypair'\r\nextensions_clnt.c:(.text+0x199c): undefined reference to `OQS_MEM_secure_free'\r\nextensions_clnt.c:(.text+0x19a4): undefined reference to `OQS_MEM_insecure_free'\r\nextensions_clnt.c:(.text+0x19c2): undefined reference to `OQS_KEM_free'\r\n/usr/local/openssl/.openssl/lib/libssl.a(extensions_clnt.o): In function `tls_parse_stoc_key_share':\r\nextensions_clnt.c:(.text+0x3c96): undefined reference to `OQS_MEM_secure_free'\r\nextensions_clnt.c:(.text+0x3cb4): undefined reference to `OQS_MEM_secure_free'\r\nextensions_clnt.c:(.text+0x3cd2): undefined reference to `OQS_KEM_free'\r\nextensions_clnt.c:(.text+0x3d77): undefined reference to `OQS_KEM_decaps'\r\n/usr/local/openssl/.openssl/lib/libssl.a(extensions_srvr.o): In function `tls_construct_stoc_key_share':\r\nextensions_srvr.c:(.text+0x3769): undefined reference to `OQS_KEM_new'\r\nextensions_srvr.c:(.text+0x37be): undefined reference to `OQS_KEM_encaps'\r\nextensions_srvr.c:(.text+0x3906): undefined reference to `OQS_MEM_secure_free'\r\nextensions_srvr.c:(.text+0x390e): undefined reference to `OQS_KEM_free'\r\nextensions_srvr.c:(.text+0x3aeb): undefined reference to `OQS_MEM_secure_free'\r\nextensions_srvr.c:(.text+0x3af3): undefined reference to `OQS_KEM_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `pkey_oqs_digestverify':\r\noqs_meth.c:(.text+0x101): undefined reference to `OQS_SIG_verify'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `pkey_oqs_digestsign':\r\noqs_meth.c:(.text+0x62f): undefined reference to `OQS_SIG_sign'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_free':\r\noqs_meth.c:(.text+0x1d0e): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_key_init':\r\noqs_meth.c:(.text+0x1df9): undefined reference to `OQS_SIG_new'\r\noqs_meth.c:(.text+0x1f30): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_priv_decode':\r\noqs_meth.c:(.text+0x22f6): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `pkey_oqs_keygen':\r\noqs_meth.c:(.text+0x2528): undefined reference to `OQS_SIG_new'\r\noqs_meth.c:(.text+0x273c): undefined reference to `OQS_SIG_keypair'\r\noqs_meth.c:(.text+0x2778): undefined reference to `OQS_SIG_free'\r\noqs_meth.c:(.text+0x2810): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_pub_decode':\r\noqs_meth.c:(.text+0x2b6a): undefined reference to `OQS_SIG_free'\r\ncollect2: error: ld returned 1 exit status\r\nobjs/Makefile:323: recipe for target 'objs/nginx' failed\r\nmake[1]: Leaving directory '/nginx-1.15.11'\r\nmake[1]: *** [objs/nginx] Error 1\r\nMakefile:8: recipe for target 'build' failed\r\nmake: *** [build] Error 2\r\n\r\n\r\nThanks!"},"comment":{"url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/comments/515061718","html_url":"https://github.com/open-quantum-safe/openssl/issues/103#issuecomment-515061718","issue_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103","id":515061718,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNTA2MTcxOA==","user":{"login":"dstebila","id":8843219,"node_id":"MDQ6VXNlcjg4NDMyMTk=","avatar_url":"https://avatars0.githubusercontent.com/u/8843219?v=4","gravatar_id":"","url":"https://api.github.com/users/dstebila","html_url":"https://github.com/dstebila","followers_url":"https://api.github.com/users/dstebila/followers","following_url":"https://api.github.com/users/dstebila/following{/other_user}","gists_url":"https://api.github.com/users/dstebila/gists{/gist_id}","starred_url":"https://api.github.com/users/dstebila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dstebila/subscriptions","organizations_url":"https://api.github.com/users/dstebila/orgs","repos_url":"https://api.github.com/users/dstebila/repos","events_url":"https://api.github.com/users/dstebila/events{/privacy}","received_events_url":"https://api.github.com/users/dstebila/received_events","type":"User","site_admin":false},"created_at":"2019-07-25T14:16:32Z","updated_at":"2019-07-25T14:16:32Z","author_association":"MEMBER","body":"Okay, I'd hoped the fix was simple but apparently not.  I'll have to sit down with the build process and try to reproduce/debug, might take a few days to get back to you on this."}},"public":true,"created_at":"2019-07-25T14:16:32Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
{"id":"10083792336","type":"IssueCommentEvent","actor":{"id":25283073,"login":"RicardoGaGu","display_login":"RicardoGaGu","gravatar_id":"","url":"https://api.github.com/users/RicardoGaGu","avatar_url":"https://avatars.githubusercontent.com/u/25283073?"},"repo":{"id":66578799,"name":"open-quantum-safe/openssl","url":"https://api.github.com/repos/open-quantum-safe/openssl"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103","repository_url":"https://api.github.com/repos/open-quantum-safe/openssl","labels_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103/comments","events_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103/events","html_url":"https://github.com/open-quantum-safe/openssl/issues/103","id":472766958,"node_id":"MDU6SXNzdWU0NzI3NjY5NTg=","number":103,"title":"Failing to compile NGINX with PQ openssl fork","user":{"login":"RicardoGaGu","id":25283073,"node_id":"MDQ6VXNlcjI1MjgzMDcz","avatar_url":"https://avatars3.githubusercontent.com/u/25283073?v=4","gravatar_id":"","url":"https://api.github.com/users/RicardoGaGu","html_url":"https://github.com/RicardoGaGu","followers_url":"https://api.github.com/users/RicardoGaGu/followers","following_url":"https://api.github.com/users/RicardoGaGu/following{/other_user}","gists_url":"https://api.github.com/users/RicardoGaGu/gists{/gist_id}","starred_url":"https://api.github.com/users/RicardoGaGu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RicardoGaGu/subscriptions","organizations_url":"https://api.github.com/users/RicardoGaGu/orgs","repos_url":"https://api.github.com/users/RicardoGaGu/repos","events_url":"https://api.github.com/users/RicardoGaGu/events{/privacy}","received_events_url":"https://api.github.com/users/RicardoGaGu/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2019-07-25T09:42:07Z","updated_at":"2019-07-25T14:23:11Z","closed_at":null,"author_association":"NONE","body":"HI! I'm trying to compile the PQ OpenSSL fork into NGINX, I've run into some problems when building nginx wirth openssl underneath. I'll show my Dockerfile to clarify my procedure for installing Nginx. I have tested the TLS demo and works fine, but when configuring Nginx on Ubuntu 18.04 it fails. I kindly ask if anyone know how to solve this problem.\r\n\r\n```\r\nFROM ubuntu:18.04\r\n\r\n### Building NGINX from source with post quantum openssl for TLS connections\r\nRUN apt update && apt upgrade -y\r\nRUN apt install wget autoconf automake libtool libssl-dev make unzip xsltproc git -y\r\nRUN apt install build-essential -y\r\n\r\n### Step 1: Build required libraries: pcre, zlib and quantum safe openssl\r\n\r\n### PCRE\r\nRUN wget ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.42.tar.gz && \\\r\n tar -zxf pcre-8.42.tar.gz && \\\r\n cd pcre-8.42 && \\\r\n ./configure && \\\r\n make && \\\r\n make install\r\n### ZLIB\r\nRUN wget http://zlib.net/zlib-1.2.11.tar.gz && \\\r\n tar -zxf zlib-1.2.11.tar.gz && \\\r\n cd zlib-1.2.11 && \\\r\n ./configure && \\\r\n make && \\\r\n make install\r\n\r\n\r\n### Install liboqs\r\nWORKDIR /usr/local/\r\n\r\nRUN git clone --branch OQS-OpenSSL_1_1_1-stable https://github.com/open-quantum-safe/openssl.git\r\n\r\nRUN git clone --branch master https://github.com/open-quantum-safe/liboqs.git\r\n\r\nWORKDIR /usr/local/liboqs\r\nRUN autoreconf -i\r\nRUN ./configure --prefix=/usr/local/openssl/oqs --enable-shared=no\r\nRUN make -j\r\nRUN make install\r\n\r\n### Install openssl\r\nWORKDIR /usr/local/openssl\r\nRUN ./config --prefix=/usr/local/openssl -Wl,-rpath -Wl,/usr/local/openssl/oqs/lib\r\nRUN make -j\r\n\r\nRUN cp libcrypto.so.1.1 ./oqs/lib\r\nRUN cp libssl.so.1.1 ./oqs/lib\r\n\r\nWORKDIR /\r\n\r\n### Step 2: Download NGINX and RTMP module\r\nRUN wget https://nginx.org/download/nginx-1.15.11.tar.gz && \\\r\n tar zxf nginx-1.15.11.tar.gz\r\n\r\nRUN wget https://github.com/arut/nginx-rtmp-module/archive/master.zip && \\\r\n unzip master.zip\r\n\r\nRUN rm -rf *.tar.gz\r\n\r\n### Step 3: Build and install NGINX\r\nRUN wget https://nginx.org/download/nginx-1.15.11.tar.gz && \\\r\n tar zxf nginx-1.15.11.tar.gz\r\n\r\nRUN   cd nginx-1.15.11 && ./configure \\\r\n--with-cc-opt=\"-I /usr/local/openssl/oqs/include/\" \\\r\n--with-ld-opt=\"-L /usr/local/openssl/oqs/lib/\"\\\r\n--sbin-path=/usr/local/nginx/nginx \\\r\n--conf-path=/usr/local/nginx/nginx.conf \\\r\n--pid-path=/usr/local/nginx/nginx.pid \\\r\n--with-pcre=../pcre-8.42 \\\r\n--with-zlib=../zlib-1.2.11 \\\r\n--with-openssl=/usr/local/openssl \\\r\n--with-http_ssl_module \\\r\n--with-stream \\\r\n--with-mail=dynamic \\\r\n--add-module=/nginx-rtmp-module-master && \\\r\nmake && \\\r\nmake install\r\n```\r\n\r\nThe error is the following:\r\n\r\n/usr/local/openssl/.openssl/lib/libssl.a(s3_lib.o): In function `ssl3_clear':\r\ns3_lib.c:(.text+0x51b): undefined reference to `OQS_KEM_free'\r\n/usr/local/openssl/.openssl/lib/libssl.a(extensions_clnt.o): In function `tls_construct_ctos_key_share':\r\nextensions_clnt.c:(.text+0x18af): undefined reference to `OQS_KEM_new'\r\nextensions_clnt.c:(.text+0x1952): undefined reference to `OQS_KEM_keypair'\r\nextensions_clnt.c:(.text+0x199c): undefined reference to `OQS_MEM_secure_free'\r\nextensions_clnt.c:(.text+0x19a4): undefined reference to `OQS_MEM_insecure_free'\r\nextensions_clnt.c:(.text+0x19c2): undefined reference to `OQS_KEM_free'\r\n/usr/local/openssl/.openssl/lib/libssl.a(extensions_clnt.o): In function `tls_parse_stoc_key_share':\r\nextensions_clnt.c:(.text+0x3c96): undefined reference to `OQS_MEM_secure_free'\r\nextensions_clnt.c:(.text+0x3cb4): undefined reference to `OQS_MEM_secure_free'\r\nextensions_clnt.c:(.text+0x3cd2): undefined reference to `OQS_KEM_free'\r\nextensions_clnt.c:(.text+0x3d77): undefined reference to `OQS_KEM_decaps'\r\n/usr/local/openssl/.openssl/lib/libssl.a(extensions_srvr.o): In function `tls_construct_stoc_key_share':\r\nextensions_srvr.c:(.text+0x3769): undefined reference to `OQS_KEM_new'\r\nextensions_srvr.c:(.text+0x37be): undefined reference to `OQS_KEM_encaps'\r\nextensions_srvr.c:(.text+0x3906): undefined reference to `OQS_MEM_secure_free'\r\nextensions_srvr.c:(.text+0x390e): undefined reference to `OQS_KEM_free'\r\nextensions_srvr.c:(.text+0x3aeb): undefined reference to `OQS_MEM_secure_free'\r\nextensions_srvr.c:(.text+0x3af3): undefined reference to `OQS_KEM_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `pkey_oqs_digestverify':\r\noqs_meth.c:(.text+0x101): undefined reference to `OQS_SIG_verify'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `pkey_oqs_digestsign':\r\noqs_meth.c:(.text+0x62f): undefined reference to `OQS_SIG_sign'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_free':\r\noqs_meth.c:(.text+0x1d0e): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_key_init':\r\noqs_meth.c:(.text+0x1df9): undefined reference to `OQS_SIG_new'\r\noqs_meth.c:(.text+0x1f30): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_priv_decode':\r\noqs_meth.c:(.text+0x22f6): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `pkey_oqs_keygen':\r\noqs_meth.c:(.text+0x2528): undefined reference to `OQS_SIG_new'\r\noqs_meth.c:(.text+0x273c): undefined reference to `OQS_SIG_keypair'\r\noqs_meth.c:(.text+0x2778): undefined reference to `OQS_SIG_free'\r\noqs_meth.c:(.text+0x2810): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_pub_decode':\r\noqs_meth.c:(.text+0x2b6a): undefined reference to `OQS_SIG_free'\r\ncollect2: error: ld returned 1 exit status\r\nobjs/Makefile:323: recipe for target 'objs/nginx' failed\r\nmake[1]: Leaving directory '/nginx-1.15.11'\r\nmake[1]: *** [objs/nginx] Error 1\r\nMakefile:8: recipe for target 'build' failed\r\nmake: *** [build] Error 2\r\n\r\n\r\nThanks!"},"comment":{"url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/comments/515064290","html_url":"https://github.com/open-quantum-safe/openssl/issues/103#issuecomment-515064290","issue_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103","id":515064290,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNTA2NDI5MA==","user":{"login":"RicardoGaGu","id":25283073,"node_id":"MDQ6VXNlcjI1MjgzMDcz","avatar_url":"https://avatars3.githubusercontent.com/u/25283073?v=4","gravatar_id":"","url":"https://api.github.com/users/RicardoGaGu","html_url":"https://github.com/RicardoGaGu","followers_url":"https://api.github.com/users/RicardoGaGu/followers","following_url":"https://api.github.com/users/RicardoGaGu/following{/other_user}","gists_url":"https://api.github.com/users/RicardoGaGu/gists{/gist_id}","starred_url":"https://api.github.com/users/RicardoGaGu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RicardoGaGu/subscriptions","organizations_url":"https://api.github.com/users/RicardoGaGu/orgs","repos_url":"https://api.github.com/users/RicardoGaGu/repos","events_url":"https://api.github.com/users/RicardoGaGu/events{/privacy}","received_events_url":"https://api.github.com/users/RicardoGaGu/received_events","type":"User","site_admin":false},"created_at":"2019-07-25T14:23:11Z","updated_at":"2019-07-25T14:23:11Z","author_association":"NONE","body":"Okay, many thanks, any kind of feedback is appreciated. I'd be around and I will also get back to you if I find a solution to this."}},"public":true,"created_at":"2019-07-25T14:23:12Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
{"id":"10083819245","type":"IssueCommentEvent","actor":{"id":8843219,"login":"dstebila","display_login":"dstebila","gravatar_id":"","url":"https://api.github.com/users/dstebila","avatar_url":"https://avatars.githubusercontent.com/u/8843219?"},"repo":{"id":66578799,"name":"open-quantum-safe/openssl","url":"https://api.github.com/repos/open-quantum-safe/openssl"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103","repository_url":"https://api.github.com/repos/open-quantum-safe/openssl","labels_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103/comments","events_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103/events","html_url":"https://github.com/open-quantum-safe/openssl/issues/103","id":472766958,"node_id":"MDU6SXNzdWU0NzI3NjY5NTg=","number":103,"title":"Failing to compile NGINX with PQ openssl fork","user":{"login":"RicardoGaGu","id":25283073,"node_id":"MDQ6VXNlcjI1MjgzMDcz","avatar_url":"https://avatars3.githubusercontent.com/u/25283073?v=4","gravatar_id":"","url":"https://api.github.com/users/RicardoGaGu","html_url":"https://github.com/RicardoGaGu","followers_url":"https://api.github.com/users/RicardoGaGu/followers","following_url":"https://api.github.com/users/RicardoGaGu/following{/other_user}","gists_url":"https://api.github.com/users/RicardoGaGu/gists{/gist_id}","starred_url":"https://api.github.com/users/RicardoGaGu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RicardoGaGu/subscriptions","organizations_url":"https://api.github.com/users/RicardoGaGu/orgs","repos_url":"https://api.github.com/users/RicardoGaGu/repos","events_url":"https://api.github.com/users/RicardoGaGu/events{/privacy}","received_events_url":"https://api.github.com/users/RicardoGaGu/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2019-07-25T09:42:07Z","updated_at":"2019-07-25T14:26:21Z","closed_at":null,"author_association":"NONE","body":"HI! I'm trying to compile the PQ OpenSSL fork into NGINX, I've run into some problems when building nginx wirth openssl underneath. I'll show my Dockerfile to clarify my procedure for installing Nginx. I have tested the TLS demo and works fine, but when configuring Nginx on Ubuntu 18.04 it fails. I kindly ask if anyone know how to solve this problem.\r\n\r\n```\r\nFROM ubuntu:18.04\r\n\r\n### Building NGINX from source with post quantum openssl for TLS connections\r\nRUN apt update && apt upgrade -y\r\nRUN apt install wget autoconf automake libtool libssl-dev make unzip xsltproc git -y\r\nRUN apt install build-essential -y\r\n\r\n### Step 1: Build required libraries: pcre, zlib and quantum safe openssl\r\n\r\n### PCRE\r\nRUN wget ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.42.tar.gz && \\\r\n tar -zxf pcre-8.42.tar.gz && \\\r\n cd pcre-8.42 && \\\r\n ./configure && \\\r\n make && \\\r\n make install\r\n### ZLIB\r\nRUN wget http://zlib.net/zlib-1.2.11.tar.gz && \\\r\n tar -zxf zlib-1.2.11.tar.gz && \\\r\n cd zlib-1.2.11 && \\\r\n ./configure && \\\r\n make && \\\r\n make install\r\n\r\n\r\n### Install liboqs\r\nWORKDIR /usr/local/\r\n\r\nRUN git clone --branch OQS-OpenSSL_1_1_1-stable https://github.com/open-quantum-safe/openssl.git\r\n\r\nRUN git clone --branch master https://github.com/open-quantum-safe/liboqs.git\r\n\r\nWORKDIR /usr/local/liboqs\r\nRUN autoreconf -i\r\nRUN ./configure --prefix=/usr/local/openssl/oqs --enable-shared=no\r\nRUN make -j\r\nRUN make install\r\n\r\n### Install openssl\r\nWORKDIR /usr/local/openssl\r\nRUN ./config --prefix=/usr/local/openssl -Wl,-rpath -Wl,/usr/local/openssl/oqs/lib\r\nRUN make -j\r\n\r\nRUN cp libcrypto.so.1.1 ./oqs/lib\r\nRUN cp libssl.so.1.1 ./oqs/lib\r\n\r\nWORKDIR /\r\n\r\n### Step 2: Download NGINX and RTMP module\r\nRUN wget https://nginx.org/download/nginx-1.15.11.tar.gz && \\\r\n tar zxf nginx-1.15.11.tar.gz\r\n\r\nRUN wget https://github.com/arut/nginx-rtmp-module/archive/master.zip && \\\r\n unzip master.zip\r\n\r\nRUN rm -rf *.tar.gz\r\n\r\n### Step 3: Build and install NGINX\r\nRUN wget https://nginx.org/download/nginx-1.15.11.tar.gz && \\\r\n tar zxf nginx-1.15.11.tar.gz\r\n\r\nRUN   cd nginx-1.15.11 && ./configure \\\r\n--with-cc-opt=\"-I /usr/local/openssl/oqs/include/\" \\\r\n--with-ld-opt=\"-L /usr/local/openssl/oqs/lib/\"\\\r\n--sbin-path=/usr/local/nginx/nginx \\\r\n--conf-path=/usr/local/nginx/nginx.conf \\\r\n--pid-path=/usr/local/nginx/nginx.pid \\\r\n--with-pcre=../pcre-8.42 \\\r\n--with-zlib=../zlib-1.2.11 \\\r\n--with-openssl=/usr/local/openssl \\\r\n--with-http_ssl_module \\\r\n--with-stream \\\r\n--with-mail=dynamic \\\r\n--add-module=/nginx-rtmp-module-master && \\\r\nmake && \\\r\nmake install\r\n```\r\n\r\nThe error is the following:\r\n\r\n/usr/local/openssl/.openssl/lib/libssl.a(s3_lib.o): In function `ssl3_clear':\r\ns3_lib.c:(.text+0x51b): undefined reference to `OQS_KEM_free'\r\n/usr/local/openssl/.openssl/lib/libssl.a(extensions_clnt.o): In function `tls_construct_ctos_key_share':\r\nextensions_clnt.c:(.text+0x18af): undefined reference to `OQS_KEM_new'\r\nextensions_clnt.c:(.text+0x1952): undefined reference to `OQS_KEM_keypair'\r\nextensions_clnt.c:(.text+0x199c): undefined reference to `OQS_MEM_secure_free'\r\nextensions_clnt.c:(.text+0x19a4): undefined reference to `OQS_MEM_insecure_free'\r\nextensions_clnt.c:(.text+0x19c2): undefined reference to `OQS_KEM_free'\r\n/usr/local/openssl/.openssl/lib/libssl.a(extensions_clnt.o): In function `tls_parse_stoc_key_share':\r\nextensions_clnt.c:(.text+0x3c96): undefined reference to `OQS_MEM_secure_free'\r\nextensions_clnt.c:(.text+0x3cb4): undefined reference to `OQS_MEM_secure_free'\r\nextensions_clnt.c:(.text+0x3cd2): undefined reference to `OQS_KEM_free'\r\nextensions_clnt.c:(.text+0x3d77): undefined reference to `OQS_KEM_decaps'\r\n/usr/local/openssl/.openssl/lib/libssl.a(extensions_srvr.o): In function `tls_construct_stoc_key_share':\r\nextensions_srvr.c:(.text+0x3769): undefined reference to `OQS_KEM_new'\r\nextensions_srvr.c:(.text+0x37be): undefined reference to `OQS_KEM_encaps'\r\nextensions_srvr.c:(.text+0x3906): undefined reference to `OQS_MEM_secure_free'\r\nextensions_srvr.c:(.text+0x390e): undefined reference to `OQS_KEM_free'\r\nextensions_srvr.c:(.text+0x3aeb): undefined reference to `OQS_MEM_secure_free'\r\nextensions_srvr.c:(.text+0x3af3): undefined reference to `OQS_KEM_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `pkey_oqs_digestverify':\r\noqs_meth.c:(.text+0x101): undefined reference to `OQS_SIG_verify'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `pkey_oqs_digestsign':\r\noqs_meth.c:(.text+0x62f): undefined reference to `OQS_SIG_sign'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_free':\r\noqs_meth.c:(.text+0x1d0e): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_key_init':\r\noqs_meth.c:(.text+0x1df9): undefined reference to `OQS_SIG_new'\r\noqs_meth.c:(.text+0x1f30): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_priv_decode':\r\noqs_meth.c:(.text+0x22f6): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `pkey_oqs_keygen':\r\noqs_meth.c:(.text+0x2528): undefined reference to `OQS_SIG_new'\r\noqs_meth.c:(.text+0x273c): undefined reference to `OQS_SIG_keypair'\r\noqs_meth.c:(.text+0x2778): undefined reference to `OQS_SIG_free'\r\noqs_meth.c:(.text+0x2810): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_pub_decode':\r\noqs_meth.c:(.text+0x2b6a): undefined reference to `OQS_SIG_free'\r\ncollect2: error: ld returned 1 exit status\r\nobjs/Makefile:323: recipe for target 'objs/nginx' failed\r\nmake[1]: Leaving directory '/nginx-1.15.11'\r\nmake[1]: *** [objs/nginx] Error 1\r\nMakefile:8: recipe for target 'build' failed\r\nmake: *** [build] Error 2\r\n\r\n\r\nThanks!"},"comment":{"url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/comments/515065580","html_url":"https://github.com/open-quantum-safe/openssl/issues/103#issuecomment-515065580","issue_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103","id":515065580,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNTA2NTU4MA==","user":{"login":"dstebila","id":8843219,"node_id":"MDQ6VXNlcjg4NDMyMTk=","avatar_url":"https://avatars0.githubusercontent.com/u/8843219?v=4","gravatar_id":"","url":"https://api.github.com/users/dstebila","html_url":"https://github.com/dstebila","followers_url":"https://api.github.com/users/dstebila/followers","following_url":"https://api.github.com/users/dstebila/following{/other_user}","gists_url":"https://api.github.com/users/dstebila/gists{/gist_id}","starred_url":"https://api.github.com/users/dstebila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dstebila/subscriptions","organizations_url":"https://api.github.com/users/dstebila/orgs","repos_url":"https://api.github.com/users/dstebila/repos","events_url":"https://api.github.com/users/dstebila/events{/privacy}","received_events_url":"https://api.github.com/users/dstebila/received_events","type":"User","site_admin":false},"created_at":"2019-07-25T14:26:21Z","updated_at":"2019-07-25T14:26:21Z","author_association":"MEMBER","body":"Sometimes order matters.  Can you try to see if there's any way to get the `-loqs` argument to appear after the libcrypto.a?"}},"public":true,"created_at":"2019-07-25T14:26:21Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
{"id":"10084643339","type":"IssueCommentEvent","actor":{"id":16247285,"login":"christianpaquin","display_login":"christianpaquin","gravatar_id":"","url":"https://api.github.com/users/christianpaquin","avatar_url":"https://avatars.githubusercontent.com/u/16247285?"},"repo":{"id":66578799,"name":"open-quantum-safe/openssl","url":"https://api.github.com/repos/open-quantum-safe/openssl"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103","repository_url":"https://api.github.com/repos/open-quantum-safe/openssl","labels_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103/comments","events_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103/events","html_url":"https://github.com/open-quantum-safe/openssl/issues/103","id":472766958,"node_id":"MDU6SXNzdWU0NzI3NjY5NTg=","number":103,"title":"Failing to compile NGINX with PQ openssl fork","user":{"login":"RicardoGaGu","id":25283073,"node_id":"MDQ6VXNlcjI1MjgzMDcz","avatar_url":"https://avatars3.githubusercontent.com/u/25283073?v=4","gravatar_id":"","url":"https://api.github.com/users/RicardoGaGu","html_url":"https://github.com/RicardoGaGu","followers_url":"https://api.github.com/users/RicardoGaGu/followers","following_url":"https://api.github.com/users/RicardoGaGu/following{/other_user}","gists_url":"https://api.github.com/users/RicardoGaGu/gists{/gist_id}","starred_url":"https://api.github.com/users/RicardoGaGu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RicardoGaGu/subscriptions","organizations_url":"https://api.github.com/users/RicardoGaGu/orgs","repos_url":"https://api.github.com/users/RicardoGaGu/repos","events_url":"https://api.github.com/users/RicardoGaGu/events{/privacy}","received_events_url":"https://api.github.com/users/RicardoGaGu/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2019-07-25T09:42:07Z","updated_at":"2019-07-25T16:06:54Z","closed_at":null,"author_association":"NONE","body":"HI! I'm trying to compile the PQ OpenSSL fork into NGINX, I've run into some problems when building nginx wirth openssl underneath. I'll show my Dockerfile to clarify my procedure for installing Nginx. I have tested the TLS demo and works fine, but when configuring Nginx on Ubuntu 18.04 it fails. I kindly ask if anyone know how to solve this problem.\r\n\r\n```\r\nFROM ubuntu:18.04\r\n\r\n### Building NGINX from source with post quantum openssl for TLS connections\r\nRUN apt update && apt upgrade -y\r\nRUN apt install wget autoconf automake libtool libssl-dev make unzip xsltproc git -y\r\nRUN apt install build-essential -y\r\n\r\n### Step 1: Build required libraries: pcre, zlib and quantum safe openssl\r\n\r\n### PCRE\r\nRUN wget ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.42.tar.gz && \\\r\n tar -zxf pcre-8.42.tar.gz && \\\r\n cd pcre-8.42 && \\\r\n ./configure && \\\r\n make && \\\r\n make install\r\n### ZLIB\r\nRUN wget http://zlib.net/zlib-1.2.11.tar.gz && \\\r\n tar -zxf zlib-1.2.11.tar.gz && \\\r\n cd zlib-1.2.11 && \\\r\n ./configure && \\\r\n make && \\\r\n make install\r\n\r\n\r\n### Install liboqs\r\nWORKDIR /usr/local/\r\n\r\nRUN git clone --branch OQS-OpenSSL_1_1_1-stable https://github.com/open-quantum-safe/openssl.git\r\n\r\nRUN git clone --branch master https://github.com/open-quantum-safe/liboqs.git\r\n\r\nWORKDIR /usr/local/liboqs\r\nRUN autoreconf -i\r\nRUN ./configure --prefix=/usr/local/openssl/oqs --enable-shared=no\r\nRUN make -j\r\nRUN make install\r\n\r\n### Install openssl\r\nWORKDIR /usr/local/openssl\r\nRUN ./config --prefix=/usr/local/openssl -Wl,-rpath -Wl,/usr/local/openssl/oqs/lib\r\nRUN make -j\r\n\r\nRUN cp libcrypto.so.1.1 ./oqs/lib\r\nRUN cp libssl.so.1.1 ./oqs/lib\r\n\r\nWORKDIR /\r\n\r\n### Step 2: Download NGINX and RTMP module\r\nRUN wget https://nginx.org/download/nginx-1.15.11.tar.gz && \\\r\n tar zxf nginx-1.15.11.tar.gz\r\n\r\nRUN wget https://github.com/arut/nginx-rtmp-module/archive/master.zip && \\\r\n unzip master.zip\r\n\r\nRUN rm -rf *.tar.gz\r\n\r\n### Step 3: Build and install NGINX\r\nRUN wget https://nginx.org/download/nginx-1.15.11.tar.gz && \\\r\n tar zxf nginx-1.15.11.tar.gz\r\n\r\nRUN   cd nginx-1.15.11 && ./configure \\\r\n--with-cc-opt=\"-I /usr/local/openssl/oqs/include/\" \\\r\n--with-ld-opt=\"-L /usr/local/openssl/oqs/lib/\"\\\r\n--sbin-path=/usr/local/nginx/nginx \\\r\n--conf-path=/usr/local/nginx/nginx.conf \\\r\n--pid-path=/usr/local/nginx/nginx.pid \\\r\n--with-pcre=../pcre-8.42 \\\r\n--with-zlib=../zlib-1.2.11 \\\r\n--with-openssl=/usr/local/openssl \\\r\n--with-http_ssl_module \\\r\n--with-stream \\\r\n--with-mail=dynamic \\\r\n--add-module=/nginx-rtmp-module-master && \\\r\nmake && \\\r\nmake install\r\n```\r\n\r\nThe error is the following:\r\n\r\n/usr/local/openssl/.openssl/lib/libssl.a(s3_lib.o): In function `ssl3_clear':\r\ns3_lib.c:(.text+0x51b): undefined reference to `OQS_KEM_free'\r\n/usr/local/openssl/.openssl/lib/libssl.a(extensions_clnt.o): In function `tls_construct_ctos_key_share':\r\nextensions_clnt.c:(.text+0x18af): undefined reference to `OQS_KEM_new'\r\nextensions_clnt.c:(.text+0x1952): undefined reference to `OQS_KEM_keypair'\r\nextensions_clnt.c:(.text+0x199c): undefined reference to `OQS_MEM_secure_free'\r\nextensions_clnt.c:(.text+0x19a4): undefined reference to `OQS_MEM_insecure_free'\r\nextensions_clnt.c:(.text+0x19c2): undefined reference to `OQS_KEM_free'\r\n/usr/local/openssl/.openssl/lib/libssl.a(extensions_clnt.o): In function `tls_parse_stoc_key_share':\r\nextensions_clnt.c:(.text+0x3c96): undefined reference to `OQS_MEM_secure_free'\r\nextensions_clnt.c:(.text+0x3cb4): undefined reference to `OQS_MEM_secure_free'\r\nextensions_clnt.c:(.text+0x3cd2): undefined reference to `OQS_KEM_free'\r\nextensions_clnt.c:(.text+0x3d77): undefined reference to `OQS_KEM_decaps'\r\n/usr/local/openssl/.openssl/lib/libssl.a(extensions_srvr.o): In function `tls_construct_stoc_key_share':\r\nextensions_srvr.c:(.text+0x3769): undefined reference to `OQS_KEM_new'\r\nextensions_srvr.c:(.text+0x37be): undefined reference to `OQS_KEM_encaps'\r\nextensions_srvr.c:(.text+0x3906): undefined reference to `OQS_MEM_secure_free'\r\nextensions_srvr.c:(.text+0x390e): undefined reference to `OQS_KEM_free'\r\nextensions_srvr.c:(.text+0x3aeb): undefined reference to `OQS_MEM_secure_free'\r\nextensions_srvr.c:(.text+0x3af3): undefined reference to `OQS_KEM_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `pkey_oqs_digestverify':\r\noqs_meth.c:(.text+0x101): undefined reference to `OQS_SIG_verify'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `pkey_oqs_digestsign':\r\noqs_meth.c:(.text+0x62f): undefined reference to `OQS_SIG_sign'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_free':\r\noqs_meth.c:(.text+0x1d0e): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_key_init':\r\noqs_meth.c:(.text+0x1df9): undefined reference to `OQS_SIG_new'\r\noqs_meth.c:(.text+0x1f30): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_priv_decode':\r\noqs_meth.c:(.text+0x22f6): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `pkey_oqs_keygen':\r\noqs_meth.c:(.text+0x2528): undefined reference to `OQS_SIG_new'\r\noqs_meth.c:(.text+0x273c): undefined reference to `OQS_SIG_keypair'\r\noqs_meth.c:(.text+0x2778): undefined reference to `OQS_SIG_free'\r\noqs_meth.c:(.text+0x2810): undefined reference to `OQS_SIG_free'\r\n/usr/local/openssl/.openssl/lib/libcrypto.a(oqs_meth.o): In function `oqs_pub_decode':\r\noqs_meth.c:(.text+0x2b6a): undefined reference to `OQS_SIG_free'\r\ncollect2: error: ld returned 1 exit status\r\nobjs/Makefile:323: recipe for target 'objs/nginx' failed\r\nmake[1]: Leaving directory '/nginx-1.15.11'\r\nmake[1]: *** [objs/nginx] Error 1\r\nMakefile:8: recipe for target 'build' failed\r\nmake: *** [build] Error 2\r\n\r\n\r\nThanks!"},"comment":{"url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/comments/515105501","html_url":"https://github.com/open-quantum-safe/openssl/issues/103#issuecomment-515105501","issue_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/103","id":515105501,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNTEwNTUwMQ==","user":{"login":"christianpaquin","id":16247285,"node_id":"MDQ6VXNlcjE2MjQ3Mjg1","avatar_url":"https://avatars0.githubusercontent.com/u/16247285?v=4","gravatar_id":"","url":"https://api.github.com/users/christianpaquin","html_url":"https://github.com/christianpaquin","followers_url":"https://api.github.com/users/christianpaquin/followers","following_url":"https://api.github.com/users/christianpaquin/following{/other_user}","gists_url":"https://api.github.com/users/christianpaquin/gists{/gist_id}","starred_url":"https://api.github.com/users/christianpaquin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/christianpaquin/subscriptions","organizations_url":"https://api.github.com/users/christianpaquin/orgs","repos_url":"https://api.github.com/users/christianpaquin/repos","events_url":"https://api.github.com/users/christianpaquin/events{/privacy}","received_events_url":"https://api.github.com/users/christianpaquin/received_events","type":"User","site_admin":false},"created_at":"2019-07-25T16:06:54Z","updated_at":"2019-07-25T16:06:54Z","author_association":"NONE","body":"I've successfully built nginx using the OpenSSL OQS fork; my process is [documented on our wiki](https://github.com/open-quantum-safe/openssl/wiki/Running-TLS-1.3-in-nginx). I've faced a few quirks as well; as documented on the page, I had to modify the obj/Makefile to remove invalid path to openssl, I've commented out the recompilation of openssl, and I added a liboqs.a directly. Let me know if that helps."}},"public":true,"created_at":"2019-07-25T16:06:54Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
