{"id":"13016438861","type":"IssueCommentEvent","actor":{"id":34063241,"login":"drucker-nir","display_login":"drucker-nir","gravatar_id":"","url":"https://api.github.com/users/drucker-nir","avatar_url":"https://avatars.githubusercontent.com/u/34063241?"},"repo":{"id":65514205,"name":"open-quantum-safe/liboqs","url":"https://api.github.com/repos/open-quantum-safe/liboqs"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/800","repository_url":"https://api.github.com/repos/open-quantum-safe/liboqs","labels_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/800/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/800/comments","events_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/800/events","html_url":"https://github.com/open-quantum-safe/liboqs/pull/800","id":665504406,"node_id":"MDExOlB1bGxSZXF1ZXN0NDU2NTU4MDk2","number":800,"title":"AES-NI bug fixes","user":{"login":"dstebila","id":8843219,"node_id":"MDQ6VXNlcjg4NDMyMTk=","avatar_url":"https://avatars0.githubusercontent.com/u/8843219?v=4","gravatar_id":"","url":"https://api.github.com/users/dstebila","html_url":"https://github.com/dstebila","followers_url":"https://api.github.com/users/dstebila/followers","following_url":"https://api.github.com/users/dstebila/following{/other_user}","gists_url":"https://api.github.com/users/dstebila/gists{/gist_id}","starred_url":"https://api.github.com/users/dstebila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dstebila/subscriptions","organizations_url":"https://api.github.com/users/dstebila/orgs","repos_url":"https://api.github.com/users/dstebila/repos","events_url":"https://api.github.com/users/dstebila/events{/privacy}","received_events_url":"https://api.github.com/users/dstebila/received_events","type":"User","site_admin":false},"labels":[{"id":423520874,"node_id":"MDU6TGFiZWw0MjM1MjA4NzQ=","url":"https://api.github.com/repos/open-quantum-safe/liboqs/labels/bug","name":"bug","color":"ee0701","default":true,"description":"Something isn't working"}],"state":"open","locked":false,"assignee":{"login":"dstebila","id":8843219,"node_id":"MDQ6VXNlcjg4NDMyMTk=","avatar_url":"https://avatars0.githubusercontent.com/u/8843219?v=4","gravatar_id":"","url":"https://api.github.com/users/dstebila","html_url":"https://github.com/dstebila","followers_url":"https://api.github.com/users/dstebila/followers","following_url":"https://api.github.com/users/dstebila/following{/other_user}","gists_url":"https://api.github.com/users/dstebila/gists{/gist_id}","starred_url":"https://api.github.com/users/dstebila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dstebila/subscriptions","organizations_url":"https://api.github.com/users/dstebila/orgs","repos_url":"https://api.github.com/users/dstebila/repos","events_url":"https://api.github.com/users/dstebila/events{/privacy}","received_events_url":"https://api.github.com/users/dstebila/received_events","type":"User","site_admin":false},"assignees":[{"login":"dstebila","id":8843219,"node_id":"MDQ6VXNlcjg4NDMyMTk=","avatar_url":"https://avatars0.githubusercontent.com/u/8843219?v=4","gravatar_id":"","url":"https://api.github.com/users/dstebila","html_url":"https://github.com/dstebila","followers_url":"https://api.github.com/users/dstebila/followers","following_url":"https://api.github.com/users/dstebila/following{/other_user}","gists_url":"https://api.github.com/users/dstebila/gists{/gist_id}","starred_url":"https://api.github.com/users/dstebila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dstebila/subscriptions","organizations_url":"https://api.github.com/users/dstebila/orgs","repos_url":"https://api.github.com/users/dstebila/repos","events_url":"https://api.github.com/users/dstebila/events{/privacy}","received_events_url":"https://api.github.com/users/dstebila/received_events","type":"User","site_admin":false}],"milestone":null,"comments":0,"created_at":"2020-07-25T03:21:13Z","updated_at":"2020-07-26T06:35:10Z","closed_at":null,"author_association":"MEMBER","active_lock_reason":null,"pull_request":{"url":"https://api.github.com/repos/open-quantum-safe/liboqs/pulls/800","html_url":"https://github.com/open-quantum-safe/liboqs/pull/800","diff_url":"https://github.com/open-quantum-safe/liboqs/pull/800.diff","patch_url":"https://github.com/open-quantum-safe/liboqs/pull/800.patch"},"body":"<!-- Please give a brief explanation of the purpose of this pull request. -->\r\nFixes a few bugs related to the introduction of AES-NI code.  In particular:\r\n\r\n- Makes sure the key schedule is actually being set for decryption.\r\n- Uses the type `__m128i` rather than `__m128i_u` since some compilers choke on the latter.\r\n- Notes in the API documentation that output arrays for AES must now be aligned to a 16-byte boundary, and applies this to BIKE.\r\n  - This was the cause of the BIKE crash in #799.\r\n  - Most AES calls in BIKE seemed to have been aligned, but the `sk_t` `sigma0->raw` and `sigma1->raw` members were not, which was causing the crash.  \r\n  - The solution I took for BIKE was to wrap the AES call in a wrapper that ensures it's always aligned [[aes_wrap.h, line 41]](https://github.com/open-quantum-safe/liboqs/pull/800/files#diff-c3f72798cb0514e552cfcdd92d68a116R41). I tried to keep the scope of the change relatively small, but this does come at a small performance penalty on all BIKE AES calls.  \r\n  - Just putting `ALIGN(16)` around the `r_t` type didn't work, as there are some subsequent routines that call sizeof on that struct, and adding ALIGN(16) apparently changes its size.  \r\n  - @drucker-nir, is my approach okay?  If you have a better solution, please go ahead, I'm not too experienced with alignment issues.\r\n\r\n<!-- Does this PR resolve any issue?  If so, please reference it using automatic-closing keywords like \"Fixes #123.\" -->\r\nFixes #799.\r\n\r\n<!-- Please answer the following questions to help manage version and changes across projects. -->\r\n\r\n* [No] Does this PR change the input/output behaviour of a cryptographic algorithm (i.e., does it change known answer test values)?  (If so, a version bump will be required from *x.y.z* to *x.(y+1).0*.)\r\n* [No] Does this PR change the the list of algorithms available -- either adding or removing?  (If so, PRs in OQS-OpenSSL, OQS-BoringSSL, and OQS-OpenSSH will also be required by the time this is merged.)\r\n\r\n<!-- Once your pull request is ready for review and passing continuous integration tests, please convert from a draft PR to a normal PR, and request a review from one of the OQS core team members. -->\r\n","performed_via_github_app":null},"comment":{"url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/comments/663942555","html_url":"https://github.com/open-quantum-safe/liboqs/pull/800#issuecomment-663942555","issue_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/800","id":663942555,"node_id":"MDEyOklzc3VlQ29tbWVudDY2Mzk0MjU1NQ==","user":{"login":"drucker-nir","id":34063241,"node_id":"MDQ6VXNlcjM0MDYzMjQx","avatar_url":"https://avatars0.githubusercontent.com/u/34063241?v=4","gravatar_id":"","url":"https://api.github.com/users/drucker-nir","html_url":"https://github.com/drucker-nir","followers_url":"https://api.github.com/users/drucker-nir/followers","following_url":"https://api.github.com/users/drucker-nir/following{/other_user}","gists_url":"https://api.github.com/users/drucker-nir/gists{/gist_id}","starred_url":"https://api.github.com/users/drucker-nir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/drucker-nir/subscriptions","organizations_url":"https://api.github.com/users/drucker-nir/orgs","repos_url":"https://api.github.com/users/drucker-nir/repos","events_url":"https://api.github.com/users/drucker-nir/events{/privacy}","received_events_url":"https://api.github.com/users/drucker-nir/received_events","type":"User","site_admin":false},"created_at":"2020-07-26T06:35:10Z","updated_at":"2020-07-26T06:35:10Z","author_association":"COLLABORATOR","body":"Overall, the change looks fine to me, but I wonder whether this is the best possible solution... \r\nIf you use `_mm_loadu_si128`/`_mm_storeu_si128` instead  of `_mm_load_si128`/`_mm_store_si128` in [here](https://github.com/open-quantum-safe/liboqs/blob/34ec4b83a7cff2f53e45b7f536a94fe07d7510c6/src/common/aes/aes256_ni.c#L107) similar to the code in [here](https://github.com/open-quantum-safe/liboqs/blob/34ec4b83a7cff2f53e45b7f536a94fe07d7510c6/src/common/aes/aes256_ni.c#L15). Then, \r\n1) Because `loadu` is already being used no pattern is broken - consistency.\r\n2) There is no need to limit the functions to only 16 bytes alignment inputs/outputs.\r\n3) Calling these functions is less prone to future mistakes by all schemes.\r\n4) Less lines of documentation, which may burden future users, are needed.","performed_via_github_app":null}},"public":true,"created_at":"2020-07-26T06:35:11Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
{"id":"13017490780","type":"IssueCommentEvent","actor":{"id":8843219,"login":"dstebila","display_login":"dstebila","gravatar_id":"","url":"https://api.github.com/users/dstebila","avatar_url":"https://avatars.githubusercontent.com/u/8843219?"},"repo":{"id":65514205,"name":"open-quantum-safe/liboqs","url":"https://api.github.com/repos/open-quantum-safe/liboqs"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/800","repository_url":"https://api.github.com/repos/open-quantum-safe/liboqs","labels_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/800/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/800/comments","events_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/800/events","html_url":"https://github.com/open-quantum-safe/liboqs/pull/800","id":665504406,"node_id":"MDExOlB1bGxSZXF1ZXN0NDU2NTU4MDk2","number":800,"title":"AES-NI bug fixes","user":{"login":"dstebila","id":8843219,"node_id":"MDQ6VXNlcjg4NDMyMTk=","avatar_url":"https://avatars0.githubusercontent.com/u/8843219?v=4","gravatar_id":"","url":"https://api.github.com/users/dstebila","html_url":"https://github.com/dstebila","followers_url":"https://api.github.com/users/dstebila/followers","following_url":"https://api.github.com/users/dstebila/following{/other_user}","gists_url":"https://api.github.com/users/dstebila/gists{/gist_id}","starred_url":"https://api.github.com/users/dstebila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dstebila/subscriptions","organizations_url":"https://api.github.com/users/dstebila/orgs","repos_url":"https://api.github.com/users/dstebila/repos","events_url":"https://api.github.com/users/dstebila/events{/privacy}","received_events_url":"https://api.github.com/users/dstebila/received_events","type":"User","site_admin":false},"labels":[{"id":423520874,"node_id":"MDU6TGFiZWw0MjM1MjA4NzQ=","url":"https://api.github.com/repos/open-quantum-safe/liboqs/labels/bug","name":"bug","color":"ee0701","default":true,"description":"Something isn't working"}],"state":"open","locked":false,"assignee":{"login":"dstebila","id":8843219,"node_id":"MDQ6VXNlcjg4NDMyMTk=","avatar_url":"https://avatars0.githubusercontent.com/u/8843219?v=4","gravatar_id":"","url":"https://api.github.com/users/dstebila","html_url":"https://github.com/dstebila","followers_url":"https://api.github.com/users/dstebila/followers","following_url":"https://api.github.com/users/dstebila/following{/other_user}","gists_url":"https://api.github.com/users/dstebila/gists{/gist_id}","starred_url":"https://api.github.com/users/dstebila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dstebila/subscriptions","organizations_url":"https://api.github.com/users/dstebila/orgs","repos_url":"https://api.github.com/users/dstebila/repos","events_url":"https://api.github.com/users/dstebila/events{/privacy}","received_events_url":"https://api.github.com/users/dstebila/received_events","type":"User","site_admin":false},"assignees":[{"login":"dstebila","id":8843219,"node_id":"MDQ6VXNlcjg4NDMyMTk=","avatar_url":"https://avatars0.githubusercontent.com/u/8843219?v=4","gravatar_id":"","url":"https://api.github.com/users/dstebila","html_url":"https://github.com/dstebila","followers_url":"https://api.github.com/users/dstebila/followers","following_url":"https://api.github.com/users/dstebila/following{/other_user}","gists_url":"https://api.github.com/users/dstebila/gists{/gist_id}","starred_url":"https://api.github.com/users/dstebila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dstebila/subscriptions","organizations_url":"https://api.github.com/users/dstebila/orgs","repos_url":"https://api.github.com/users/dstebila/repos","events_url":"https://api.github.com/users/dstebila/events{/privacy}","received_events_url":"https://api.github.com/users/dstebila/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2020-07-25T03:21:13Z","updated_at":"2020-07-26T12:45:59Z","closed_at":null,"author_association":"MEMBER","active_lock_reason":null,"pull_request":{"url":"https://api.github.com/repos/open-quantum-safe/liboqs/pulls/800","html_url":"https://github.com/open-quantum-safe/liboqs/pull/800","diff_url":"https://github.com/open-quantum-safe/liboqs/pull/800.diff","patch_url":"https://github.com/open-quantum-safe/liboqs/pull/800.patch"},"body":"<!-- Please give a brief explanation of the purpose of this pull request. -->\r\nFixes a few bugs related to the introduction of AES-NI code.  In particular:\r\n\r\n- Makes sure the key schedule is actually being set for decryption.\r\n- Uses the type `__m128i` rather than `__m128i_u` since some compilers choke on the latter.\r\n- Notes in the API documentation that output arrays for AES must now be aligned to a 16-byte boundary, and applies this to BIKE.\r\n  - This was the cause of the BIKE crash in #799.\r\n  - Most AES calls in BIKE seemed to have been aligned, but the `sk_t` `sigma0->raw` and `sigma1->raw` members were not, which was causing the crash.  \r\n  - The solution I took for BIKE was to wrap the AES call in a wrapper that ensures it's always aligned [[aes_wrap.h, line 41]](https://github.com/open-quantum-safe/liboqs/pull/800/files#diff-c3f72798cb0514e552cfcdd92d68a116R41). I tried to keep the scope of the change relatively small, but this does come at a small performance penalty on all BIKE AES calls.  \r\n  - Just putting `ALIGN(16)` around the `r_t` type didn't work, as there are some subsequent routines that call sizeof on that struct, and adding ALIGN(16) apparently changes its size.  \r\n  - @drucker-nir, is my approach okay?  If you have a better solution, please go ahead, I'm not too experienced with alignment issues.\r\n\r\n<!-- Does this PR resolve any issue?  If so, please reference it using automatic-closing keywords like \"Fixes #123.\" -->\r\nFixes #799.\r\n\r\n<!-- Please answer the following questions to help manage version and changes across projects. -->\r\n\r\n* [No] Does this PR change the input/output behaviour of a cryptographic algorithm (i.e., does it change known answer test values)?  (If so, a version bump will be required from *x.y.z* to *x.(y+1).0*.)\r\n* [No] Does this PR change the the list of algorithms available -- either adding or removing?  (If so, PRs in OQS-OpenSSL, OQS-BoringSSL, and OQS-OpenSSH will also be required by the time this is merged.)\r\n\r\n<!-- Once your pull request is ready for review and passing continuous integration tests, please convert from a draft PR to a normal PR, and request a review from one of the OQS core team members. -->\r\n","performed_via_github_app":null},"comment":{"url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/comments/663983517","html_url":"https://github.com/open-quantum-safe/liboqs/pull/800#issuecomment-663983517","issue_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/800","id":663983517,"node_id":"MDEyOklzc3VlQ29tbWVudDY2Mzk4MzUxNw==","user":{"login":"dstebila","id":8843219,"node_id":"MDQ6VXNlcjg4NDMyMTk=","avatar_url":"https://avatars0.githubusercontent.com/u/8843219?v=4","gravatar_id":"","url":"https://api.github.com/users/dstebila","html_url":"https://github.com/dstebila","followers_url":"https://api.github.com/users/dstebila/followers","following_url":"https://api.github.com/users/dstebila/following{/other_user}","gists_url":"https://api.github.com/users/dstebila/gists{/gist_id}","starred_url":"https://api.github.com/users/dstebila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dstebila/subscriptions","organizations_url":"https://api.github.com/users/dstebila/orgs","repos_url":"https://api.github.com/users/dstebila/repos","events_url":"https://api.github.com/users/dstebila/events{/privacy}","received_events_url":"https://api.github.com/users/dstebila/received_events","type":"User","site_admin":false},"created_at":"2020-07-26T12:45:59Z","updated_at":"2020-07-26T12:45:59Z","author_association":"MEMBER","body":"> If you use `_mm_loadu_si128`/`_mm_storeu_si128` instead of `_mm_load_si128`/`_mm_store_si128` in [here](https://github.com/open-quantum-safe/liboqs/blob/34ec4b83a7cff2f53e45b7f536a94fe07d7510c6/src/common/aes/aes256_ni.c#L107) similar to the code in [here](https://github.com/open-quantum-safe/liboqs/blob/34ec4b83a7cff2f53e45b7f536a94fe07d7510c6/src/common/aes/aes256_ni.c#L15). \r\n\r\nThank you so much @drucker-nir, that's exactly what I needed! I didn't know enough about SSE instructions to know about unaligned versus aligned load/store operations. Indeed it seemed weird that I was forcing a very internal detail (alignment) back on callers.  I've reverted the change in the BIKE AES wrapper.","performed_via_github_app":null}},"public":true,"created_at":"2020-07-26T12:45:59Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
