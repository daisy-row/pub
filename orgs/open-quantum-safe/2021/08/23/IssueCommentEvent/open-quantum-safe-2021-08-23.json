{"id":"17683908792","type":"IssueCommentEvent","actor":{"id":16247285,"login":"christianpaquin","display_login":"christianpaquin","gravatar_id":"","url":"https://api.github.com/users/christianpaquin","avatar_url":"https://avatars.githubusercontent.com/u/16247285?"},"repo":{"id":65514205,"name":"open-quantum-safe/liboqs","url":"https://api.github.com/repos/open-quantum-safe/liboqs"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/980","repository_url":"https://api.github.com/repos/open-quantum-safe/liboqs","labels_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/980/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/980/comments","events_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/980/events","html_url":"https://github.com/open-quantum-safe/liboqs/issues/980","id":870118280,"node_id":"MDU6SXNzdWU4NzAxMTgyODA=","number":980,"title":"Namespacing of SIKE constants","user":{"login":"jschanck","id":25615540,"node_id":"MDQ6VXNlcjI1NjE1NTQw","avatar_url":"https://avatars.githubusercontent.com/u/25615540?v=4","gravatar_id":"","url":"https://api.github.com/users/jschanck","html_url":"https://github.com/jschanck","followers_url":"https://api.github.com/users/jschanck/followers","following_url":"https://api.github.com/users/jschanck/following{/other_user}","gists_url":"https://api.github.com/users/jschanck/gists{/gist_id}","starred_url":"https://api.github.com/users/jschanck/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jschanck/subscriptions","organizations_url":"https://api.github.com/users/jschanck/orgs","repos_url":"https://api.github.com/users/jschanck/repos","events_url":"https://api.github.com/users/jschanck/events{/privacy}","received_events_url":"https://api.github.com/users/jschanck/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":{"login":"christianpaquin","id":16247285,"node_id":"MDQ6VXNlcjE2MjQ3Mjg1","avatar_url":"https://avatars.githubusercontent.com/u/16247285?v=4","gravatar_id":"","url":"https://api.github.com/users/christianpaquin","html_url":"https://github.com/christianpaquin","followers_url":"https://api.github.com/users/christianpaquin/followers","following_url":"https://api.github.com/users/christianpaquin/following{/other_user}","gists_url":"https://api.github.com/users/christianpaquin/gists{/gist_id}","starred_url":"https://api.github.com/users/christianpaquin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/christianpaquin/subscriptions","organizations_url":"https://api.github.com/users/christianpaquin/orgs","repos_url":"https://api.github.com/users/christianpaquin/repos","events_url":"https://api.github.com/users/christianpaquin/events{/privacy}","received_events_url":"https://api.github.com/users/christianpaquin/received_events","type":"User","site_admin":false},"assignees":[{"login":"christianpaquin","id":16247285,"node_id":"MDQ6VXNlcjE2MjQ3Mjg1","avatar_url":"https://avatars.githubusercontent.com/u/16247285?v=4","gravatar_id":"","url":"https://api.github.com/users/christianpaquin","html_url":"https://github.com/christianpaquin","followers_url":"https://api.github.com/users/christianpaquin/followers","following_url":"https://api.github.com/users/christianpaquin/following{/other_user}","gists_url":"https://api.github.com/users/christianpaquin/gists{/gist_id}","starred_url":"https://api.github.com/users/christianpaquin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/christianpaquin/subscriptions","organizations_url":"https://api.github.com/users/christianpaquin/orgs","repos_url":"https://api.github.com/users/christianpaquin/repos","events_url":"https://api.github.com/users/christianpaquin/events{/privacy}","received_events_url":"https://api.github.com/users/christianpaquin/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2021-04-28T16:12:29Z","updated_at":"2021-08-23T21:25:43Z","closed_at":null,"author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Compiling liboqs with SIKEp503-compressed enabled and SIKEp503 disabled (e.g. by compiling with `-DOQS_MINIMAL_BUILD=ON -DOQS_KEM_DEFAULT=OQS_KEM_alg_sike_p503_compressed`) results in undefined symbols at link time:\r\n```\r\n/usr/bin/ld: src/kem/sike/CMakeFiles/sike.dir/external/P503/AMD64/fp_x64_asm.S.o: relocation R_X86_64_PC32 against undefined symbol `oqs_kem_sike_p503x2' can not be used when making a shared object; recompile with -fPIC\r\n```\r\n\r\nThis is because of some namespacing that we add to the upstream code.\r\n\r\nBoth P503.c and P503_compressed.c define a symbol called `p503x2`. To avoid redefinition errors when building both parameter sets, we have some #defines that turn `p503x2` into `oqs_kem_sike_p503x2` and `oqs_kem_sike_compressed_p503x2`.\r\n\r\nThe problem is that `fp_x64_asm.S` only ever looks for `oqs_kem_sike_p503x2`: \r\n```asm\r\n    #define fmt(f)    oqs_kem_sike_##f\r\n    [...]\r\n    mov    rcx, [rip+fmt(p503x2)]\r\n```\r\n\r\nI suggest moving the constants from P503.c and P503_compressed.c to a new compilation unit. This will avoid the redefinition problem and reduce code size.","performed_via_github_app":null},"comment":{"url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/comments/904144603","html_url":"https://github.com/open-quantum-safe/liboqs/issues/980#issuecomment-904144603","issue_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/980","id":904144603,"node_id":"IC_kwDOA-eq3c415Cbb","user":{"login":"christianpaquin","id":16247285,"node_id":"MDQ6VXNlcjE2MjQ3Mjg1","avatar_url":"https://avatars.githubusercontent.com/u/16247285?v=4","gravatar_id":"","url":"https://api.github.com/users/christianpaquin","html_url":"https://github.com/christianpaquin","followers_url":"https://api.github.com/users/christianpaquin/followers","following_url":"https://api.github.com/users/christianpaquin/following{/other_user}","gists_url":"https://api.github.com/users/christianpaquin/gists{/gist_id}","starred_url":"https://api.github.com/users/christianpaquin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/christianpaquin/subscriptions","organizations_url":"https://api.github.com/users/christianpaquin/orgs","repos_url":"https://api.github.com/users/christianpaquin/repos","events_url":"https://api.github.com/users/christianpaquin/events{/privacy}","received_events_url":"https://api.github.com/users/christianpaquin/received_events","type":"User","site_admin":false},"created_at":"2021-08-23T21:25:43Z","updated_at":"2021-08-23T21:25:43Z","author_association":"CONTRIBUTOR","body":"I don't get the undefined symbol anymore (when configuring with `cmake -GNinja -DOQS_MINIMAL_BUILD=\"OQS_KEM_alg_sike_p503_compressed;OQS_ENABLE_SIG_dilithium_3\" ..`), but the `fp_x64_asm.S` indeed only uses the uncompressed constant in both cases. Both variants use the same constant values, so the right value is used, but we need to fix this to make the code clean. Discussing with @patricklonga to see if this should be done in OQS or upstream...","performed_via_github_app":null}},"public":true,"created_at":"2021-08-23T21:25:43Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
