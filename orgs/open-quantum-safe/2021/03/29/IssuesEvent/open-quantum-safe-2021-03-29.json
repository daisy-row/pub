{"id":"15724759069","type":"IssuesEvent","actor":{"id":75671533,"login":"IsTyping","display_login":"IsTyping","gravatar_id":"","url":"https://api.github.com/users/IsTyping","avatar_url":"https://avatars.githubusercontent.com/u/75671533?"},"repo":{"id":66578799,"name":"open-quantum-safe/openssl","url":"https://api.github.com/repos/open-quantum-safe/openssl"},"payload":{"action":"closed","issue":{"url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/294","repository_url":"https://api.github.com/repos/open-quantum-safe/openssl","labels_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/294/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/294/comments","events_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/294/events","html_url":"https://github.com/open-quantum-safe/openssl/issues/294","id":836797345,"node_id":"MDU6SXNzdWU4MzY3OTczNDU=","number":294,"title":"cannot generate self-signed root CA certificate","user":{"login":"IsTyping","id":75671533,"node_id":"MDQ6VXNlcjc1NjcxNTMz","avatar_url":"https://avatars.githubusercontent.com/u/75671533?v=4","gravatar_id":"","url":"https://api.github.com/users/IsTyping","html_url":"https://github.com/IsTyping","followers_url":"https://api.github.com/users/IsTyping/followers","following_url":"https://api.github.com/users/IsTyping/following{/other_user}","gists_url":"https://api.github.com/users/IsTyping/gists{/gist_id}","starred_url":"https://api.github.com/users/IsTyping/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IsTyping/subscriptions","organizations_url":"https://api.github.com/users/IsTyping/orgs","repos_url":"https://api.github.com/users/IsTyping/repos","events_url":"https://api.github.com/users/IsTyping/events{/privacy}","received_events_url":"https://api.github.com/users/IsTyping/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":13,"created_at":"2021-03-20T12:32:19Z","updated_at":"2021-03-29T09:11:09Z","closed_at":"2021-03-29T09:11:09Z","author_association":"NONE","active_lock_reason":null,"body":"I'm starting the TLS demmo on Ubuntu 18 with a shared library set up and these default algorithms announced: -DOQS_DEFAULT_GROUPS=\\\"CRYSTALS-kyber:FRODO:SABER\\\" . \r\nI try to generate the self signed certificate from my openssl-1.1.1 main directory with:\r\n\r\n`apps/openssl req -x509 -new -newkey kyber512 -keyout kyber512_CA.key -out kyber512_CA.crt -nodes -subj \"/CN=oqstest CA\" -days 365 -config apps/openssl.cnf`\r\n\r\nI get this error:\r\n\r\n`Can't load /root/.rnd into RNG\r\n140383120265664:error:2406F079:random number generator:RAND_load_file:Cannot open file:crypto/rand/randfile.c:88:Filename=/root/.rnd\r\nUnknown algorithm kyber512`\r\n\r\nThere is no such file /root/.rnd. \r\nIf I try the ECDSA certificate example I get the same error but instead of unknown algorithm it generates EC private key. \r\nI've followed quick start several times but cannot see where I've gone wrong.","performed_via_github_app":null}},"public":true,"created_at":"2021-03-29T09:11:10Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
{"id":"15729539840","type":"IssuesEvent","actor":{"id":8843219,"login":"dstebila","display_login":"dstebila","gravatar_id":"","url":"https://api.github.com/users/dstebila","avatar_url":"https://avatars.githubusercontent.com/u/8843219?"},"repo":{"id":66578799,"name":"open-quantum-safe/openssl","url":"https://api.github.com/repos/open-quantum-safe/openssl"},"payload":{"action":"closed","issue":{"url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/295","repository_url":"https://api.github.com/repos/open-quantum-safe/openssl","labels_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/295/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/295/comments","events_url":"https://api.github.com/repos/open-quantum-safe/openssl/issues/295/events","html_url":"https://github.com/open-quantum-safe/openssl/issues/295","id":837206565,"node_id":"MDU6SXNzdWU4MzcyMDY1NjU=","number":295,"title":"Issue when signing with new algorithms","user":{"login":"opencrypto","id":7943812,"node_id":"MDQ6VXNlcjc5NDM4MTI=","avatar_url":"https://avatars.githubusercontent.com/u/7943812?v=4","gravatar_id":"","url":"https://api.github.com/users/opencrypto","html_url":"https://github.com/opencrypto","followers_url":"https://api.github.com/users/opencrypto/followers","following_url":"https://api.github.com/users/opencrypto/following{/other_user}","gists_url":"https://api.github.com/users/opencrypto/gists{/gist_id}","starred_url":"https://api.github.com/users/opencrypto/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/opencrypto/subscriptions","organizations_url":"https://api.github.com/users/opencrypto/orgs","repos_url":"https://api.github.com/users/opencrypto/repos","events_url":"https://api.github.com/users/opencrypto/events{/privacy}","received_events_url":"https://api.github.com/users/opencrypto/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":16,"created_at":"2021-03-21T23:08:27Z","updated_at":"2021-03-29T14:57:47Z","closed_at":"2021-03-29T14:57:47Z","author_association":"NONE","active_lock_reason":null,"body":"Hello Everybody. I am trying to use the new algorithms in our wrapper library (LibPKI) that builds on top of OpenSSL. One thing I am having difficulties is to understand how to properly use the signing functions. \r\n\r\nSpecifically, I am trying to implement a generic signing function for DER encoded data (PKI_X509_sign(der (data), md (digest algor), evp_pkey) -> signature), and although the same functions work with RSA or ECDSA, they fail when I try with falcon, dilithium, or sphincs+.\r\n\r\nHere's the first code I tried:\r\n\r\n```\r\n// Creates the context\r\nif ((ctx = EVP_MD_CTX_create()) == NULL) {\r\n\tPKI_ERROR(PKI_ERR_MEMORY_ALLOC, NULL);\r\n\tif (out_mem) PKI_MEM_free(out_mem);\r\n\treturn NULL;\r\n}\r\n\r\n// Initializes the Context\r\nEVP_MD_CTX_init(ctx);\r\n\r\n// Initializes the Signature\r\nEVP_SignInit_ex(ctx, md, NULL);\r\nEVP_SignUpdate (ctx, der->data, der->size);\r\n\r\n// Finalizes the signature\r\nif (!EVP_SignFinal(ctx, out_mem->data, (unsigned int *) &ossl_ret, pkey))\r\n{\r\n\tPKI_ERROR(PKI_ERR_SIGNATURE_CREATE, \"Cannot finalize signature (%s)\", \r\n\t\tHSM_OPENSSL_get_errdesc(HSM_OPENSSL_get_errno(), NULL, 0));\r\n\r\n\tPKI_MEM_free(out_mem);\r\n\tout_mem = NULL;\r\n}\r\nelse out_mem->size = (size_t) ossl_ret;\r\n```\r\nI also tried the DigestSign version:\r\n```\r\n// Creates the context\r\nif ((ctx = EVP_MD_CTX_create()) == NULL) {\r\n\tPKI_ERROR(PKI_ERR_MEMORY_ALLOC, NULL);\r\n\tif (out_mem) PKI_MEM_free(out_mem);\r\n\treturn NULL;\r\n}\r\n\r\n// Initializes the Context\r\nEVP_MD_CTX_init(ctx);\r\n\r\nif (!EVP_DigestSignInit(ctx, &pCtx, md, NULL, pkey)) {\r\n    PKI_ERROR(PKI_ERR_SIGNATURE_CREATE, \"Cannot Initialize EVP_DigestSignInit()\");\r\n    goto err;\r\n}\r\n\r\nif (EVP_DigestSignUpdate(ctx, \r\n                                            der->data,\r\n   \t                                    der->size) <= 0) {\r\n   PKI_ERROR(PKI_ERR_SIGNATURE_CREATE, \"Cannot Update EVP_DigestSignUpdate()\");\r\n   goto err;\r\n}\r\n\r\nif (EVP_DigestSignFinal(ctx,\r\n                                        out_mem->data,\r\n                                        &ossl_ret) <= 0) {\r\n    PKI_ERROR(PKI_ERR_SIGNATURE_CREATE, \"Cannot Finalize EVP_DigestSignFinal()\");\r\n    goto err;\r\n}\r\nelse out_mem->size = (size_t) ossl_ret;\r\n```\r\nThe error seems to be related to the digest used (\"md\"). Specifically, if the md is not NULL, the EVP_SignFinal()/EVP_DigestSignFinal() fail with the following error trace:\r\n\r\n```\r\nMar 21 22:48:28 2021 GMT [91455] ERROR: [openssl_hsm.c:349] Can not create signature (117): Cannot finalize signature (  H??)\r\nMar 21 22:48:28 2021 GMT [91455] ERROR: [openssl_hsm.c:392] [HSM_OPENSSL_sign()] [ERROR] PKEY Type => 1294, falcon512\r\nMar 21 22:48:28 2021 GMT [91455] INFO: [openssl_hsm.c:395] [HSM_OPENSSL_sign()] [DEBUG]: [Signature Generated: 0 bytes (estimated: 690 bytes)]\r\nMar 21 22:48:28 2021 GMT [91455] INFO: [hsm_main.c:614] [PKI_sign()] [DEBUG]: Can not generate signature (returned from sign cb)\r\nMar 21 22:48:28 2021 GMT [91455] ERROR: [hsm_main.c:541] Can not create signature (117):\r\nMar 21 22:48:28 2021 GMT [91455] INFO: [pki_x509_req.c:222] [PKI_X509_REQ_new()] [DEBUG] REQ::ERROR 0 signing the Request [error:1012F0B1:elliptic curve routines:pkey_oqs_ctrl:wrong digest]\r\n```\r\nI know I am doing something wrong here, but I am not sure what... \r\n\r\nTo probe a bit further, I forced the use of a specific hashing algorithm - since the error was related to that, somehow: md = EVP_sha512(). If I do that, I get a success return code but the signature in the data is all zeroes.\r\n\r\n```\r\nMar 21 22:54:41 2021 GMT [97064] INFO: [pki_x509_req.c:61] [PKI_X509_REQ_new()] [DEBUG]: No Digest Associated with used algorithm\r\nMar 21 22:54:41 2021 GMT [97064] ERROR: [openssl_hsm.c:392] [HSM_OPENSSL_sign()] [ERROR] PKEY Type => 1294, falcon512\r\nMar 21 22:54:41 2021 GMT [97064] INFO: [openssl_hsm.c:395] [HSM_OPENSSL_sign()] [DEBUG]: [Signature Generated: 690 bytes (estimated: 690 bytes)]\r\n```\r\n\r\nJust to be very precise, when I use the standard apps/ tools (i.e., openssl req -new ...) I am able to generate things correctly.\r\n\r\nAnybody experiencing similar issues and/or know what I might be doing wrong?\r\n","performed_via_github_app":null}},"public":true,"created_at":"2021-03-29T14:57:47Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
{"id":"15730480312","type":"IssuesEvent","actor":{"id":13461061,"login":"jhfeng","display_login":"jhfeng","gravatar_id":"","url":"https://api.github.com/users/jhfeng","avatar_url":"https://avatars.githubusercontent.com/u/13461061?"},"repo":{"id":65514205,"name":"open-quantum-safe/liboqs","url":"https://api.github.com/repos/open-quantum-safe/liboqs"},"payload":{"action":"opened","issue":{"url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/952","repository_url":"https://api.github.com/repos/open-quantum-safe/liboqs","labels_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/952/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/952/comments","events_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/952/events","html_url":"https://github.com/open-quantum-safe/liboqs/issues/952","id":843513594,"node_id":"MDU6SXNzdWU4NDM1MTM1OTQ=","number":952,"title":"compilation fails with 0.5.0 branch with error OPENSSL_NO_EC2M - not found","user":{"login":"jhfeng","id":13461061,"node_id":"MDQ6VXNlcjEzNDYxMDYx","avatar_url":"https://avatars.githubusercontent.com/u/13461061?v=4","gravatar_id":"","url":"https://api.github.com/users/jhfeng","html_url":"https://github.com/jhfeng","followers_url":"https://api.github.com/users/jhfeng/followers","following_url":"https://api.github.com/users/jhfeng/following{/other_user}","gists_url":"https://api.github.com/users/jhfeng/gists{/gist_id}","starred_url":"https://api.github.com/users/jhfeng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhfeng/subscriptions","organizations_url":"https://api.github.com/users/jhfeng/orgs","repos_url":"https://api.github.com/users/jhfeng/repos","events_url":"https://api.github.com/users/jhfeng/events{/privacy}","received_events_url":"https://api.github.com/users/jhfeng/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2021-03-29T15:57:43Z","updated_at":"2021-03-29T15:57:43Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"When build with 0.5.0 code on Ubuntu 18.04\r\n\r\n```\r\nmkdir: created directory 'build'\r\n+ cd build\r\n+ cmake -DCMAKE_BUILD_TYPE=Release -DOQS_BUILD_ONLY_LIB=ON -DOQS_PORTABLE_BUILD=ON -DBUILD_SHARED_LIBS=OFF -DCMAKE_INSTALL_PREFIX=/usr/src/openssl/oqs ..\r\n-- The C compiler identification is GNU 7.5.0\r\n-- The ASM compiler identification is GNU\r\n-- Found assembler: /usr/bin/cc\r\n-- Check for working C compiler: /usr/bin/cc\r\n-- Check for working C compiler: /usr/bin/cc -- works\r\n-- Detecting C compiler ABI info\r\n-- Detecting C compiler ABI info - done\r\n-- Detecting C compile features\r\n-- Detecting C compile features - done\r\n-- Found OpenSSL: /usr/lib/x86_64-linux-gnu/libcrypto.so (found suitable version \"1.1.1\", minimum required is \"1.1.1\") \r\n**-- Looking for OPENSSL_NO_EC2M\r\n-- Looking for OPENSSL_NO_EC2M - not found\r\nCMake Error at src/CMakeLists.txt:82 (target_link_options):\r\n  Unknown CMake command \"target_link_options\".**\r\n\r\n\r\n-- Configuring incomplete, errors occurred!\r\nSee also \"/usr/src/liboqs/build/CMakeFiles/CMakeOutput.log\".\r\nSee also \"/usr/src/liboqs/build/CMakeFiles/CMakeError.log\".\r\n```\r\n\r\nBUT, the compilation works with `main` branch code.  ","performed_via_github_app":null}},"public":true,"created_at":"2021-03-29T15:57:43Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
{"id":"15730946825","type":"IssuesEvent","actor":{"id":13461061,"login":"jhfeng","display_login":"jhfeng","gravatar_id":"","url":"https://api.github.com/users/jhfeng","avatar_url":"https://avatars.githubusercontent.com/u/13461061?"},"repo":{"id":65514205,"name":"open-quantum-safe/liboqs","url":"https://api.github.com/repos/open-quantum-safe/liboqs"},"payload":{"action":"closed","issue":{"url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/952","repository_url":"https://api.github.com/repos/open-quantum-safe/liboqs","labels_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/952/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/952/comments","events_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/952/events","html_url":"https://github.com/open-quantum-safe/liboqs/issues/952","id":843513594,"node_id":"MDU6SXNzdWU4NDM1MTM1OTQ=","number":952,"title":"compilation fails with 0.5.0 branch with error OPENSSL_NO_EC2M - not found","user":{"login":"jhfeng","id":13461061,"node_id":"MDQ6VXNlcjEzNDYxMDYx","avatar_url":"https://avatars.githubusercontent.com/u/13461061?v=4","gravatar_id":"","url":"https://api.github.com/users/jhfeng","html_url":"https://github.com/jhfeng","followers_url":"https://api.github.com/users/jhfeng/followers","following_url":"https://api.github.com/users/jhfeng/following{/other_user}","gists_url":"https://api.github.com/users/jhfeng/gists{/gist_id}","starred_url":"https://api.github.com/users/jhfeng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhfeng/subscriptions","organizations_url":"https://api.github.com/users/jhfeng/orgs","repos_url":"https://api.github.com/users/jhfeng/repos","events_url":"https://api.github.com/users/jhfeng/events{/privacy}","received_events_url":"https://api.github.com/users/jhfeng/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2021-03-29T15:57:43Z","updated_at":"2021-03-29T16:29:22Z","closed_at":"2021-03-29T16:29:22Z","author_association":"NONE","active_lock_reason":null,"body":"When build with 0.5.0 code on Ubuntu 18.04\r\n\r\n```\r\nmkdir: created directory 'build'\r\n+ cd build\r\n+ cmake -DCMAKE_BUILD_TYPE=Release -DOQS_BUILD_ONLY_LIB=ON -DOQS_PORTABLE_BUILD=ON -DBUILD_SHARED_LIBS=OFF -DCMAKE_INSTALL_PREFIX=/usr/src/openssl/oqs ..\r\n-- The C compiler identification is GNU 7.5.0\r\n-- The ASM compiler identification is GNU\r\n-- Found assembler: /usr/bin/cc\r\n-- Check for working C compiler: /usr/bin/cc\r\n-- Check for working C compiler: /usr/bin/cc -- works\r\n-- Detecting C compiler ABI info\r\n-- Detecting C compiler ABI info - done\r\n-- Detecting C compile features\r\n-- Detecting C compile features - done\r\n-- Found OpenSSL: /usr/lib/x86_64-linux-gnu/libcrypto.so (found suitable version \"1.1.1\", minimum required is \"1.1.1\") \r\n**-- Looking for OPENSSL_NO_EC2M\r\n-- Looking for OPENSSL_NO_EC2M - not found\r\nCMake Error at src/CMakeLists.txt:82 (target_link_options):\r\n  Unknown CMake command \"target_link_options\".**\r\n\r\n\r\n-- Configuring incomplete, errors occurred!\r\nSee also \"/usr/src/liboqs/build/CMakeFiles/CMakeOutput.log\".\r\nSee also \"/usr/src/liboqs/build/CMakeFiles/CMakeError.log\".\r\n```\r\n\r\nBUT, the compilation works with `main` branch code.  ","performed_via_github_app":null}},"public":true,"created_at":"2021-03-29T16:29:22Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
