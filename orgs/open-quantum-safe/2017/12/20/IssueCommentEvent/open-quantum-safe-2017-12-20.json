{"id":"7013575627","type":"IssueCommentEvent","actor":{"id":8843219,"login":"dstebila","display_login":"dstebila","gravatar_id":"","url":"https://api.github.com/users/dstebila","avatar_url":"https://avatars.githubusercontent.com/u/8843219?"},"repo":{"id":65514205,"name":"open-quantum-safe/liboqs","url":"https://api.github.com/repos/open-quantum-safe/liboqs"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/200","repository_url":"https://api.github.com/repos/open-quantum-safe/liboqs","labels_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/200/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/200/comments","events_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/200/events","html_url":"https://github.com/open-quantum-safe/liboqs/issues/200","id":281906219,"number":200,"title":"Possible problem with Kyber public key generation","user":{"login":"Steppenwolfe65","id":8007343,"avatar_url":"https://avatars0.githubusercontent.com/u/8007343?v=4","gravatar_id":"","url":"https://api.github.com/users/Steppenwolfe65","html_url":"https://github.com/Steppenwolfe65","followers_url":"https://api.github.com/users/Steppenwolfe65/followers","following_url":"https://api.github.com/users/Steppenwolfe65/following{/other_user}","gists_url":"https://api.github.com/users/Steppenwolfe65/gists{/gist_id}","starred_url":"https://api.github.com/users/Steppenwolfe65/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Steppenwolfe65/subscriptions","organizations_url":"https://api.github.com/users/Steppenwolfe65/orgs","repos_url":"https://api.github.com/users/Steppenwolfe65/repos","events_url":"https://api.github.com/users/Steppenwolfe65/events{/privacy}","received_events_url":"https://api.github.com/users/Steppenwolfe65/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":{"login":"tlepoint","id":1345502,"avatar_url":"https://avatars3.githubusercontent.com/u/1345502?v=4","gravatar_id":"","url":"https://api.github.com/users/tlepoint","html_url":"https://github.com/tlepoint","followers_url":"https://api.github.com/users/tlepoint/followers","following_url":"https://api.github.com/users/tlepoint/following{/other_user}","gists_url":"https://api.github.com/users/tlepoint/gists{/gist_id}","starred_url":"https://api.github.com/users/tlepoint/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlepoint/subscriptions","organizations_url":"https://api.github.com/users/tlepoint/orgs","repos_url":"https://api.github.com/users/tlepoint/repos","events_url":"https://api.github.com/users/tlepoint/events{/privacy}","received_events_url":"https://api.github.com/users/tlepoint/received_events","type":"User","site_admin":false},"assignees":[{"login":"tlepoint","id":1345502,"avatar_url":"https://avatars3.githubusercontent.com/u/1345502?v=4","gravatar_id":"","url":"https://api.github.com/users/tlepoint","html_url":"https://github.com/tlepoint","followers_url":"https://api.github.com/users/tlepoint/followers","following_url":"https://api.github.com/users/tlepoint/following{/other_user}","gists_url":"https://api.github.com/users/tlepoint/gists{/gist_id}","starred_url":"https://api.github.com/users/tlepoint/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlepoint/subscriptions","organizations_url":"https://api.github.com/users/tlepoint/orgs","repos_url":"https://api.github.com/users/tlepoint/repos","events_url":"https://api.github.com/users/tlepoint/events{/privacy}","received_events_url":"https://api.github.com/users/tlepoint/received_events","type":"User","site_admin":false}],"milestone":null,"comments":6,"created_at":"2017-12-13T21:40:20Z","updated_at":"2017-12-20T14:57:19Z","closed_at":null,"author_association":"NONE","body":"Hi,\r\nI've noticed what might be a bug in the Kyber public key generation. \r\nIn the (indcpa.c) gen_matrix function, the three coefficient arrays (a) that are generated, appear to be identical. An incrementing domain code is used to initialize Keccak's state to unique values inside the inner loop, and a different domain code should yield a completely different output from SHAKE, even with the same seed, but in this case, the coefficient arrays produced are all identical. \r\nI have traced this to the (sha3.c) OQS_SHA3_cshake128_simple_absorb function. That function adds the domain code to the first state member, transforms the state, and then calls the keccak_absorb function, passing in the modified state. At the top of keccak_absorb, the state is *zeroed*, in effect, erasing the permuted domain code from the state, and hence the identical output is generated.\r\nCan someone confirm this?"},"comment":{"url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/comments/353084773","html_url":"https://github.com/open-quantum-safe/liboqs/issues/200#issuecomment-353084773","issue_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/200","id":353084773,"user":{"login":"dstebila","id":8843219,"avatar_url":"https://avatars0.githubusercontent.com/u/8843219?v=4","gravatar_id":"","url":"https://api.github.com/users/dstebila","html_url":"https://github.com/dstebila","followers_url":"https://api.github.com/users/dstebila/followers","following_url":"https://api.github.com/users/dstebila/following{/other_user}","gists_url":"https://api.github.com/users/dstebila/gists{/gist_id}","starred_url":"https://api.github.com/users/dstebila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dstebila/subscriptions","organizations_url":"https://api.github.com/users/dstebila/orgs","repos_url":"https://api.github.com/users/dstebila/repos","events_url":"https://api.github.com/users/dstebila/events{/privacy}","received_events_url":"https://api.github.com/users/dstebila/received_events","type":"User","site_admin":false},"created_at":"2017-12-20T14:57:19Z","updated_at":"2017-12-20T14:57:19Z","author_association":"OWNER","body":"I will also take a look at replacing the SHA-3 implementation -- even though Tancr√®de's new Kyber won't use it, others still do, so we definitely need to fix that.  John, do you have any recommendations for a C implementation?  One that comes to mind is the Keccak code package (https://keccak.team/software.html); for the NIST competition, NIST said that it would be part of the reference environment, so that seems promising."}},"public":true,"created_at":"2017-12-20T14:57:20Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
{"id":"7014006302","type":"IssueCommentEvent","actor":{"id":8007343,"login":"Steppenwolfe65","display_login":"Steppenwolfe65","gravatar_id":"","url":"https://api.github.com/users/Steppenwolfe65","avatar_url":"https://avatars.githubusercontent.com/u/8007343?"},"repo":{"id":65514205,"name":"open-quantum-safe/liboqs","url":"https://api.github.com/repos/open-quantum-safe/liboqs"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/200","repository_url":"https://api.github.com/repos/open-quantum-safe/liboqs","labels_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/200/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/200/comments","events_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/200/events","html_url":"https://github.com/open-quantum-safe/liboqs/issues/200","id":281906219,"number":200,"title":"Possible problem with Kyber public key generation","user":{"login":"Steppenwolfe65","id":8007343,"avatar_url":"https://avatars0.githubusercontent.com/u/8007343?v=4","gravatar_id":"","url":"https://api.github.com/users/Steppenwolfe65","html_url":"https://github.com/Steppenwolfe65","followers_url":"https://api.github.com/users/Steppenwolfe65/followers","following_url":"https://api.github.com/users/Steppenwolfe65/following{/other_user}","gists_url":"https://api.github.com/users/Steppenwolfe65/gists{/gist_id}","starred_url":"https://api.github.com/users/Steppenwolfe65/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Steppenwolfe65/subscriptions","organizations_url":"https://api.github.com/users/Steppenwolfe65/orgs","repos_url":"https://api.github.com/users/Steppenwolfe65/repos","events_url":"https://api.github.com/users/Steppenwolfe65/events{/privacy}","received_events_url":"https://api.github.com/users/Steppenwolfe65/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":{"login":"tlepoint","id":1345502,"avatar_url":"https://avatars3.githubusercontent.com/u/1345502?v=4","gravatar_id":"","url":"https://api.github.com/users/tlepoint","html_url":"https://github.com/tlepoint","followers_url":"https://api.github.com/users/tlepoint/followers","following_url":"https://api.github.com/users/tlepoint/following{/other_user}","gists_url":"https://api.github.com/users/tlepoint/gists{/gist_id}","starred_url":"https://api.github.com/users/tlepoint/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlepoint/subscriptions","organizations_url":"https://api.github.com/users/tlepoint/orgs","repos_url":"https://api.github.com/users/tlepoint/repos","events_url":"https://api.github.com/users/tlepoint/events{/privacy}","received_events_url":"https://api.github.com/users/tlepoint/received_events","type":"User","site_admin":false},"assignees":[{"login":"tlepoint","id":1345502,"avatar_url":"https://avatars3.githubusercontent.com/u/1345502?v=4","gravatar_id":"","url":"https://api.github.com/users/tlepoint","html_url":"https://github.com/tlepoint","followers_url":"https://api.github.com/users/tlepoint/followers","following_url":"https://api.github.com/users/tlepoint/following{/other_user}","gists_url":"https://api.github.com/users/tlepoint/gists{/gist_id}","starred_url":"https://api.github.com/users/tlepoint/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlepoint/subscriptions","organizations_url":"https://api.github.com/users/tlepoint/orgs","repos_url":"https://api.github.com/users/tlepoint/repos","events_url":"https://api.github.com/users/tlepoint/events{/privacy}","received_events_url":"https://api.github.com/users/tlepoint/received_events","type":"User","site_admin":false}],"milestone":null,"comments":7,"created_at":"2017-12-13T21:40:20Z","updated_at":"2017-12-20T16:16:45Z","closed_at":null,"author_association":"NONE","body":"Hi,\r\nI've noticed what might be a bug in the Kyber public key generation. \r\nIn the (indcpa.c) gen_matrix function, the three coefficient arrays (a) that are generated, appear to be identical. An incrementing domain code is used to initialize Keccak's state to unique values inside the inner loop, and a different domain code should yield a completely different output from SHAKE, even with the same seed, but in this case, the coefficient arrays produced are all identical. \r\nI have traced this to the (sha3.c) OQS_SHA3_cshake128_simple_absorb function. That function adds the domain code to the first state member, transforms the state, and then calls the keccak_absorb function, passing in the modified state. At the top of keccak_absorb, the state is *zeroed*, in effect, erasing the permuted domain code from the state, and hence the identical output is generated.\r\nCan someone confirm this?"},"comment":{"url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/comments/353108103","html_url":"https://github.com/open-quantum-safe/liboqs/issues/200#issuecomment-353108103","issue_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/200","id":353108103,"user":{"login":"Steppenwolfe65","id":8007343,"avatar_url":"https://avatars0.githubusercontent.com/u/8007343?v=4","gravatar_id":"","url":"https://api.github.com/users/Steppenwolfe65","html_url":"https://github.com/Steppenwolfe65","followers_url":"https://api.github.com/users/Steppenwolfe65/followers","following_url":"https://api.github.com/users/Steppenwolfe65/following{/other_user}","gists_url":"https://api.github.com/users/Steppenwolfe65/gists{/gist_id}","starred_url":"https://api.github.com/users/Steppenwolfe65/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Steppenwolfe65/subscriptions","organizations_url":"https://api.github.com/users/Steppenwolfe65/orgs","repos_url":"https://api.github.com/users/Steppenwolfe65/repos","events_url":"https://api.github.com/users/Steppenwolfe65/events{/privacy}","received_events_url":"https://api.github.com/users/Steppenwolfe65/received_events","type":"User","site_admin":false},"created_at":"2017-12-20T16:16:45Z","updated_at":"2017-12-20T16:16:45Z","author_association":"NONE","body":"Hi Douglas,\r\nI think replacing the implementation may be a bit of an over-reaction, I understand the impulse but.. I think it might be better to just rewrite it, and test Keccak (and SHAKE) with the official KATs. \r\nI can re-write this for you, including tests, if you think that would be helpful..\r\n\r\n@dsteblia While you are at it, AES should be tested with at least Fips197, and the modes with vectors from SP800-38a, and ChaCha with its official vectors as well. \r\n\r\n"}},"public":true,"created_at":"2017-12-20T16:16:45Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
{"id":"7015466434","type":"IssueCommentEvent","actor":{"id":8007343,"login":"Steppenwolfe65","display_login":"Steppenwolfe65","gravatar_id":"","url":"https://api.github.com/users/Steppenwolfe65","avatar_url":"https://avatars.githubusercontent.com/u/8007343?"},"repo":{"id":65514205,"name":"open-quantum-safe/liboqs","url":"https://api.github.com/repos/open-quantum-safe/liboqs"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/200","repository_url":"https://api.github.com/repos/open-quantum-safe/liboqs","labels_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/200/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/200/comments","events_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/200/events","html_url":"https://github.com/open-quantum-safe/liboqs/issues/200","id":281906219,"number":200,"title":"Possible problem with Kyber public key generation","user":{"login":"Steppenwolfe65","id":8007343,"avatar_url":"https://avatars0.githubusercontent.com/u/8007343?v=4","gravatar_id":"","url":"https://api.github.com/users/Steppenwolfe65","html_url":"https://github.com/Steppenwolfe65","followers_url":"https://api.github.com/users/Steppenwolfe65/followers","following_url":"https://api.github.com/users/Steppenwolfe65/following{/other_user}","gists_url":"https://api.github.com/users/Steppenwolfe65/gists{/gist_id}","starred_url":"https://api.github.com/users/Steppenwolfe65/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Steppenwolfe65/subscriptions","organizations_url":"https://api.github.com/users/Steppenwolfe65/orgs","repos_url":"https://api.github.com/users/Steppenwolfe65/repos","events_url":"https://api.github.com/users/Steppenwolfe65/events{/privacy}","received_events_url":"https://api.github.com/users/Steppenwolfe65/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":{"login":"tlepoint","id":1345502,"avatar_url":"https://avatars3.githubusercontent.com/u/1345502?v=4","gravatar_id":"","url":"https://api.github.com/users/tlepoint","html_url":"https://github.com/tlepoint","followers_url":"https://api.github.com/users/tlepoint/followers","following_url":"https://api.github.com/users/tlepoint/following{/other_user}","gists_url":"https://api.github.com/users/tlepoint/gists{/gist_id}","starred_url":"https://api.github.com/users/tlepoint/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlepoint/subscriptions","organizations_url":"https://api.github.com/users/tlepoint/orgs","repos_url":"https://api.github.com/users/tlepoint/repos","events_url":"https://api.github.com/users/tlepoint/events{/privacy}","received_events_url":"https://api.github.com/users/tlepoint/received_events","type":"User","site_admin":false},"assignees":[{"login":"tlepoint","id":1345502,"avatar_url":"https://avatars3.githubusercontent.com/u/1345502?v=4","gravatar_id":"","url":"https://api.github.com/users/tlepoint","html_url":"https://github.com/tlepoint","followers_url":"https://api.github.com/users/tlepoint/followers","following_url":"https://api.github.com/users/tlepoint/following{/other_user}","gists_url":"https://api.github.com/users/tlepoint/gists{/gist_id}","starred_url":"https://api.github.com/users/tlepoint/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlepoint/subscriptions","organizations_url":"https://api.github.com/users/tlepoint/orgs","repos_url":"https://api.github.com/users/tlepoint/repos","events_url":"https://api.github.com/users/tlepoint/events{/privacy}","received_events_url":"https://api.github.com/users/tlepoint/received_events","type":"User","site_admin":false}],"milestone":null,"comments":8,"created_at":"2017-12-13T21:40:20Z","updated_at":"2017-12-20T21:54:15Z","closed_at":null,"author_association":"NONE","body":"Hi,\r\nI've noticed what might be a bug in the Kyber public key generation. \r\nIn the (indcpa.c) gen_matrix function, the three coefficient arrays (a) that are generated, appear to be identical. An incrementing domain code is used to initialize Keccak's state to unique values inside the inner loop, and a different domain code should yield a completely different output from SHAKE, even with the same seed, but in this case, the coefficient arrays produced are all identical. \r\nI have traced this to the (sha3.c) OQS_SHA3_cshake128_simple_absorb function. That function adds the domain code to the first state member, transforms the state, and then calls the keccak_absorb function, passing in the modified state. At the top of keccak_absorb, the state is *zeroed*, in effect, erasing the permuted domain code from the state, and hence the identical output is generated.\r\nCan someone confirm this?"},"comment":{"url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/comments/353193441","html_url":"https://github.com/open-quantum-safe/liboqs/issues/200#issuecomment-353193441","issue_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/200","id":353193441,"user":{"login":"Steppenwolfe65","id":8007343,"avatar_url":"https://avatars0.githubusercontent.com/u/8007343?v=4","gravatar_id":"","url":"https://api.github.com/users/Steppenwolfe65","html_url":"https://github.com/Steppenwolfe65","followers_url":"https://api.github.com/users/Steppenwolfe65/followers","following_url":"https://api.github.com/users/Steppenwolfe65/following{/other_user}","gists_url":"https://api.github.com/users/Steppenwolfe65/gists{/gist_id}","starred_url":"https://api.github.com/users/Steppenwolfe65/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Steppenwolfe65/subscriptions","organizations_url":"https://api.github.com/users/Steppenwolfe65/orgs","repos_url":"https://api.github.com/users/Steppenwolfe65/repos","events_url":"https://api.github.com/users/Steppenwolfe65/events{/privacy}","received_events_url":"https://api.github.com/users/Steppenwolfe65/received_events","type":"User","site_admin":false},"created_at":"2017-12-20T21:54:15Z","updated_at":"2017-12-20T21:54:15Z","author_association":"NONE","body":"@dstebila Just a small update.. I started rewriting that class (just for something to do..), and the cause of the bug has become more apparent. Two, possibly three different programmers (judging by syntactical style, and the sporadic use of standard int) were involved in authoring that file. So.. someone pulled the absorb and permute functions from the Keccak distribution, and then wrote around them, in order to create compact, static implementations. \r\nThe state should not be cleared in any of the absorb functions (keccak/shake/cshake); initialization should instead be done by the caller (just about every secure coding standard I know of prohibits passing an uninitialized object into a function parameter). So that means zeroing the state where it has been declared. \r\nI'll clean this up, bring it up to Misra C standards, test the hell out of it, then push it to CEX++ (probably by the weekend), and put the link here (if you're interested), I guess you can decide if you want to use it after that ..and I totally understand if you want to use some official version instead, (but that doesn't mean you don't have to test it!), in which case in answer to your original question, yes, use the Keccak code package, it's what I used as a reference when I authored my implementations. "}},"public":true,"created_at":"2017-12-20T21:54:16Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
