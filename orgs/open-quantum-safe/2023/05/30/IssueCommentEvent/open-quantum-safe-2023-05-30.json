{"id":"29390634978","type":"IssueCommentEvent","actor":{"id":8843219,"login":"dstebila","display_login":"dstebila","gravatar_id":"","url":"https://api.github.com/users/dstebila","avatar_url":"https://avatars.githubusercontent.com/u/8843219?"},"repo":{"id":65514205,"name":"open-quantum-safe/liboqs","url":"https://api.github.com/repos/open-quantum-safe/liboqs"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/1483","repository_url":"https://api.github.com/repos/open-quantum-safe/liboqs","labels_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/1483/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/1483/comments","events_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/1483/events","html_url":"https://github.com/open-quantum-safe/liboqs/issues/1483","id":1727813623,"node_id":"I_kwDOA-eq3c5m_Ff3","number":1483,"title":"40 tests fail on ARM32 (armv7hf): AssertionError: Got unexpected return code -4","user":{"login":"vt-alt","id":36664211,"node_id":"MDQ6VXNlcjM2NjY0MjEx","avatar_url":"https://avatars.githubusercontent.com/u/36664211?v=4","gravatar_id":"","url":"https://api.github.com/users/vt-alt","html_url":"https://github.com/vt-alt","followers_url":"https://api.github.com/users/vt-alt/followers","following_url":"https://api.github.com/users/vt-alt/following{/other_user}","gists_url":"https://api.github.com/users/vt-alt/gists{/gist_id}","starred_url":"https://api.github.com/users/vt-alt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vt-alt/subscriptions","organizations_url":"https://api.github.com/users/vt-alt/orgs","repos_url":"https://api.github.com/users/vt-alt/repos","events_url":"https://api.github.com/users/vt-alt/events{/privacy}","received_events_url":"https://api.github.com/users/vt-alt/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":10,"created_at":"2023-05-26T15:13:38Z","updated_at":"2023-05-30T01:39:25Z","closed_at":null,"author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Describe the bug**\r\nI try to build `0.8.0-rc1` for ALT Linux and found that 40 tests failed on armv7hf arch.\r\n```\r\n[00:00:48] + timeout 222 /usr/bin/ninja -j32 -C build run_tests\r\n[00:00:48] ninja: Entering directory `build'\r\n[00:00:49] [0/1] cd /usr/src/RPM/BUILD/liboqs-0.8.0.rc1 && /usr/bin/cmake -E env OQS_BUILD_DIR=/usr/src/RPM/BUILD/liboqs-0.8.0.rc1/build python3 -m pytest --verbose --numprocesses=auto --ignore=scripts/copy_from_upstream/repos\r\n[00:00:55] ============================= test session starts ==============================\r\n[00:00:55] platform linux -- Python 3.10.8, pytest-7.3.1, pluggy-1.0.0 -- /usr/bin/python3\r\n[00:00:55] cachedir: .pytest_cache\r\n[00:00:55] rootdir: /usr/src/RPM/BUILD/liboqs-0.8.0.rc1\r\n[00:00:55] plugins: xdist-3.3.1\r\n[00:00:55] created: 32/32 workers\r\n[00:00:55] 32 workers [402 items]\r\n...\r\n[00:01:30] =================================== FAILURES ===================================\r\n[00:01:30] ______________________ test_kem[Classic-McEliece-348864] _______________________\r\n[00:01:30] [gw26] linux -- Python 3.10.8 /usr/bin/python3\r\n[00:01:30] \r\n[00:01:30] kem_name = 'Classic-McEliece-348864'\r\n[00:01:30] \r\n[00:01:30]     @helpers.filtered_test\r\n[00:01:30]     @pytest.mark.parametrize('kem_name', helpers.available_kems_by_name())\r\n[00:01:30]     def test_kem(kem_name):\r\n[00:01:30]         kats = helpers.get_kats(\"kem\")\r\n[00:01:30]         if not(helpers.is_kem_enabled_by_name(kem_name)): pytest.skip('Not enabled')\r\n[00:01:30] >       helpers.run_subprocess( [helpers.path_to_executable('speed_kem'), kem_name, \"-f\"] )\r\n[00:01:30] \r\n[00:01:30] tests/test_speed.py:14: \r\n[00:01:30] _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n[00:01:30] \r\n[00:01:30] command = ['/usr/src/RPM/BUILD/liboqs-0.8.0.rc1/build/tests/speed_kem', 'Classic-McEliece-348864', '-f']\r\n[00:01:30] working_dir = '.'\r\n[00:01:30] env = {'G_BROKEN_FILENAMES': '1', 'HISTFILESIZE': '9999', 'HISTSIZE': '999', 'HOME': '/usr/src', ...}\r\n[00:01:30] expected_returncode = 0, input = None, ignore_returncode = False\r\n[00:01:30] \r\n[00:01:30]     def run_subprocess(command, working_dir='.', env=None, expected_returncode=0, input=None, ignore_returncode=False):\r\n[00:01:30]         \"\"\"\r\n[00:01:30]         Helper function to run a shell command and report success/failure\r\n[00:01:30]         depending on the exit status of the shell command.\r\n[00:01:30]         \"\"\"\r\n[00:01:30]         env_ = os.environ.copy()\r\n[00:01:30]         if env is not None:\r\n[00:01:30]             env_.update(env)\r\n[00:01:30]         env = env_\r\n[00:01:30]     \r\n[00:01:30]         # Note we need to capture stdout/stderr from the subprocess,\r\n[00:01:30]         # then print it, which pytest will then capture and\r\n[00:01:30]         # buffer appropriately\r\n[00:01:30]         print(working_dir + \" > \" + \" \".join(command))\r\n[00:01:30]     \r\n[00:01:30]         result = subprocess.run(\r\n[00:01:30]                 command,\r\n[00:01:30]                 input=input,\r\n[00:01:30]                 stdout=subprocess.PIPE,\r\n[00:01:30]                 stderr=subprocess.STDOUT,\r\n[00:01:30]                 cwd=working_dir,\r\n[00:01:30]                 env=env,\r\n[00:01:30]             )\r\n[00:01:30]     \r\n[00:01:30]         if not(ignore_returncode) and (result.returncode != expected_returncode):\r\n[00:01:30]             print(result.stdout.decode('utf-8'))\r\n[00:01:30] >           assert False, \"Got unexpected return code {}\".format(result.returncode)\r\n[00:01:30] E           AssertionError: Got unexpected return code -4\r\n[00:01:30] \r\n[00:01:30] tests/helpers.py:42: AssertionError\r\n[00:01:30] ----------------------------- Captured stdout call -----------------------------\r\n[00:01:30] . > /usr/src/RPM/BUILD/liboqs-0.8.0.rc1/build/tests/speed_kem Classic-McEliece-348864 -f\r\n[00:01:30] \r\n...\r\n...\r\n[00:01:30] =========================== short test summary info ============================\r\n[00:01:30] FAILED tests/test_speed.py::test_kem[Classic-McEliece-348864] - AssertionErro...\r\n[00:01:30] FAILED tests/test_speed.py::test_kem[Classic-McEliece-348864f] - AssertionErr...\r\n[00:01:30] FAILED tests/test_speed.py::test_kem[Classic-McEliece-460896f] - AssertionErr...\r\n[00:01:30] FAILED tests/test_speed.py::test_kem[Classic-McEliece-6960119] - AssertionErr...\r\n[00:01:30] FAILED tests/test_speed.py::test_kem[Classic-McEliece-460896] - AssertionErro...\r\n[00:01:30] FAILED tests/test_speed.py::test_kem[Classic-McEliece-6688128f] - AssertionEr...\r\n[00:01:30] FAILED tests/test_speed.py::test_kem[Classic-McEliece-6960119f] - AssertionEr...\r\n[00:01:30] FAILED tests/test_speed.py::test_kem[Classic-McEliece-8192128] - AssertionErr...\r\n[00:01:30] FAILED tests/test_speed.py::test_kem[HQC-192] - AssertionError: Got unexpecte...\r\n[00:01:30] FAILED tests/test_speed.py::test_kem[HQC-128] - AssertionError: Got unexpecte...\r\n[00:01:30] FAILED tests/test_speed.py::test_kem[Classic-McEliece-8192128f] - AssertionEr...\r\n[00:01:30] FAILED tests/test_speed.py::test_kem[Kyber512] - AssertionError: Got unexpect...\r\n[00:01:30] FAILED tests/test_speed.py::test_kem[HQC-256] - AssertionError: Got unexpecte...\r\n[00:01:30] FAILED tests/test_speed.py::test_kem[Kyber768] - AssertionError: Got unexpect...\r\n[00:01:30] FAILED tests/test_speed.py::test_kem[sntrup761] - AssertionError: Got unexpec...\r\n[00:01:30] FAILED tests/test_speed.py::test_kem[FrodoKEM-640-AES] - AssertionError: Got ...\r\n[00:01:30] FAILED tests/test_speed.py::test_kem[FrodoKEM-640-SHAKE] - AssertionError: Go...\r\n[00:01:30] FAILED tests/test_speed.py::test_kem[FrodoKEM-976-AES] - AssertionError: Got ...\r\n[00:01:30] FAILED tests/test_speed.py::test_kem[FrodoKEM-1344-AES] - AssertionError: Got...\r\n[00:01:30] FAILED tests/test_speed.py::test_sig[Dilithium3] - AssertionError: Got unexpe...\r\n[00:01:30] FAILED tests/test_speed.py::test_kem[FrodoKEM-1344-SHAKE] - AssertionError: G...\r\n[00:01:30] FAILED tests/test_speed.py::test_kem[FrodoKEM-976-SHAKE] - AssertionError: Go...\r\n[00:01:30] FAILED tests/test_speed.py::test_sig[Dilithium5] - AssertionError: Got unexpe...\r\n[00:01:30] FAILED tests/test_speed.py::test_sig[Falcon-512] - AssertionError: Got unexpe...\r\n[00:01:30] FAILED tests/test_speed.py::test_sig[Dilithium2] - AssertionError: Got unexpe...\r\n[00:01:30] FAILED tests/test_speed.py::test_sig[Falcon-1024] - AssertionError: Got unexp...\r\n[00:01:30] FAILED tests/test_speed.py::test_sig[SPHINCS+-SHA2-128s-simple] - AssertionEr...\r\n[00:01:30] FAILED tests/test_speed.py::test_sig[SPHINCS+-SHA2-128f-simple] - AssertionEr...\r\n[00:01:30] FAILED tests/test_speed.py::test_sig[SPHINCS+-SHA2-192f-simple] - AssertionEr...\r\n[00:01:30] FAILED tests/test_speed.py::test_sig[SPHINCS+-SHA2-192s-simple] - AssertionEr...\r\n[00:01:30] FAILED tests/test_speed.py::test_sig[SPHINCS+-SHA2-256f-simple] - AssertionEr...\r\n[00:01:30] FAILED tests/test_speed.py::test_sig[SPHINCS+-SHA2-256s-simple] - AssertionEr...\r\n[00:01:30] FAILED tests/test_speed.py::test_sig[SPHINCS+-SHAKE-128f-simple] - AssertionE...\r\n[00:01:30] FAILED tests/test_speed.py::test_sig[SPHINCS+-SHAKE-128s-simple] - AssertionE...\r\n[00:01:30] FAILED tests/test_speed.py::test_sig[SPHINCS+-SHAKE-192f-simple] - AssertionE...\r\n[00:01:30] FAILED tests/test_speed.py::test_sig[SPHINCS+-SHAKE-256f-simple] - AssertionE...\r\n[00:01:30] FAILED tests/test_speed.py::test_sig[SPHINCS+-SHAKE-256s-simple] - AssertionE...\r\n[00:01:30] FAILED tests/test_speed.py::test_kem[Classic-McEliece-6688128] - AssertionErr...\r\n[00:01:30] FAILED tests/test_speed.py::test_kem[Kyber1024] - AssertionError: Got unexpec...\r\n[00:01:30] FAILED tests/test_speed.py::test_sig[SPHINCS+-SHAKE-192s-simple] - AssertionE...\r\n[00:01:30] ================= 40 failed, 218 passed, 144 skipped in 40.35s =================\r\n```\r\n**Environment (please complete the following information):**\r\n - OS: `ALT Linux`\r\n - OpenSSL version `1.1.1t`\r\n - Compiler version used `gcc 12.2.1`\r\n - Build variables used `-DBUILD_SHARED_LIBS=ON -DOQS_DIST_BUILD=ON -DOQS_OPT_TARGET=generic`\r\n - liboqs version `0.8.0.rc1`\r\n\r\nFull build log is temporary available there https://git.altlinux.org/tasks/321944/build/100/armh/log\r\n","reactions":{"url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/1483/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/1483/timeline","performed_via_github_app":null,"state_reason":null},"comment":{"url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/comments/1567654445","html_url":"https://github.com/open-quantum-safe/liboqs/issues/1483#issuecomment-1567654445","issue_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/1483","id":1567654445,"node_id":"IC_kwDOA-eq3c5dcIIt","user":{"login":"dstebila","id":8843219,"node_id":"MDQ6VXNlcjg4NDMyMTk=","avatar_url":"https://avatars.githubusercontent.com/u/8843219?v=4","gravatar_id":"","url":"https://api.github.com/users/dstebila","html_url":"https://github.com/dstebila","followers_url":"https://api.github.com/users/dstebila/followers","following_url":"https://api.github.com/users/dstebila/following{/other_user}","gists_url":"https://api.github.com/users/dstebila/gists{/gist_id}","starred_url":"https://api.github.com/users/dstebila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dstebila/subscriptions","organizations_url":"https://api.github.com/users/dstebila/orgs","repos_url":"https://api.github.com/users/dstebila/repos","events_url":"https://api.github.com/users/dstebila/events{/privacy}","received_events_url":"https://api.github.com/users/dstebila/received_events","type":"User","site_admin":false},"created_at":"2023-05-30T01:39:25Z","updated_at":"2023-05-30T01:39:25Z","author_association":"MEMBER","body":"I'm not sure how to characterize which platforms it is acceptable on and which aren't, so the only strategy I have would be to turn it off on all ARM32 platforms.","reactions":{"url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/comments/1567654445/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}},"public":true,"created_at":"2023-05-30T01:39:25Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
{"id":"29405563903","type":"IssueCommentEvent","actor":{"id":57787676,"login":"baentsch","display_login":"baentsch","gravatar_id":"","url":"https://api.github.com/users/baentsch","avatar_url":"https://avatars.githubusercontent.com/u/57787676?"},"repo":{"id":334511511,"name":"open-quantum-safe/oqs-provider","url":"https://api.github.com/repos/open-quantum-safe/oqs-provider"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/171","repository_url":"https://api.github.com/repos/open-quantum-safe/oqs-provider","labels_url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/171/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/171/comments","events_url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/171/events","html_url":"https://github.com/open-quantum-safe/oqs-provider/issues/171","id":1724303930,"node_id":"I_kwDOE_A9l85mxso6","number":171,"title":"MacOS: fails to find liboqs","user":{"login":"mouse07410","id":5923577,"node_id":"MDQ6VXNlcjU5MjM1Nzc=","avatar_url":"https://avatars.githubusercontent.com/u/5923577?v=4","gravatar_id":"","url":"https://api.github.com/users/mouse07410","html_url":"https://github.com/mouse07410","followers_url":"https://api.github.com/users/mouse07410/followers","following_url":"https://api.github.com/users/mouse07410/following{/other_user}","gists_url":"https://api.github.com/users/mouse07410/gists{/gist_id}","starred_url":"https://api.github.com/users/mouse07410/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mouse07410/subscriptions","organizations_url":"https://api.github.com/users/mouse07410/orgs","repos_url":"https://api.github.com/users/mouse07410/repos","events_url":"https://api.github.com/users/mouse07410/events{/privacy}","received_events_url":"https://api.github.com/users/mouse07410/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":12,"created_at":"2023-05-24T15:51:30Z","updated_at":"2023-05-30T13:57:25Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"**Describe the bug**\r\nTests should - but do not - look in `/opt/local/lib` for libraries like `liboqs.dylib`.\r\n\r\n```text\r\nLD_LIBRARY_PATH=/Users/ur20980/src/oqs-provider/.local/lib64\r\nOPENSSL_APP=/opt/local/libexec/openssl3/bin/openssl\r\nOPENSSL_CONF=/opt/local/libexec/openssl3/etc/openssl/openssl.cnf\r\nOPENSSL_MODULES=/opt/local/libexec/openssl3/lib/ossl-modules\r\nVersion information:\r\nOpenSSL 3.1.0 14 Mar 2023 (Library: OpenSSL 3.1.0 14 Mar 2023)\r\nlist: unable to load provider oqsprovider\r\nHint: use -provider-path option or OPENSSL_MODULES environment variable.\r\n40664950F87F0000:error:12800067:DSO support routines:dlfcn_load:could not load the shared library:crypto/dso/dso_dlfcn.c:118:filename(_build/lib/oqsprovider.dylib): dlopen(_build/lib/oqsprovider.dylib, 0x0002): Library not loaded: @rpath/liboqs.3.dylib\r\n  Referenced from: <DE45930A-2ABF-3032-BFF3-19F96D0064A6> /Users/ur20980/src/oqs-provider/_build/lib/oqsprovider.0.5.0-dev.dylib\r\n  Reason: tried: '/usr/local/lib/liboqs.3.dylib' (no such file), '/usr/lib/liboqs.3.dylib' (no such file, not in dyld cache)\r\n40664950F87F0000:error:12800067:DSO support routines:DSO_load:could not load the shared library:crypto/dso/dso_lib.c:152:\r\n40664950F87F0000:error:07880025:common libcrypto routines:provider_init:reason(524325):crypto/provider_core.c:904:name=oqsprovider\r\nBaseline openssl invocation failed. Exiting test.\r\n```\r\n\r\n`LD_LIBRARY_PATH` is not an answer, because (a) MacOS uses `DYLD_LIBRARY_PATH` and ignores `LD_LIBRARY_PATH`, and (b) setting that env var would limit where the loader searches for missing libraries, i.e., we'd risk that it would now find what's in `$DYLD_LIBRARY_PATH` but stops finding what's not there.\r\n\r\n**To Reproduce**\r\nSee above.\r\n\r\n**Expected behavior**\r\nTests passing, with all the relevant libraries located correctly.\r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n\r\n**Environment (please complete the following information):**\r\n - OS: MacOS Ventura 13.4\r\n - OpenSSL version: 3.2.0-dev and 3.1.0\r\n\r\n","reactions":{"url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/171/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/171/timeline","performed_via_github_app":null,"state_reason":null},"comment":{"url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/comments/1568483883","html_url":"https://github.com/open-quantum-safe/oqs-provider/issues/171#issuecomment-1568483883","issue_url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/171","id":1568483883,"node_id":"IC_kwDOE_A9l85dfSor","user":{"login":"baentsch","id":57787676,"node_id":"MDQ6VXNlcjU3Nzg3Njc2","avatar_url":"https://avatars.githubusercontent.com/u/57787676?v=4","gravatar_id":"","url":"https://api.github.com/users/baentsch","html_url":"https://github.com/baentsch","followers_url":"https://api.github.com/users/baentsch/followers","following_url":"https://api.github.com/users/baentsch/following{/other_user}","gists_url":"https://api.github.com/users/baentsch/gists{/gist_id}","starred_url":"https://api.github.com/users/baentsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/baentsch/subscriptions","organizations_url":"https://api.github.com/users/baentsch/orgs","repos_url":"https://api.github.com/users/baentsch/repos","events_url":"https://api.github.com/users/baentsch/events{/privacy}","received_events_url":"https://api.github.com/users/baentsch/received_events","type":"User","site_admin":false},"created_at":"2023-05-30T13:57:24Z","updated_at":"2023-05-30T13:57:24Z","author_association":"MEMBER","body":"Now it seems I finally have managed to set up a CI job that mirrors your setup. And it shows the same problematic behaviour: It doesn't seem to load `oqsprovider` probably because it doesn't find `liboqs`:\r\n\r\n```\r\n_build/lib/oqsprovider.dylib:\r\n\t@rpath/oqsprovider.1.dylib (compatibility version 1.0.0, current version 0.5.0)\r\n\t@rpath/liboqs.3.dylib (compatibility version 3.0.0, current version 0.8.0)\r\n\t/usr/local/opt/openssl@3/lib/libcrypto.3.dylib (compatibility version 3.0.0, current version 3.0.0)\r\n\t/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1311.0.0)\r\n```\r\n\r\nNow I have to admit I know way too little about OSX' specific shared linking behaviour and the meaning of \"@rpath\". [This](https://developer.apple.com/library/archive/documentation/DeveloperTools/Conceptual/DynamicLibraries/100-Articles/RunpathDependentLibraries.html) seems to imply that libraries built this way will use whichever \"rpath\" has been set for the loading executable, i.e., `openssl` in our case if I'm right. As we cannot control that, I'm afraid we have to disable the use of \"rpath\" in a setting such as yours (which is now also ours :-). The way to do this seems to be by way of an OSX-specific `cmake` directive: https://cmake.org/cmake/help/latest/prop_tgt/MACOSX_RPATH.html (setting to false). Agreed? Would you want to try this with your `liboqs` build script, @mouse07410 ? I'm doing this by trial-and-error via a CI VM, taking about 30mins per iteration (See #140.... :-( What beats me though, is how/why `oqsprovider.dylib` is found --- maybe OPENSSL_MODULES opens another avenue for finding/loading libraries... Would it be a possibility to put a softlink to (wherever you installed) `liboqs.dylib` next to the `oqsprovider`? Might this resolve the issue? ","reactions":{"url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/comments/1568483883/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}},"public":true,"created_at":"2023-05-30T13:57:25Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
{"id":"29417964557","type":"IssueCommentEvent","actor":{"id":5923577,"login":"mouse07410","display_login":"mouse07410","gravatar_id":"","url":"https://api.github.com/users/mouse07410","avatar_url":"https://avatars.githubusercontent.com/u/5923577?"},"repo":{"id":334511511,"name":"open-quantum-safe/oqs-provider","url":"https://api.github.com/repos/open-quantum-safe/oqs-provider"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/171","repository_url":"https://api.github.com/repos/open-quantum-safe/oqs-provider","labels_url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/171/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/171/comments","events_url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/171/events","html_url":"https://github.com/open-quantum-safe/oqs-provider/issues/171","id":1724303930,"node_id":"I_kwDOE_A9l85mxso6","number":171,"title":"MacOS: fails to find liboqs","user":{"login":"mouse07410","id":5923577,"node_id":"MDQ6VXNlcjU5MjM1Nzc=","avatar_url":"https://avatars.githubusercontent.com/u/5923577?v=4","gravatar_id":"","url":"https://api.github.com/users/mouse07410","html_url":"https://github.com/mouse07410","followers_url":"https://api.github.com/users/mouse07410/followers","following_url":"https://api.github.com/users/mouse07410/following{/other_user}","gists_url":"https://api.github.com/users/mouse07410/gists{/gist_id}","starred_url":"https://api.github.com/users/mouse07410/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mouse07410/subscriptions","organizations_url":"https://api.github.com/users/mouse07410/orgs","repos_url":"https://api.github.com/users/mouse07410/repos","events_url":"https://api.github.com/users/mouse07410/events{/privacy}","received_events_url":"https://api.github.com/users/mouse07410/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":15,"created_at":"2023-05-24T15:51:30Z","updated_at":"2023-05-30T23:36:39Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"**Describe the bug**\r\nTests should - but do not - look in `/opt/local/lib` for libraries like `liboqs.dylib`.\r\n\r\n```text\r\nLD_LIBRARY_PATH=/Users/ur20980/src/oqs-provider/.local/lib64\r\nOPENSSL_APP=/opt/local/libexec/openssl3/bin/openssl\r\nOPENSSL_CONF=/opt/local/libexec/openssl3/etc/openssl/openssl.cnf\r\nOPENSSL_MODULES=/opt/local/libexec/openssl3/lib/ossl-modules\r\nVersion information:\r\nOpenSSL 3.1.0 14 Mar 2023 (Library: OpenSSL 3.1.0 14 Mar 2023)\r\nlist: unable to load provider oqsprovider\r\nHint: use -provider-path option or OPENSSL_MODULES environment variable.\r\n40664950F87F0000:error:12800067:DSO support routines:dlfcn_load:could not load the shared library:crypto/dso/dso_dlfcn.c:118:filename(_build/lib/oqsprovider.dylib): dlopen(_build/lib/oqsprovider.dylib, 0x0002): Library not loaded: @rpath/liboqs.3.dylib\r\n  Referenced from: <DE45930A-2ABF-3032-BFF3-19F96D0064A6> /Users/ur20980/src/oqs-provider/_build/lib/oqsprovider.0.5.0-dev.dylib\r\n  Reason: tried: '/usr/local/lib/liboqs.3.dylib' (no such file), '/usr/lib/liboqs.3.dylib' (no such file, not in dyld cache)\r\n40664950F87F0000:error:12800067:DSO support routines:DSO_load:could not load the shared library:crypto/dso/dso_lib.c:152:\r\n40664950F87F0000:error:07880025:common libcrypto routines:provider_init:reason(524325):crypto/provider_core.c:904:name=oqsprovider\r\nBaseline openssl invocation failed. Exiting test.\r\n```\r\n\r\n`LD_LIBRARY_PATH` is not an answer, because (a) MacOS uses `DYLD_LIBRARY_PATH` and ignores `LD_LIBRARY_PATH`, and (b) setting that env var would limit where the loader searches for missing libraries, i.e., we'd risk that it would now find what's in `$DYLD_LIBRARY_PATH` but stops finding what's not there.\r\n\r\n**To Reproduce**\r\nSee above.\r\n\r\n**Expected behavior**\r\nTests passing, with all the relevant libraries located correctly.\r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n\r\n**Environment (please complete the following information):**\r\n - OS: MacOS Ventura 13.4\r\n - OpenSSL version: 3.2.0-dev and 3.1.0\r\n\r\n","reactions":{"url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/171/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/171/timeline","performed_via_github_app":null,"state_reason":null},"comment":{"url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/comments/1569277639","html_url":"https://github.com/open-quantum-safe/oqs-provider/issues/171#issuecomment-1569277639","issue_url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/171","id":1569277639,"node_id":"IC_kwDOE_A9l85diUbH","user":{"login":"mouse07410","id":5923577,"node_id":"MDQ6VXNlcjU5MjM1Nzc=","avatar_url":"https://avatars.githubusercontent.com/u/5923577?v=4","gravatar_id":"","url":"https://api.github.com/users/mouse07410","html_url":"https://github.com/mouse07410","followers_url":"https://api.github.com/users/mouse07410/followers","following_url":"https://api.github.com/users/mouse07410/following{/other_user}","gists_url":"https://api.github.com/users/mouse07410/gists{/gist_id}","starred_url":"https://api.github.com/users/mouse07410/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mouse07410/subscriptions","organizations_url":"https://api.github.com/users/mouse07410/orgs","repos_url":"https://api.github.com/users/mouse07410/repos","events_url":"https://api.github.com/users/mouse07410/events{/privacy}","received_events_url":"https://api.github.com/users/mouse07410/received_events","type":"User","site_admin":false},"created_at":"2023-05-30T23:36:39Z","updated_at":"2023-05-30T23:36:39Z","author_association":"NONE","body":"Sure. But my bigger concern is that `DYLD_LIBRARY_PATH` does not seem to be inherited by the `scripts/runtests.sh`. And I don't want to mess with its \"global\" value by doing something like `export DYLD_LIBRARY_PATH=/opt/local/lib:usr/local/lib:`","reactions":{"url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/comments/1569277639/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}},"public":true,"created_at":"2023-05-30T23:36:39Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
