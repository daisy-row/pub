{"id":"32611255993","type":"IssueCommentEvent","actor":{"id":57787676,"login":"baentsch","display_login":"baentsch","gravatar_id":"","url":"https://api.github.com/users/baentsch","avatar_url":"https://avatars.githubusercontent.com/u/57787676?"},"repo":{"id":334511511,"name":"open-quantum-safe/oqs-provider","url":"https://api.github.com/repos/open-quantum-safe/oqs-provider"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/282","repository_url":"https://api.github.com/repos/open-quantum-safe/oqs-provider","labels_url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/282/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/282/comments","events_url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/282/events","html_url":"https://github.com/open-quantum-safe/oqs-provider/issues/282","id":1945943658,"node_id":"I_kwDOE_A9l85z_L5q","number":282,"title":"New Cloudflare test \"kills\" other tests","user":{"login":"mouse07410","id":5923577,"node_id":"MDQ6VXNlcjU5MjM1Nzc=","avatar_url":"https://avatars.githubusercontent.com/u/5923577?v=4","gravatar_id":"","url":"https://api.github.com/users/mouse07410","html_url":"https://github.com/mouse07410","followers_url":"https://api.github.com/users/mouse07410/followers","following_url":"https://api.github.com/users/mouse07410/following{/other_user}","gists_url":"https://api.github.com/users/mouse07410/gists{/gist_id}","starred_url":"https://api.github.com/users/mouse07410/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mouse07410/subscriptions","organizations_url":"https://api.github.com/users/mouse07410/orgs","repos_url":"https://api.github.com/users/mouse07410/repos","events_url":"https://api.github.com/users/mouse07410/events{/privacy}","received_events_url":"https://api.github.com/users/mouse07410/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2023-10-16T19:31:05Z","updated_at":"2023-10-17T04:28:05Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"**Describe the bug**\r\nNewly-added \"External inter tests\" totally fail to work on machines behind a firewall and Web proxy - unfortunately bringing **all** the other tests down with them.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Clone and build this package on a machine that's behind a corporate firewall.\r\n2. Run `scripts/runtests.sh`\r\n3. See error\r\n\r\n```text\r\n.  .  .\r\n  oqsprovider\r\n    name: OpenSSL OQS Provider\r\n    version: 0.5.2-dev\r\n    status: active\r\n    build info: OQS Provider v.0.5.2-dev (a589273) based on liboqs v.0.9.0\r\n    gettable provider parameters:\r\n      name: pointer to a UTF8 encoded string (arbitrary size)\r\n      version: pointer to a UTF8 encoded string (arbitrary size)\r\n      buildinfo: pointer to a UTF8 encoded string (arbitrary size)\r\n      status: integer (arbitrary size)\r\nCert gen/verify, CMS sign/verify, CA tests for all enabled OQS signature algorithms commencing: \r\n.......................\r\nExternal interop tests commencing\r\n Cloudflare:\r\n^C\r\n```\r\n\r\n**Expected behavior**\r\n```text\r\nCert gen/verify, CMS sign/verify, CA tests for all enabled OQS signature algorithms commencing: \r\n.......................\r\nExternal interop tests commencing\r\nno, we disabled them for now, as they fail to detect Web proxy...\r\nTest project /Users/ur20980/src/oqs-provider/_build\r\n    Start 1: oqs_signatures\r\n1/5 Test #1: oqs_signatures ...................   Passed    2.57 sec\r\n    Start 2: oqs_kems\r\n2/5 Test #2: oqs_kems .........................   Passed    0.24 sec\r\n    Start 3: oqs_groups\r\n3/5 Test #3: oqs_groups .......................   Passed    0.35 sec\r\n    Start 4: oqs_tlssig\r\n4/5 Test #4: oqs_tlssig .......................   Passed    0.01 sec\r\n    Start 5: oqs_endecode\r\n5/5 Test #5: oqs_endecode .....................   Passed    4.85 sec\r\n\r\n100% tests passed, 0 tests failed out of 5\r\n\r\nTotal Test time (real) =   8.02 sec\r\n\r\nAll oqsprovider tests passed.\r\n```\r\n\r\n**Environment (please complete the following information):**\r\n - OS: MacOS Sonoma 14.0\r\n - OpenSSL version: 3.1.3\r\n - oqsprovider version: master\r\n\r\nPlease run the following commands to obtain the version information:\r\n - For OpenSSL: `openssl version` \r\n - For oqsprovider: `openssl list -providers`\r\n\r\n```sh\r\n$ openssl version\r\nOpenSSL 3.1.3 19 Sep 2023 (Library: OpenSSL 3.1.3 19 Sep 2023)\r\n$ openssl list -providers\r\nProviders:\r\n  base\r\n    name: OpenSSL Base Provider\r\n    version: 3.1.3\r\n    status: active\r\n  default\r\n    name: OpenSSL Default Provider\r\n    version: 3.1.3\r\n    status: active\r\n  legacy\r\n    name: OpenSSL Legacy Provider\r\n    version: 3.1.3\r\n    status: active\r\n  oqs\r\n    name: OpenSSL OQS Provider\r\n    version: 0.5.2-dev\r\n    status: active\r\n  pkcs11\r\n    name: PKCS#11 Provider\r\n    version: 3.1.3\r\n    status: active\r\n$ \r\n```\r\n\r\n**Additional context**\r\nAs far as I understand, the cause of the problem is that the tests, and probably OpenSSL by itself, does not recognize and deal with Web proxy, pointed at by `HTTP_PROXY=` and `HTTPS_PROXY=` env vars.\r\n\r\nIt means that either the \"External interior\" test-runs should be conditional on, e.g., absence of `HTTP_PROXY` variable, or somehow make the test correctly deal with Web proxy.\r\n","reactions":{"url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/282/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/282/timeline","performed_via_github_app":null,"state_reason":null},"comment":{"url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/comments/1765646919","html_url":"https://github.com/open-quantum-safe/oqs-provider/issues/282#issuecomment-1765646919","issue_url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/282","id":1765646919,"node_id":"IC_kwDOE_A9l85pPaJH","user":{"login":"baentsch","id":57787676,"node_id":"MDQ6VXNlcjU3Nzg3Njc2","avatar_url":"https://avatars.githubusercontent.com/u/57787676?v=4","gravatar_id":"","url":"https://api.github.com/users/baentsch","html_url":"https://github.com/baentsch","followers_url":"https://api.github.com/users/baentsch/followers","following_url":"https://api.github.com/users/baentsch/following{/other_user}","gists_url":"https://api.github.com/users/baentsch/gists{/gist_id}","starred_url":"https://api.github.com/users/baentsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/baentsch/subscriptions","organizations_url":"https://api.github.com/users/baentsch/orgs","repos_url":"https://api.github.com/users/baentsch/repos","events_url":"https://api.github.com/users/baentsch/events{/privacy}","received_events_url":"https://api.github.com/users/baentsch/received_events","type":"User","site_admin":false},"created_at":"2023-10-17T04:28:04Z","updated_at":"2023-10-17T04:28:04Z","author_association":"MEMBER","body":"> the \"External interior\" test-runs should be conditional on, e.g., absence of HTTP_PROXY variable, or somehow make the test correctly deal with Web proxy.\r\n\r\nMakes perfect sense. Easiest would be to check for presence of \"HTTP_PROXY\" env var and disable the test in such case. But disabling tests should be the last option: Could I ask you to check whether the [openssl s_client](https://www.openssl.org/docs/manmaster/man1/openssl-s_client.html) `-proxy*` command line parameter(s) could be utilized to work in your environment? I don't have such environment at my disposal to test/fix. As usual: PR very welcome!","reactions":{"url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/comments/1765646919/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}},"public":true,"created_at":"2023-10-17T04:28:05Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
{"id":"32611665634","type":"IssueCommentEvent","actor":{"id":57787676,"login":"baentsch","display_login":"baentsch","gravatar_id":"","url":"https://api.github.com/users/baentsch","avatar_url":"https://avatars.githubusercontent.com/u/57787676?"},"repo":{"id":65514205,"name":"open-quantum-safe/liboqs","url":"https://api.github.com/repos/open-quantum-safe/liboqs"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/1573","repository_url":"https://api.github.com/repos/open-quantum-safe/liboqs","labels_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/1573/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/1573/comments","events_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/1573/events","html_url":"https://github.com/open-quantum-safe/liboqs/issues/1573","id":1926239442,"node_id":"I_kwDOA-eq3c5y0BTS","number":1573,"title":"ARM build fails with `-DOQS_DIST_BUILD=OFF` on CircleCI","user":{"login":"SWilson4","id":39264796,"node_id":"MDQ6VXNlcjM5MjY0Nzk2","avatar_url":"https://avatars.githubusercontent.com/u/39264796?v=4","gravatar_id":"","url":"https://api.github.com/users/SWilson4","html_url":"https://github.com/SWilson4","followers_url":"https://api.github.com/users/SWilson4/followers","following_url":"https://api.github.com/users/SWilson4/following{/other_user}","gists_url":"https://api.github.com/users/SWilson4/gists{/gist_id}","starred_url":"https://api.github.com/users/SWilson4/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SWilson4/subscriptions","organizations_url":"https://api.github.com/users/SWilson4/orgs","repos_url":"https://api.github.com/users/SWilson4/repos","events_url":"https://api.github.com/users/SWilson4/events{/privacy}","received_events_url":"https://api.github.com/users/SWilson4/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2023-10-04T13:36:54Z","updated_at":"2023-10-17T04:57:54Z","closed_at":null,"author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Describe the bug**\r\nliboqs is failing to build on ARM with the configuration `-DOQS_DIST_BUILD=OFF`. The error occurs when `ninja` is called.\r\n\r\nOn the other hand, a build in the same environment with `-DOQS_DIST_BUILD=OFF -DOQS_OPT_TARGET=generic` succeeds.\r\n\r\n**To Reproduce**\r\nSee https://app.circleci.com/pipelines/github/open-quantum-safe/liboqs/2869/workflows/fef62d49-fe36-4118-8ea8-e520bac6d7c0/jobs/23049 for the failing build.\r\n\r\n**Expected behavior**\r\nThe build should succeed, as it did [here](https://app.circleci.com/pipelines/github/open-quantum-safe/liboqs/2869/workflows/fef62d49-fe36-4118-8ea8-e520bac6d7c0/jobs/23048) and [here](https://app.circleci.com/pipelines/github/open-quantum-safe/liboqs/2867/workflows/1ae502c5-f484-436a-a1ea-7de67cb96813/jobs/23043).\r\n\r\n(The first of the pipelines linked above failed because no tests were run, not because of a build error. That said, I'm not sure why no tests were run.)\r\n\r\n**Additional context**\r\nI used the [`arm_machine`](https://github.com/open-quantum-safe/liboqs/blob/f0326a42209491a2333d351b60474ef8fc2dc065/.circleci/config.yml#L147) template for both jobs.\r\n","reactions":{"url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/1573/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/1573/timeline","performed_via_github_app":null,"state_reason":null},"comment":{"url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/comments/1765668329","html_url":"https://github.com/open-quantum-safe/liboqs/issues/1573#issuecomment-1765668329","issue_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/1573","id":1765668329,"node_id":"IC_kwDOA-eq3c5pPfXp","user":{"login":"baentsch","id":57787676,"node_id":"MDQ6VXNlcjU3Nzg3Njc2","avatar_url":"https://avatars.githubusercontent.com/u/57787676?v=4","gravatar_id":"","url":"https://api.github.com/users/baentsch","html_url":"https://github.com/baentsch","followers_url":"https://api.github.com/users/baentsch/followers","following_url":"https://api.github.com/users/baentsch/following{/other_user}","gists_url":"https://api.github.com/users/baentsch/gists{/gist_id}","starred_url":"https://api.github.com/users/baentsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/baentsch/subscriptions","organizations_url":"https://api.github.com/users/baentsch/orgs","repos_url":"https://api.github.com/users/baentsch/repos","events_url":"https://api.github.com/users/baentsch/events{/privacy}","received_events_url":"https://api.github.com/users/baentsch/received_events","type":"User","site_admin":false},"created_at":"2023-10-17T04:57:53Z","updated_at":"2023-10-17T04:57:53Z","author_association":"MEMBER","body":"> So, the problem does indeed seem to be limited to CircleCI, as far as I can tell.\r\n\r\nIs it worthwhile tracking then? I'm personally not particularly keen spending work on a buggy CI environment. We have a [github CI job for ARM](https://github.com/open-quantum-safe/liboqs/blob/b7c623e732720fecf491beccb0a1d3fa54a1a5c1/.github/workflows/linux.yml#L119) that helps protect `liboqs` from _real_ ARM problems. The job is only for \"armhf\", though but should be extensible to \"aarch64\" (or any other ARM HW we care about).\r\n\r\nThe latter sentence actually makes me wonder: Would it make reasonable to have a (documented) list of OS/HW combinations `liboqs` promises to support (and then ensure there are CI jobs for those platforms in some CI system)?","reactions":{"url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/comments/1765668329/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}},"public":true,"created_at":"2023-10-17T04:57:54Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
{"id":"32634725505","type":"IssueCommentEvent","actor":{"id":57787676,"login":"baentsch","display_login":"baentsch","gravatar_id":"","url":"https://api.github.com/users/baentsch","avatar_url":"https://avatars.githubusercontent.com/u/57787676?"},"repo":{"id":218087071,"name":"open-quantum-safe/oqs-demos","url":"https://api.github.com/repos/open-quantum-safe/oqs-demos"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/open-quantum-safe/oqs-demos/issues/236","repository_url":"https://api.github.com/repos/open-quantum-safe/oqs-demos","labels_url":"https://api.github.com/repos/open-quantum-safe/oqs-demos/issues/236/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/oqs-demos/issues/236/comments","events_url":"https://api.github.com/repos/open-quantum-safe/oqs-demos/issues/236/events","html_url":"https://github.com/open-quantum-safe/oqs-demos/issues/236","id":1947951659,"node_id":"I_kwDODP--n850G2Ir","number":236,"title":"curl --write-out time_appconnect for SSL/TLS Handshake variable is faulty","user":{"login":"lxdgamer","id":122016821,"node_id":"U_kgDOB0XUNQ","avatar_url":"https://avatars.githubusercontent.com/u/122016821?v=4","gravatar_id":"","url":"https://api.github.com/users/lxdgamer","html_url":"https://github.com/lxdgamer","followers_url":"https://api.github.com/users/lxdgamer/followers","following_url":"https://api.github.com/users/lxdgamer/following{/other_user}","gists_url":"https://api.github.com/users/lxdgamer/gists{/gist_id}","starred_url":"https://api.github.com/users/lxdgamer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lxdgamer/subscriptions","organizations_url":"https://api.github.com/users/lxdgamer/orgs","repos_url":"https://api.github.com/users/lxdgamer/repos","events_url":"https://api.github.com/users/lxdgamer/events{/privacy}","received_events_url":"https://api.github.com/users/lxdgamer/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2023-10-17T17:53:49Z","updated_at":"2023-10-17T18:56:32Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"`--write-out` or  `-w`, outputs text and information after a transfer is completed. It offers a large range of variables that you can include in the output, variables that have been set with values and information from the transfer. \r\nAccording to [curl manuals](https://everything.curl.dev/usingcurl/verbose/writeout) `time_appconnect `variable for the TLS/SSL Handshake time.\r\nSo order should be `time_namelookup` < `time_connect` < `time_appconnect `< `time_pretransfer` < `time_starttransfer` < `time_total `\r\nFirst time I noticed this problem was when i tried to analyze the times for the [OQS Testserver](https://test.openquantumsafe.org/).\r\nFor this command:\r\n\r\n`docker run -v ``pwd``:/ca -it openquantumsafe/curl curl --cacert /ca/CA.crt https://test.openquantumsafe.org:6001 --curves bikel1 -s -w \"%{time_namelookup},%{time_connect},%{time_appconnect},%{time_pretransfer},%{time_starttransfer},%{time_total}\" -I`\r\n\r\nI get this output:\r\n\r\n`0.038224,0.238271,0.517486,0.279321,0.311949,0.312131`\r\n\r\nFirst I thought this might be some faulty implementation of the server, but i have the same issue with other websites. The normal curl version works fine.\r\nIf I missed something feel free to comment.\r\n","reactions":{"url":"https://api.github.com/repos/open-quantum-safe/oqs-demos/issues/236/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/open-quantum-safe/oqs-demos/issues/236/timeline","performed_via_github_app":null,"state_reason":null},"comment":{"url":"https://api.github.com/repos/open-quantum-safe/oqs-demos/issues/comments/1766987235","html_url":"https://github.com/open-quantum-safe/oqs-demos/issues/236#issuecomment-1766987235","issue_url":"https://api.github.com/repos/open-quantum-safe/oqs-demos/issues/236","id":1766987235,"node_id":"IC_kwDODP--n85pUhXj","user":{"login":"baentsch","id":57787676,"node_id":"MDQ6VXNlcjU3Nzg3Njc2","avatar_url":"https://avatars.githubusercontent.com/u/57787676?v=4","gravatar_id":"","url":"https://api.github.com/users/baentsch","html_url":"https://github.com/baentsch","followers_url":"https://api.github.com/users/baentsch/followers","following_url":"https://api.github.com/users/baentsch/following{/other_user}","gists_url":"https://api.github.com/users/baentsch/gists{/gist_id}","starred_url":"https://api.github.com/users/baentsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/baentsch/subscriptions","organizations_url":"https://api.github.com/users/baentsch/orgs","repos_url":"https://api.github.com/users/baentsch/repos","events_url":"https://api.github.com/users/baentsch/events{/privacy}","received_events_url":"https://api.github.com/users/baentsch/received_events","type":"User","site_admin":false},"created_at":"2023-10-17T18:56:32Z","updated_at":"2023-10-17T18:56:32Z","author_association":"MEMBER","body":"> The normal curl version works fine.\r\n\r\nHmm -- what are you referring-to as \"normal curl version\"? We did not change the curl logic in any way for the OQS integration, so can I ask you to check the behaviour of \"normal curl\" with exactly the same version as the one \"baked into\" the OQS docker image? I have the hunch that there may be something fishy in that curl version and that we should update to something more recent, so your input could help us decide which `curl` version to use in the future.","reactions":{"url":"https://api.github.com/repos/open-quantum-safe/oqs-demos/issues/comments/1766987235/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}},"public":true,"created_at":"2023-10-17T18:56:34Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
{"id":"32635879628","type":"IssueCommentEvent","actor":{"id":5923577,"login":"mouse07410","display_login":"mouse07410","gravatar_id":"","url":"https://api.github.com/users/mouse07410","avatar_url":"https://avatars.githubusercontent.com/u/5923577?"},"repo":{"id":334511511,"name":"open-quantum-safe/oqs-provider","url":"https://api.github.com/repos/open-quantum-safe/oqs-provider"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/282","repository_url":"https://api.github.com/repos/open-quantum-safe/oqs-provider","labels_url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/282/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/282/comments","events_url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/282/events","html_url":"https://github.com/open-quantum-safe/oqs-provider/issues/282","id":1945943658,"node_id":"I_kwDOE_A9l85z_L5q","number":282,"title":"New Cloudflare test \"kills\" other tests","user":{"login":"mouse07410","id":5923577,"node_id":"MDQ6VXNlcjU5MjM1Nzc=","avatar_url":"https://avatars.githubusercontent.com/u/5923577?v=4","gravatar_id":"","url":"https://api.github.com/users/mouse07410","html_url":"https://github.com/mouse07410","followers_url":"https://api.github.com/users/mouse07410/followers","following_url":"https://api.github.com/users/mouse07410/following{/other_user}","gists_url":"https://api.github.com/users/mouse07410/gists{/gist_id}","starred_url":"https://api.github.com/users/mouse07410/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mouse07410/subscriptions","organizations_url":"https://api.github.com/users/mouse07410/orgs","repos_url":"https://api.github.com/users/mouse07410/repos","events_url":"https://api.github.com/users/mouse07410/events{/privacy}","received_events_url":"https://api.github.com/users/mouse07410/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2023-10-16T19:31:05Z","updated_at":"2023-10-17T19:46:13Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"**Describe the bug**\r\nNewly-added \"External inter tests\" totally fail to work on machines behind a firewall and Web proxy - unfortunately bringing **all** the other tests down with them.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Clone and build this package on a machine that's behind a corporate firewall.\r\n2. Run `scripts/runtests.sh`\r\n3. See error\r\n\r\n```text\r\n.  .  .\r\n  oqsprovider\r\n    name: OpenSSL OQS Provider\r\n    version: 0.5.2-dev\r\n    status: active\r\n    build info: OQS Provider v.0.5.2-dev (a589273) based on liboqs v.0.9.0\r\n    gettable provider parameters:\r\n      name: pointer to a UTF8 encoded string (arbitrary size)\r\n      version: pointer to a UTF8 encoded string (arbitrary size)\r\n      buildinfo: pointer to a UTF8 encoded string (arbitrary size)\r\n      status: integer (arbitrary size)\r\nCert gen/verify, CMS sign/verify, CA tests for all enabled OQS signature algorithms commencing: \r\n.......................\r\nExternal interop tests commencing\r\n Cloudflare:\r\n^C\r\n```\r\n\r\n**Expected behavior**\r\n```text\r\nCert gen/verify, CMS sign/verify, CA tests for all enabled OQS signature algorithms commencing: \r\n.......................\r\nExternal interop tests commencing\r\nno, we disabled them for now, as they fail to detect Web proxy...\r\nTest project /Users/ur20980/src/oqs-provider/_build\r\n    Start 1: oqs_signatures\r\n1/5 Test #1: oqs_signatures ...................   Passed    2.57 sec\r\n    Start 2: oqs_kems\r\n2/5 Test #2: oqs_kems .........................   Passed    0.24 sec\r\n    Start 3: oqs_groups\r\n3/5 Test #3: oqs_groups .......................   Passed    0.35 sec\r\n    Start 4: oqs_tlssig\r\n4/5 Test #4: oqs_tlssig .......................   Passed    0.01 sec\r\n    Start 5: oqs_endecode\r\n5/5 Test #5: oqs_endecode .....................   Passed    4.85 sec\r\n\r\n100% tests passed, 0 tests failed out of 5\r\n\r\nTotal Test time (real) =   8.02 sec\r\n\r\nAll oqsprovider tests passed.\r\n```\r\n\r\n**Environment (please complete the following information):**\r\n - OS: MacOS Sonoma 14.0\r\n - OpenSSL version: 3.1.3\r\n - oqsprovider version: master\r\n\r\nPlease run the following commands to obtain the version information:\r\n - For OpenSSL: `openssl version` \r\n - For oqsprovider: `openssl list -providers`\r\n\r\n```sh\r\n$ openssl version\r\nOpenSSL 3.1.3 19 Sep 2023 (Library: OpenSSL 3.1.3 19 Sep 2023)\r\n$ openssl list -providers\r\nProviders:\r\n  base\r\n    name: OpenSSL Base Provider\r\n    version: 3.1.3\r\n    status: active\r\n  default\r\n    name: OpenSSL Default Provider\r\n    version: 3.1.3\r\n    status: active\r\n  legacy\r\n    name: OpenSSL Legacy Provider\r\n    version: 3.1.3\r\n    status: active\r\n  oqs\r\n    name: OpenSSL OQS Provider\r\n    version: 0.5.2-dev\r\n    status: active\r\n  pkcs11\r\n    name: PKCS#11 Provider\r\n    version: 3.1.3\r\n    status: active\r\n$ \r\n```\r\n\r\n**Additional context**\r\nAs far as I understand, the cause of the problem is that the tests, and probably OpenSSL by itself, does not recognize and deal with Web proxy, pointed at by `HTTP_PROXY=` and `HTTPS_PROXY=` env vars.\r\n\r\nIt means that either the \"External interior\" test-runs should be conditional on, e.g., absence of `HTTP_PROXY` variable, or somehow make the test correctly deal with Web proxy.\r\n","reactions":{"url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/282/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/282/timeline","performed_via_github_app":null,"state_reason":null},"comment":{"url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/comments/1767059968","html_url":"https://github.com/open-quantum-safe/oqs-provider/issues/282#issuecomment-1767059968","issue_url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/282","id":1767059968,"node_id":"IC_kwDOE_A9l85pUzIA","user":{"login":"mouse07410","id":5923577,"node_id":"MDQ6VXNlcjU5MjM1Nzc=","avatar_url":"https://avatars.githubusercontent.com/u/5923577?v=4","gravatar_id":"","url":"https://api.github.com/users/mouse07410","html_url":"https://github.com/mouse07410","followers_url":"https://api.github.com/users/mouse07410/followers","following_url":"https://api.github.com/users/mouse07410/following{/other_user}","gists_url":"https://api.github.com/users/mouse07410/gists{/gist_id}","starred_url":"https://api.github.com/users/mouse07410/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mouse07410/subscriptions","organizations_url":"https://api.github.com/users/mouse07410/orgs","repos_url":"https://api.github.com/users/mouse07410/repos","events_url":"https://api.github.com/users/mouse07410/events{/privacy}","received_events_url":"https://api.github.com/users/mouse07410/received_events","type":"User","site_admin":false},"created_at":"2023-10-17T19:46:12Z","updated_at":"2023-10-17T19:46:12Z","author_association":"NONE","body":"> Could I ask you to check whether the [openssl s_client](https://www.openssl.org/docs/manmaster/man1/openssl-s_client.html) `-proxy*` command line parameter(s) could be utilized to work in your environment?\r\n\r\nSure. It works - see the included patch.\r\n\r\n> As usual: PR very welcome!\r\n\r\n:-)\r\n\r\nHow about this (tested on my machines):\r\n\r\n```diff\r\ndiff --git a/scripts/oqsprovider-externalinterop.sh b/scripts/oqsprovider-externalinterop.sh\r\nindex d90dff6..fb75275 100755\r\n--- a/scripts/oqsprovider-externalinterop.sh\r\n+++ b/scripts/oqsprovider-externalinterop.sh\r\n@@ -18,9 +18,15 @@ if [ -z \"$DYLD_LIBRARY_PATH\" ]; then\r\n     export DYLD_LIBRARY_PATH=$LD_LIBRARY_PATH\r\n fi\r\n \r\n+if [ ! -z \"${HTTP_PROXY}\" ]; then\r\n+    export USE_PROXY=\"-proxy ${HTTP_PROXY#http://} -allow_proxy_certs\"\r\n+else\r\n+    export USE_PROXY=\"\"\r\n+fi\r\n+\r\n echo \" Cloudflare:\"\r\n export OQS_CODEPOINT_X25519_KYBER512=65072\r\n-(echo -e \"GET /cdn-cgi/trace HTTP/1.1\\nHost: cloudflare.com\\n\\n\"; sleep 1; echo $'\\cc') | $OPENSSL_APP s_client -connect pq.cloudflareresearch.com:443 -groups x25519_kyber768 -servername cloudflare.com -ign_eof 2>/dev/null | grep kex=X25519Kyber768Draft00\r\n-(echo -e \"GET /cdn-cgi/trace HTTP/1.1\\nHost: cloudflare.com\\n\\n\"; sleep 1; echo $'\\cc') | $OPENSSL_APP s_client -connect pq.cloudflareresearch.com:443 -groups x25519_kyber512 -servername cloudflare.com -ign_eof 2>/dev/null | grep kex=X25519Kyber512Draft00\r\n+(echo -e \"GET /cdn-cgi/trace HTTP/1.1\\nHost: cloudflare.com\\n\\n\"; sleep 1; echo $'\\cc') | \"${OPENSSL_APP}\" s_client ${USE_PROXY} -connect pq.cloudflareresearch.com:443 -groups x25519_kyber768 -servername cloudflare.com -ign_eof 2>/dev/null | grep kex=X25519Kyber768Draft00\r\n+(echo -e \"GET /cdn-cgi/trace HTTP/1.1\\nHost: cloudflare.com\\n\\n\"; sleep 1; echo $'\\cc') | \"${OPENSSL_APP}\" s_client ${USE_PROXY} -connect pq.cloudflareresearch.com:443 -groups x25519_kyber512 -servername cloudflare.com -ign_eof 2>/dev/null | grep kex=X25519Kyber512Draft00\r\n ```","reactions":{"url":"https://api.github.com/repos/open-quantum-safe/oqs-provider/issues/comments/1767059968/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}},"public":true,"created_at":"2023-10-17T19:46:13Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
