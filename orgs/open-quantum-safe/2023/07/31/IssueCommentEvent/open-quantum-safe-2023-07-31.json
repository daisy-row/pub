{"id":"30785241615","type":"IssueCommentEvent","actor":{"id":57787676,"login":"baentsch","display_login":"baentsch","gravatar_id":"","url":"https://api.github.com/users/baentsch","avatar_url":"https://avatars.githubusercontent.com/u/57787676?"},"repo":{"id":288761656,"name":"open-quantum-safe/profiling","url":"https://api.github.com/repos/open-quantum-safe/profiling"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/96","repository_url":"https://api.github.com/repos/open-quantum-safe/profiling","labels_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/96/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/96/comments","events_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/96/events","html_url":"https://github.com/open-quantum-safe/profiling/issues/96","id":1698439257,"node_id":"I_kwDOETYnOM5lPCBZ","number":96,"title":"Investigate memory use changes in handshaking","user":{"login":"baentsch","id":57787676,"node_id":"MDQ6VXNlcjU3Nzg3Njc2","avatar_url":"https://avatars.githubusercontent.com/u/57787676?v=4","gravatar_id":"","url":"https://api.github.com/users/baentsch","html_url":"https://github.com/baentsch","followers_url":"https://api.github.com/users/baentsch/followers","following_url":"https://api.github.com/users/baentsch/following{/other_user}","gists_url":"https://api.github.com/users/baentsch/gists{/gist_id}","starred_url":"https://api.github.com/users/baentsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/baentsch/subscriptions","organizations_url":"https://api.github.com/users/baentsch/orgs","repos_url":"https://api.github.com/users/baentsch/repos","events_url":"https://api.github.com/users/baentsch/events{/privacy}","received_events_url":"https://api.github.com/users/baentsch/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2023-05-06T04:31:17Z","updated_at":"2023-07-31T12:50:59Z","closed_at":null,"author_association":"MEMBER","active_lock_reason":null,"body":"With the switch to OpenSSL3+oqsprovider, heap memory use during handshaking jumped by 200-300%. Investigate and fix. Most likely culprit: https://github.com/open-quantum-safe/oqs-provider/issues/155","reactions":{"url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/96/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/96/timeline","performed_via_github_app":null,"state_reason":null},"comment":{"url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/comments/1658314652","html_url":"https://github.com/open-quantum-safe/profiling/issues/96#issuecomment-1658314652","issue_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/96","id":1658314652,"node_id":"IC_kwDOETYnOM5i19-c","user":{"login":"baentsch","id":57787676,"node_id":"MDQ6VXNlcjU3Nzg3Njc2","avatar_url":"https://avatars.githubusercontent.com/u/57787676?v=4","gravatar_id":"","url":"https://api.github.com/users/baentsch","html_url":"https://github.com/baentsch","followers_url":"https://api.github.com/users/baentsch/followers","following_url":"https://api.github.com/users/baentsch/following{/other_user}","gists_url":"https://api.github.com/users/baentsch/gists{/gist_id}","starred_url":"https://api.github.com/users/baentsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/baentsch/subscriptions","organizations_url":"https://api.github.com/users/baentsch/orgs","repos_url":"https://api.github.com/users/baentsch/repos","events_url":"https://api.github.com/users/baentsch/events{/privacy}","received_events_url":"https://api.github.com/users/baentsch/received_events","type":"User","site_admin":false},"created_at":"2023-07-31T12:50:58Z","updated_at":"2023-07-31T12:50:58Z","author_association":"MEMBER","body":"Test setup using docker image with `valgrind` installed, e.g. \"openquantumsafe/ci-ubuntu-jammy\"; build liboqs,openssl,oqsprovider, e.g., via `git clone https://github.com/open-quantum-safe/oqs-provider.git && cd oqs-provider && OPENSSL_BRANCH=master scripts/fullbuild.sh` (analog build for oqs-openssl111); setup server data (certs) to test for handshaking, e.g., via `./scripts/testrun.sh` (also checking correct functionality); then start server for specific algs, e.g., as such `OPENSSL_MODULES=lib OPENSSL_CONF=../scripts/openssl-ca.cnf LD_LIBRARY_PATH=../.local/lib/ ../.local/bin/openssl s_server -cert tmp/dilithium3_srv.crt -key tmp/dilithium3_srv.key -www -tls1_3 -groups kyber768:frodo640shake` (in \"_build\" directory); then run specific alg test (client) under `valgrind massif` control, e.g. via `OPENSSL_CONF=../scripts/openssl-ca.cnf OPENSSL_MODULES=lib LD_LIBRARY_PATH=../.local/lib valgrind --tool=massif --massif-out-file=valgrind-out ../.local/bin/openssl s_client -groups frodo640shake `; print results via `ms_print valgrind-out`","reactions":{"url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/comments/1658314652/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}},"public":true,"created_at":"2023-07-31T12:50:59Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
{"id":"30786322789","type":"IssueCommentEvent","actor":{"id":39264796,"login":"SWilson4","display_login":"SWilson4","gravatar_id":"","url":"https://api.github.com/users/SWilson4","avatar_url":"https://avatars.githubusercontent.com/u/39264796?"},"repo":{"id":288761656,"name":"open-quantum-safe/profiling","url":"https://api.github.com/repos/open-quantum-safe/profiling"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/103","repository_url":"https://api.github.com/repos/open-quantum-safe/profiling","labels_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/103/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/103/comments","events_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/103/events","html_url":"https://github.com/open-quantum-safe/profiling/issues/103","id":1802195193,"node_id":"I_kwDOETYnOM5ra1D5","number":103,"title":"Automate M1 profiling image build & use","user":{"login":"baentsch","id":57787676,"node_id":"MDQ6VXNlcjU3Nzg3Njc2","avatar_url":"https://avatars.githubusercontent.com/u/57787676?v=4","gravatar_id":"","url":"https://api.github.com/users/baentsch","html_url":"https://github.com/baentsch","followers_url":"https://api.github.com/users/baentsch/followers","following_url":"https://api.github.com/users/baentsch/following{/other_user}","gists_url":"https://api.github.com/users/baentsch/gists{/gist_id}","starred_url":"https://api.github.com/users/baentsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/baentsch/subscriptions","organizations_url":"https://api.github.com/users/baentsch/orgs","repos_url":"https://api.github.com/users/baentsch/repos","events_url":"https://api.github.com/users/baentsch/events{/privacy}","received_events_url":"https://api.github.com/users/baentsch/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2023-07-13T05:22:41Z","updated_at":"2023-07-31T13:28:04Z","closed_at":null,"author_association":"MEMBER","active_lock_reason":null,"body":"Due to the unavailability (at time of creating the tests) of M1 VMs in AWS and unlike the timed AWS-based runs for `x64` and `aarch64`, the profiling run on `m1` is currently triggered by a `cron` job on a dedicated laptop like this:\r\n\r\n    docker run --privileged openquantumsafe/oqs-perf bash -c \"cd /opt/test && ./run-tests-m1.sh\" > /Users/baentsch/profiling/docker-run-m1.log 2>&1\r\n\r\nIn particular, this means the dedicated `Dockerfile-m1` dockerfile is _not_ used for M1 profiling. This may or may not be sensible -- but at least confuses me (why do we still have this file)? If we decide to keep this file, the corresponding image should be built in CI and be used (and not the more generic `aarch64` linux image). Also, would running the code in a comparable (VM-based) manner be possible? In which infrastructure? How do we ascertain that the functionality being tested on all platforms remains in sync with the main `Dockerfile` (used for `x64`)?\r\n","reactions":{"url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/103/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/103/timeline","performed_via_github_app":null,"state_reason":null},"comment":{"url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/comments/1658373432","html_url":"https://github.com/open-quantum-safe/profiling/issues/103#issuecomment-1658373432","issue_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/103","id":1658373432,"node_id":"IC_kwDOETYnOM5i2MU4","user":{"login":"SWilson4","id":39264796,"node_id":"MDQ6VXNlcjM5MjY0Nzk2","avatar_url":"https://avatars.githubusercontent.com/u/39264796?v=4","gravatar_id":"","url":"https://api.github.com/users/SWilson4","html_url":"https://github.com/SWilson4","followers_url":"https://api.github.com/users/SWilson4/followers","following_url":"https://api.github.com/users/SWilson4/following{/other_user}","gists_url":"https://api.github.com/users/SWilson4/gists{/gist_id}","starred_url":"https://api.github.com/users/SWilson4/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SWilson4/subscriptions","organizations_url":"https://api.github.com/users/SWilson4/orgs","repos_url":"https://api.github.com/users/SWilson4/repos","events_url":"https://api.github.com/users/SWilson4/events{/privacy}","received_events_url":"https://api.github.com/users/SWilson4/received_events","type":"User","site_admin":false},"created_at":"2023-07-31T13:28:04Z","updated_at":"2023-07-31T13:28:04Z","author_association":"NONE","body":"> Just to be safe: Did you use the same \"Dockerfile-arm64\" for this? If so, that result would be expected. My original question was whether an image built for (and on) M1 (i.e., \"-DOQS_DIST_BUILD=OFF\" and not setting an architecture, i.e., using \"auto\" for M1 _on_ M1) is faster than a generic `arm64` (or \"cortex-a72\" when optimized) one (regardless of build location). In essence, the difference between using the main \"Dockerfile\" (disabling all `x64` specific code) on an M1 (i.e., what the original \"Dockerfile-m1\" did) vs. the (result of using) \"Dockerfile-arm64\".\r\n\r\nThe \"local\" runs used an image built locally from (the updated) `Dockerfile-m1`. The \"CI\" runs pulled the latest `oqs-perf` image (built in CI using `Dockerfile-arm64`). However, [the updated  M1 Dockerfile has `-DOQS_DIST_BUILD=ON`](https://github.com/open-quantum-safe/profiling/blob/e719a74606d0a43ba8298d4912f47cabf3d7a7a1/perf/Dockerfile-m1#L57), as did [the original one](https://github.com/open-quantum-safe/profiling/blame/main/perf/Dockerfile-m1#L53).","reactions":{"url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/comments/1658373432/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}},"public":true,"created_at":"2023-07-31T13:28:05Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
{"id":"30786612886","type":"IssueCommentEvent","actor":{"id":57787676,"login":"baentsch","display_login":"baentsch","gravatar_id":"","url":"https://api.github.com/users/baentsch","avatar_url":"https://avatars.githubusercontent.com/u/57787676?"},"repo":{"id":288761656,"name":"open-quantum-safe/profiling","url":"https://api.github.com/repos/open-quantum-safe/profiling"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/103","repository_url":"https://api.github.com/repos/open-quantum-safe/profiling","labels_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/103/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/103/comments","events_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/103/events","html_url":"https://github.com/open-quantum-safe/profiling/issues/103","id":1802195193,"node_id":"I_kwDOETYnOM5ra1D5","number":103,"title":"Automate M1 profiling image build & use","user":{"login":"baentsch","id":57787676,"node_id":"MDQ6VXNlcjU3Nzg3Njc2","avatar_url":"https://avatars.githubusercontent.com/u/57787676?v=4","gravatar_id":"","url":"https://api.github.com/users/baentsch","html_url":"https://github.com/baentsch","followers_url":"https://api.github.com/users/baentsch/followers","following_url":"https://api.github.com/users/baentsch/following{/other_user}","gists_url":"https://api.github.com/users/baentsch/gists{/gist_id}","starred_url":"https://api.github.com/users/baentsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/baentsch/subscriptions","organizations_url":"https://api.github.com/users/baentsch/orgs","repos_url":"https://api.github.com/users/baentsch/repos","events_url":"https://api.github.com/users/baentsch/events{/privacy}","received_events_url":"https://api.github.com/users/baentsch/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":10,"created_at":"2023-07-13T05:22:41Z","updated_at":"2023-07-31T13:37:49Z","closed_at":null,"author_association":"MEMBER","active_lock_reason":null,"body":"Due to the unavailability (at time of creating the tests) of M1 VMs in AWS and unlike the timed AWS-based runs for `x64` and `aarch64`, the profiling run on `m1` is currently triggered by a `cron` job on a dedicated laptop like this:\r\n\r\n    docker run --privileged openquantumsafe/oqs-perf bash -c \"cd /opt/test && ./run-tests-m1.sh\" > /Users/baentsch/profiling/docker-run-m1.log 2>&1\r\n\r\nIn particular, this means the dedicated `Dockerfile-m1` dockerfile is _not_ used for M1 profiling. This may or may not be sensible -- but at least confuses me (why do we still have this file)? If we decide to keep this file, the corresponding image should be built in CI and be used (and not the more generic `aarch64` linux image). Also, would running the code in a comparable (VM-based) manner be possible? In which infrastructure? How do we ascertain that the functionality being tested on all platforms remains in sync with the main `Dockerfile` (used for `x64`)?\r\n","reactions":{"url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/103/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/103/timeline","performed_via_github_app":null,"state_reason":null},"comment":{"url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/comments/1658394192","html_url":"https://github.com/open-quantum-safe/profiling/issues/103#issuecomment-1658394192","issue_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/103","id":1658394192,"node_id":"IC_kwDOETYnOM5i2RZQ","user":{"login":"baentsch","id":57787676,"node_id":"MDQ6VXNlcjU3Nzg3Njc2","avatar_url":"https://avatars.githubusercontent.com/u/57787676?v=4","gravatar_id":"","url":"https://api.github.com/users/baentsch","html_url":"https://github.com/baentsch","followers_url":"https://api.github.com/users/baentsch/followers","following_url":"https://api.github.com/users/baentsch/following{/other_user}","gists_url":"https://api.github.com/users/baentsch/gists{/gist_id}","starred_url":"https://api.github.com/users/baentsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/baentsch/subscriptions","organizations_url":"https://api.github.com/users/baentsch/orgs","repos_url":"https://api.github.com/users/baentsch/repos","events_url":"https://api.github.com/users/baentsch/events{/privacy}","received_events_url":"https://api.github.com/users/baentsch/received_events","type":"User","site_admin":false},"created_at":"2023-07-31T13:37:49Z","updated_at":"2023-07-31T13:37:49Z","author_association":"MEMBER","body":"> However, [the updated M1 Dockerfile has -DOQS_DIST_BUILD=ON](https://github.com/open-quantum-safe/profiling/blob/e719a74606d0a43ba8298d4912f47cabf3d7a7a1/perf/Dockerfile-m1#L57),\r\n\r\nThis should not make a difference on a platform with pretty much all optimizations on anyway. But just to be safe, a quick test of one alg with and without that set should suffice to finally close this out (if no serious difference emerges).","reactions":{"url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/comments/1658394192/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}},"public":true,"created_at":"2023-07-31T13:37:49Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
{"id":"30789661887","type":"IssueCommentEvent","actor":{"id":57787676,"login":"baentsch","display_login":"baentsch","gravatar_id":"","url":"https://api.github.com/users/baentsch","avatar_url":"https://avatars.githubusercontent.com/u/57787676?"},"repo":{"id":288761656,"name":"open-quantum-safe/profiling","url":"https://api.github.com/repos/open-quantum-safe/profiling"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/97","repository_url":"https://api.github.com/repos/open-quantum-safe/profiling","labels_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/97/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/97/comments","events_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/97/events","html_url":"https://github.com/open-quantum-safe/profiling/issues/97","id":1698440247,"node_id":"I_kwDOETYnOM5lPCQ3","number":97,"title":"Investigate performance drop in handshaking","user":{"login":"baentsch","id":57787676,"node_id":"MDQ6VXNlcjU3Nzg3Njc2","avatar_url":"https://avatars.githubusercontent.com/u/57787676?v=4","gravatar_id":"","url":"https://api.github.com/users/baentsch","html_url":"https://github.com/baentsch","followers_url":"https://api.github.com/users/baentsch/followers","following_url":"https://api.github.com/users/baentsch/following{/other_user}","gists_url":"https://api.github.com/users/baentsch/gists{/gist_id}","starred_url":"https://api.github.com/users/baentsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/baentsch/subscriptions","organizations_url":"https://api.github.com/users/baentsch/orgs","repos_url":"https://api.github.com/users/baentsch/repos","events_url":"https://api.github.com/users/baentsch/events{/privacy}","received_events_url":"https://api.github.com/users/baentsch/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2023-05-06T04:34:07Z","updated_at":"2023-07-31T15:19:43Z","closed_at":null,"author_association":"MEMBER","active_lock_reason":null,"body":"With the switch to oqsprovider+OpenSSL3, handshaking performance in general dropped by 20%-30%. Need to investigate how classic algorithm performance (independent of oqsprovider) and PQ alg performance changes. For this, need to fix #94 .","reactions":{"url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/97/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/97/timeline","performed_via_github_app":null,"state_reason":null},"comment":{"url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/comments/1658586851","html_url":"https://github.com/open-quantum-safe/profiling/issues/97#issuecomment-1658586851","issue_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/97","id":1658586851,"node_id":"IC_kwDOETYnOM5i3Abj","user":{"login":"baentsch","id":57787676,"node_id":"MDQ6VXNlcjU3Nzg3Njc2","avatar_url":"https://avatars.githubusercontent.com/u/57787676?v=4","gravatar_id":"","url":"https://api.github.com/users/baentsch","html_url":"https://github.com/baentsch","followers_url":"https://api.github.com/users/baentsch/followers","following_url":"https://api.github.com/users/baentsch/following{/other_user}","gists_url":"https://api.github.com/users/baentsch/gists{/gist_id}","starred_url":"https://api.github.com/users/baentsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/baentsch/subscriptions","organizations_url":"https://api.github.com/users/baentsch/orgs","repos_url":"https://api.github.com/users/baentsch/repos","events_url":"https://api.github.com/users/baentsch/events{/privacy}","received_events_url":"https://api.github.com/users/baentsch/received_events","type":"User","site_admin":false},"created_at":"2023-07-31T15:19:43Z","updated_at":"2023-07-31T15:19:43Z","author_association":"MEMBER","body":"Note to self (and others): https://github.com/open-quantum-safe/profiling/issues/96#issuecomment-1658314652 explains how to easily set up server and client side for testing (replacing `s_time` for `s_client`).","reactions":{"url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/comments/1658586851/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}},"public":true,"created_at":"2023-07-31T15:19:43Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
{"id":"30789739225","type":"IssueCommentEvent","actor":{"id":57787676,"login":"baentsch","display_login":"baentsch","gravatar_id":"","url":"https://api.github.com/users/baentsch","avatar_url":"https://avatars.githubusercontent.com/u/57787676?"},"repo":{"id":288761656,"name":"open-quantum-safe/profiling","url":"https://api.github.com/repos/open-quantum-safe/profiling"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/74","repository_url":"https://api.github.com/repos/open-quantum-safe/profiling","labels_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/74/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/74/comments","events_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/74/events","html_url":"https://github.com/open-quantum-safe/profiling/issues/74","id":1226295929,"node_id":"I_kwDOETYnOM5JF8p5","number":74,"title":"Investigate gcc-11/OpenSSL3 profiling results on M1","user":{"login":"baentsch","id":57787676,"node_id":"MDQ6VXNlcjU3Nzg3Njc2","avatar_url":"https://avatars.githubusercontent.com/u/57787676?v=4","gravatar_id":"","url":"https://api.github.com/users/baentsch","html_url":"https://github.com/baentsch","followers_url":"https://api.github.com/users/baentsch/followers","following_url":"https://api.github.com/users/baentsch/following{/other_user}","gists_url":"https://api.github.com/users/baentsch/gists{/gist_id}","starred_url":"https://api.github.com/users/baentsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/baentsch/subscriptions","organizations_url":"https://api.github.com/users/baentsch/orgs","repos_url":"https://api.github.com/users/baentsch/repos","events_url":"https://api.github.com/users/baentsch/events{/privacy}","received_events_url":"https://api.github.com/users/baentsch/received_events","type":"User","site_admin":false},"labels":[{"id":2518908883,"node_id":"MDU6TGFiZWwyNTE4OTA4ODgz","url":"https://api.github.com/repos/open-quantum-safe/profiling/labels/future%20work","name":"future work","color":"bbbbbb","default":false,"description":"not exactly urgent"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2022-05-05T07:29:46Z","updated_at":"2023-07-31T15:22:29Z","closed_at":null,"author_association":"MEMBER","active_lock_reason":null,"body":"Accidentally, profiling on M1 ran on ubuntu-22 with gcc-11 on April 26+27 and May 1+2 before reverting back to debian-bullseye using gcc-10. Below some of the surprising performance deviations:\r\n\r\n![grafik](https://user-images.githubusercontent.com/57787676/166879009-75d66217-a961-430e-a29d-5905883f5c02.png)\r\n\r\n![grafik](https://user-images.githubusercontent.com/57787676/166879083-76aa55b7-e6e1-4b62-b1c1-962ff428133a.png)\r\n\r\n![grafik](https://user-images.githubusercontent.com/57787676/166879200-75749680-67c1-4c86-b6b6-1ed53aaaf0e5.png)\r\n\r\n![grafik](https://user-images.githubusercontent.com/57787676/166879249-e17b937d-4ec3-4b1d-b01e-990d31b4a84d.png)\r\n","reactions":{"url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/74/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/74/timeline","performed_via_github_app":null,"state_reason":null},"comment":{"url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/comments/1658591377","html_url":"https://github.com/open-quantum-safe/profiling/issues/74#issuecomment-1658591377","issue_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/74","id":1658591377,"node_id":"IC_kwDOETYnOM5i3BiR","user":{"login":"baentsch","id":57787676,"node_id":"MDQ6VXNlcjU3Nzg3Njc2","avatar_url":"https://avatars.githubusercontent.com/u/57787676?v=4","gravatar_id":"","url":"https://api.github.com/users/baentsch","html_url":"https://github.com/baentsch","followers_url":"https://api.github.com/users/baentsch/followers","following_url":"https://api.github.com/users/baentsch/following{/other_user}","gists_url":"https://api.github.com/users/baentsch/gists{/gist_id}","starred_url":"https://api.github.com/users/baentsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/baentsch/subscriptions","organizations_url":"https://api.github.com/users/baentsch/orgs","repos_url":"https://api.github.com/users/baentsch/repos","events_url":"https://api.github.com/users/baentsch/events{/privacy}","received_events_url":"https://api.github.com/users/baentsch/received_events","type":"User","site_admin":false},"created_at":"2023-07-31T15:22:29Z","updated_at":"2023-07-31T15:22:29Z","author_association":"MEMBER","body":"Note to self and others: This issue is just left as a reminder that it might be worth while checking the (performance) impact of different `gcc` versions and _separately_ the impact of using different `openssl` versions as the classic crypto code provider for `liboqs` -- but not doing it at the same time as has happened --inadvertently-- here.","reactions":{"url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/comments/1658591377/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}},"public":true,"created_at":"2023-07-31T15:22:29Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
{"id":"30796798708","type":"IssueCommentEvent","actor":{"id":39264796,"login":"SWilson4","display_login":"SWilson4","gravatar_id":"","url":"https://api.github.com/users/SWilson4","avatar_url":"https://avatars.githubusercontent.com/u/39264796?"},"repo":{"id":288761656,"name":"open-quantum-safe/profiling","url":"https://api.github.com/repos/open-quantum-safe/profiling"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/103","repository_url":"https://api.github.com/repos/open-quantum-safe/profiling","labels_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/103/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/103/comments","events_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/103/events","html_url":"https://github.com/open-quantum-safe/profiling/issues/103","id":1802195193,"node_id":"I_kwDOETYnOM5ra1D5","number":103,"title":"Automate M1 profiling image build & use","user":{"login":"baentsch","id":57787676,"node_id":"MDQ6VXNlcjU3Nzg3Njc2","avatar_url":"https://avatars.githubusercontent.com/u/57787676?v=4","gravatar_id":"","url":"https://api.github.com/users/baentsch","html_url":"https://github.com/baentsch","followers_url":"https://api.github.com/users/baentsch/followers","following_url":"https://api.github.com/users/baentsch/following{/other_user}","gists_url":"https://api.github.com/users/baentsch/gists{/gist_id}","starred_url":"https://api.github.com/users/baentsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/baentsch/subscriptions","organizations_url":"https://api.github.com/users/baentsch/orgs","repos_url":"https://api.github.com/users/baentsch/repos","events_url":"https://api.github.com/users/baentsch/events{/privacy}","received_events_url":"https://api.github.com/users/baentsch/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":11,"created_at":"2023-07-13T05:22:41Z","updated_at":"2023-07-31T20:34:19Z","closed_at":null,"author_association":"MEMBER","active_lock_reason":null,"body":"Due to the unavailability (at time of creating the tests) of M1 VMs in AWS and unlike the timed AWS-based runs for `x64` and `aarch64`, the profiling run on `m1` is currently triggered by a `cron` job on a dedicated laptop like this:\r\n\r\n    docker run --privileged openquantumsafe/oqs-perf bash -c \"cd /opt/test && ./run-tests-m1.sh\" > /Users/baentsch/profiling/docker-run-m1.log 2>&1\r\n\r\nIn particular, this means the dedicated `Dockerfile-m1` dockerfile is _not_ used for M1 profiling. This may or may not be sensible -- but at least confuses me (why do we still have this file)? If we decide to keep this file, the corresponding image should be built in CI and be used (and not the more generic `aarch64` linux image). Also, would running the code in a comparable (VM-based) manner be possible? In which infrastructure? How do we ascertain that the functionality being tested on all platforms remains in sync with the main `Dockerfile` (used for `x64`)?\r\n","reactions":{"url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/103/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/103/timeline","performed_via_github_app":null,"state_reason":null},"comment":{"url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/comments/1659123689","html_url":"https://github.com/open-quantum-safe/profiling/issues/103#issuecomment-1659123689","issue_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/103","id":1659123689,"node_id":"IC_kwDOETYnOM5i5Dfp","user":{"login":"SWilson4","id":39264796,"node_id":"MDQ6VXNlcjM5MjY0Nzk2","avatar_url":"https://avatars.githubusercontent.com/u/39264796?v=4","gravatar_id":"","url":"https://api.github.com/users/SWilson4","html_url":"https://github.com/SWilson4","followers_url":"https://api.github.com/users/SWilson4/followers","following_url":"https://api.github.com/users/SWilson4/following{/other_user}","gists_url":"https://api.github.com/users/SWilson4/gists{/gist_id}","starred_url":"https://api.github.com/users/SWilson4/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SWilson4/subscriptions","organizations_url":"https://api.github.com/users/SWilson4/orgs","repos_url":"https://api.github.com/users/SWilson4/repos","events_url":"https://api.github.com/users/SWilson4/events{/privacy}","received_events_url":"https://api.github.com/users/SWilson4/received_events","type":"User","site_admin":false},"created_at":"2023-07-31T20:34:19Z","updated_at":"2023-07-31T20:34:19Z","author_association":"NONE","body":"> At a first, very limited glance, there doesn't seem to be a noticeable difference in performance, but I'll schedule some more tests to run and make a more rigorous comparison.\r\n\r\nI ran the tests six times with each of the locally built image and the remotely built image and averaged the results. There is no noticeable difference, as far as I can tell. The results were almost always within 5% of each other, with no discernible (to me) trend of one performing better than the other. I also ran the tests once locally with the `-DOQS_DIST_BUILD=OFF` flag set, and again there was no noticeable (to me) difference.\r\n\r\nThe raw data is in the `oqs-tests` bucket, in a subdirectory called `m1compare`, in case anyone wants to take a further look.","reactions":{"url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/comments/1659123689/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}},"public":true,"created_at":"2023-07-31T20:34:20Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
{"id":"30796821706","type":"IssueCommentEvent","actor":{"id":39264796,"login":"SWilson4","display_login":"SWilson4","gravatar_id":"","url":"https://api.github.com/users/SWilson4","avatar_url":"https://avatars.githubusercontent.com/u/39264796?"},"repo":{"id":288761656,"name":"open-quantum-safe/profiling","url":"https://api.github.com/repos/open-quantum-safe/profiling"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/105","repository_url":"https://api.github.com/repos/open-quantum-safe/profiling","labels_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/105/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/105/comments","events_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/105/events","html_url":"https://github.com/open-quantum-safe/profiling/pull/105","id":1814145601,"node_id":"PR_kwDOETYnOM5WAqNR","number":105,"title":"Bring M1 Dockerfile up to date","user":{"login":"SWilson4","id":39264796,"node_id":"MDQ6VXNlcjM5MjY0Nzk2","avatar_url":"https://avatars.githubusercontent.com/u/39264796?v=4","gravatar_id":"","url":"https://api.github.com/users/SWilson4","html_url":"https://github.com/SWilson4","followers_url":"https://api.github.com/users/SWilson4/followers","following_url":"https://api.github.com/users/SWilson4/following{/other_user}","gists_url":"https://api.github.com/users/SWilson4/gists{/gist_id}","starred_url":"https://api.github.com/users/SWilson4/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SWilson4/subscriptions","organizations_url":"https://api.github.com/users/SWilson4/orgs","repos_url":"https://api.github.com/users/SWilson4/repos","events_url":"https://api.github.com/users/SWilson4/events{/privacy}","received_events_url":"https://api.github.com/users/SWilson4/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2023-07-20T14:36:26Z","updated_at":"2023-07-31T20:35:28Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"draft":true,"pull_request":{"url":"https://api.github.com/repos/open-quantum-safe/profiling/pulls/105","html_url":"https://github.com/open-quantum-safe/profiling/pull/105","diff_url":"https://github.com/open-quantum-safe/profiling/pull/105.diff","patch_url":"https://github.com/open-quantum-safe/profiling/pull/105.patch","merged_at":null},"body":"As per https://github.com/open-quantum-safe/profiling/pull/104#discussion_r1268120976 and #103, we would like to run tests on our M1 machine using both the dedicated M1 Dockerfile and the ARM64 Dockerfile to determine whether it's worth keeping the former around. This PR brings `Dockerfile-m1` in sync with `Dockerfile` and `Dockerfile-arm64` and updates the CircleCI config to build and push an `oqs-perf:latest-m1` image. The bulk of the changes involve updating the M1 Dockerfile to pull `open-quantum-safe/oqs-provider` instead of `open-quantum-safe/openssl`.\r\n\r\nTwo small items of note:\r\n- I preemptively fixed the permissions issue fixed by #104 in the M1 Dockerfile. When that PR is merged, it will bring the three files in sync.\r\n- I deleted the undefined `OPENSSL_BUILD_DEFINES` variable from OpenSSL build instructions in the ARM and x86 Dockerfiles.\r\n\r\nThis is the first step to resolving #103: once this PR and #104 are merged, I'll run some tests on the M1 machine and determine whether or not it's worth keeping the extra Dockerfile around. I suspect not, as it really is essentially the same as the ARM Dockerfile, but we'll see.","reactions":{"url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/105/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/105/timeline","performed_via_github_app":null,"state_reason":null},"comment":{"url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/comments/1659125084","html_url":"https://github.com/open-quantum-safe/profiling/pull/105#issuecomment-1659125084","issue_url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/105","id":1659125084,"node_id":"IC_kwDOETYnOM5i5D1c","user":{"login":"SWilson4","id":39264796,"node_id":"MDQ6VXNlcjM5MjY0Nzk2","avatar_url":"https://avatars.githubusercontent.com/u/39264796?v=4","gravatar_id":"","url":"https://api.github.com/users/SWilson4","html_url":"https://github.com/SWilson4","followers_url":"https://api.github.com/users/SWilson4/followers","following_url":"https://api.github.com/users/SWilson4/following{/other_user}","gists_url":"https://api.github.com/users/SWilson4/gists{/gist_id}","starred_url":"https://api.github.com/users/SWilson4/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SWilson4/subscriptions","organizations_url":"https://api.github.com/users/SWilson4/orgs","repos_url":"https://api.github.com/users/SWilson4/repos","events_url":"https://api.github.com/users/SWilson4/events{/privacy}","received_events_url":"https://api.github.com/users/SWilson4/received_events","type":"User","site_admin":false},"created_at":"2023-07-31T20:35:27Z","updated_at":"2023-07-31T20:35:27Z","author_association":"NONE","body":"Closing this PR as it seems unnecessary: https://github.com/open-quantum-safe/profiling/issues/103#issuecomment-1659123689.","reactions":{"url":"https://api.github.com/repos/open-quantum-safe/profiling/issues/comments/1659125084/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}},"public":true,"created_at":"2023-07-31T20:35:28Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
