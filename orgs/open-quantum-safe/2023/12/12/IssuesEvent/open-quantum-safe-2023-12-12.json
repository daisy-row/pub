{"id":"34094587292","type":"IssuesEvent","actor":{"id":57787676,"login":"baentsch","display_login":"baentsch","gravatar_id":"","url":"https://api.github.com/users/baentsch","avatar_url":"https://avatars.githubusercontent.com/u/57787676?"},"repo":{"id":218087071,"name":"open-quantum-safe/oqs-demos","url":"https://api.github.com/repos/open-quantum-safe/oqs-demos"},"payload":{"action":"closed","issue":{"url":"https://api.github.com/repos/open-quantum-safe/oqs-demos/issues/247","repository_url":"https://api.github.com/repos/open-quantum-safe/oqs-demos","labels_url":"https://api.github.com/repos/open-quantum-safe/oqs-demos/issues/247/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/oqs-demos/issues/247/comments","events_url":"https://api.github.com/repos/open-quantum-safe/oqs-demos/issues/247/events","html_url":"https://github.com/open-quantum-safe/oqs-demos/issues/247","id":1988887852,"node_id":"I_kwDODP--n852jAUs","number":247,"title":"Failed to build oqs-nginx on Mac M1","user":{"login":"NomanNasirMinhas","id":28532113,"node_id":"MDQ6VXNlcjI4NTMyMTEz","avatar_url":"https://avatars.githubusercontent.com/u/28532113?v=4","gravatar_id":"","url":"https://api.github.com/users/NomanNasirMinhas","html_url":"https://github.com/NomanNasirMinhas","followers_url":"https://api.github.com/users/NomanNasirMinhas/followers","following_url":"https://api.github.com/users/NomanNasirMinhas/following{/other_user}","gists_url":"https://api.github.com/users/NomanNasirMinhas/gists{/gist_id}","starred_url":"https://api.github.com/users/NomanNasirMinhas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NomanNasirMinhas/subscriptions","organizations_url":"https://api.github.com/users/NomanNasirMinhas/orgs","repos_url":"https://api.github.com/users/NomanNasirMinhas/repos","events_url":"https://api.github.com/users/NomanNasirMinhas/events{/privacy}","received_events_url":"https://api.github.com/users/NomanNasirMinhas/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2023-11-11T10:45:11Z","updated_at":"2023-12-12T06:59:26Z","closed_at":"2023-12-12T06:59:26Z","author_association":"NONE","active_lock_reason":null,"body":"I am try to build oqs-demos on Mac M1 pro but both oqs-demos and httpd build are following is the trace of the my run.\r\n\r\n![Screenshot 2023-11-11 at 3 42 15â€¯PM](https://github.com/open-quantum-safe/oqs-demos/assets/28532113/84e067b2-264f-4cbd-b33f-666fed31c3dc)\r\n\r\n```\r\ndocker build -t oqs-nginx .\r\n\r\n[+] Building 196.2s (20/27)                                                                                                                                                  docker:desktop-linux\r\n => [internal] load build definition from Dockerfile                                                                                                                                         0.0s\r\n => => transferring dockerfile: 5.66kB                                                                                                                                                       0.0s\r\n => [internal] load .dockerignore                                                                                                                                                            0.0s\r\n => => transferring context: 2B                                                                                                                                                              0.0s\r\n => [internal] load metadata for docker.io/library/alpine:3.13                                                                                                                               2.3s\r\n => [auth] library/alpine:pull token for registry-1.docker.io                                                                                                                                0.0s\r\n => [internal] load build context                                                                                                                                                            0.0s\r\n => => transferring context: 3.16kB                                                                                                                                                          0.0s\r\n => CACHED [stage-1 1/8] FROM docker.io/library/alpine:3.13@sha256:469b6e04ee185740477efa44ed5bdd64a07bbdd6c7e5f5d169e540889597b911                                                          0.0s\r\n => [intermediate  2/15] RUN apk add build-base linux-headers             libtool automake autoconf cmake ninja             make             openssl openssl-dev             git wget pcre  87.7s\r\n => [stage-1 2/8] RUN apk add pcre-dev                                                                                                                                                       6.9s\r\n => [intermediate  3/15] WORKDIR /opt                                                                                                                                                        0.0s\r\n => [intermediate  4/15] RUN git clone --depth 1 --branch main https://github.com/open-quantum-safe/liboqs &&     git clone --depth 1 --branch main https://github.com/open-quantum-safe/o  28.5s\r\n => [intermediate  5/15] WORKDIR /opt/liboqs                                                                                                                                                 0.0s\r\n => [intermediate  6/15] RUN mkdir build && cd build && cmake -G\"Ninja\" -DOQS_DIST_BUILD=ON -DBUILD_SHARED_LIBS=OFF -DCMAKE_INSTALL_PREFIX=/opt/nginx .. && ninja && ninja install          11.1s\r\n => [intermediate  7/15] WORKDIR /opt/nginx-1.25.2                                                                                                                                           0.0s\r\n => [intermediate  8/15] RUN ./configure --prefix=/opt/nginx                 --with-debug                 --with-http_ssl_module --with-openssl=/opt/openssl                 --without-htt  62.4s\r\n => [intermediate  9/15] RUN mkdir -p ${OSSLDIR=}/ssl && cp /opt/openssl/apps/openssl.cnf ${OSSLDIR}/ssl/ && sed -i \"s/default = default_sect/default = default_sect\\noqsprovider = oqsprov  0.1s\r\n => [intermediate 10/15] WORKDIR /opt/oqs-provider                                                                                                                                           0.0s\r\n => [intermediate 11/15] RUN ln -s /opt/nginx/include/oqs /opt/openssl/.openssl/include && rm -rf build && cmake -DCMAKE_BUILD_TYPE=Debug -DOPENSSL_ROOT_DIR=/opt/openssl/.openssl -DCMAKE_  3.5s\r\n => [intermediate 12/15] WORKDIR /opt/nginx                                                                                                                                                  0.0s\r\n => [intermediate 13/15] RUN strip /opt/openssl/.openssl/lib/*.a /opt/openssl/.openssl/lib64/ossl-modules/oqsprovider.so /opt/nginx/sbin/* /opt/nginx/sbin/*                                 0.3s\r\n => ERROR [intermediate 14/15] RUN set -x &&     mkdir cacert &&     mkdir pki &&     openssl req -x509 -new -newkey dilithium3 -keyout CA.key -out cacert/CA.crt -nodes -subj \"/CN=oqstest  0.1s\r\n------\r\n > [intermediate 14/15] RUN set -x &&     mkdir cacert &&     mkdir pki &&     openssl req -x509 -new -newkey dilithium3 -keyout CA.key -out cacert/CA.crt -nodes -subj \"/CN=oqstest CA\" -days 365 -config /opt/openssl/.openssl/ssl/openssl.cnf &&     openssl req -new -newkey dilithium3 -keyout pki/server.key -out server.csr -nodes -subj \"/CN=oqs-nginx\" -config /opt/openssl/.openssl/ssl/openssl.cnf &&     openssl x509 -req -in server.csr -out pki/server.crt -CA cacert/CA.crt -CAkey CA.key -CAcreateserial -days 365:\r\n0.090 + mkdir cacert\r\n0.091 + mkdir pki\r\n0.091 + openssl req -x509 -new -newkey dilithium3 -keyout CA.key -out cacert/CA.crt -nodes -subj '/CN=oqstest CA' -days 365 -config /opt/openssl/.openssl/ssl/openssl.cnf\r\n0.094 Error allocating keygen context\r\n0.094 00000000:error:0308010C:digital envelope routines:inner_evp_generic_fetch:unsupported:crypto/evp/evp_fetch.c:342:Global default library context, Algorithm (dilithium3 : 0), Properties (<null>)\r\n------\r\nDockerfile:84\r\n--------------------\r\n  83 |     RUN strip ${OSSLDIR}/lib/*.a ${OSSLDIR}/lib64/ossl-modules/oqsprovider.so ${INSTALLDIR}/sbin/* ${INSTALLDIR}/sbin/*\r\n  84 | >>> RUN set -x && \\\r\n  85 | >>>     mkdir cacert && \\\r\n  86 | >>>     mkdir pki && \\\r\n  87 | >>>     openssl req -x509 -new -newkey ${SIG_ALG} -keyout CA.key -out cacert/CA.crt -nodes -subj \"/CN=oqstest CA\" -days 365 -config ${OSSLDIR}/ssl/openssl.cnf && \\\r\n  88 | >>>     openssl req -new -newkey ${SIG_ALG} -keyout pki/server.key -out server.csr -nodes -subj \"/CN=oqs-nginx\" -config ${OSSLDIR}/ssl/openssl.cnf && \\\r\n  89 | >>>     openssl x509 -req -in server.csr -out pki/server.crt -CA cacert/CA.crt -CAkey CA.key -CAcreateserial -days 365\r\n  90 |\r\n--------------------\r\nERROR: failed to solve: process \"/bin/sh -c set -x &&     mkdir cacert &&     mkdir pki &&     openssl req -x509 -new -newkey ${SIG_ALG} -keyout CA.key -out cacert/CA.crt -nodes -subj \\\"/CN=oqstest CA\\\" -days 365 -config ${OSSLDIR}/ssl/openssl.cnf &&     openssl req -new -newkey ${SIG_ALG} -keyout pki/server.key -out server.csr -nodes -subj \\\"/CN=oqs-nginx\\\" -config ${OSSLDIR}/ssl/openssl.cnf &&     openssl x509 -req -in server.csr -out pki/server.crt -CA cacert/CA.crt -CAkey CA.key -CAcreateserial -days 365\" did not complete successfully: exit code: 1\r\n```","reactions":{"url":"https://api.github.com/repos/open-quantum-safe/oqs-demos/issues/247/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/open-quantum-safe/oqs-demos/issues/247/timeline","performed_via_github_app":null,"state_reason":"completed"}},"public":true,"created_at":"2023-12-12T06:59:27Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
{"id":"34094587403","type":"IssuesEvent","actor":{"id":57787676,"login":"baentsch","display_login":"baentsch","gravatar_id":"","url":"https://api.github.com/users/baentsch","avatar_url":"https://avatars.githubusercontent.com/u/57787676?"},"repo":{"id":218087071,"name":"open-quantum-safe/oqs-demos","url":"https://api.github.com/repos/open-quantum-safe/oqs-demos"},"payload":{"action":"closed","issue":{"url":"https://api.github.com/repos/open-quantum-safe/oqs-demos/issues/248","repository_url":"https://api.github.com/repos/open-quantum-safe/oqs-demos","labels_url":"https://api.github.com/repos/open-quantum-safe/oqs-demos/issues/248/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/oqs-demos/issues/248/comments","events_url":"https://api.github.com/repos/open-quantum-safe/oqs-demos/issues/248/events","html_url":"https://github.com/open-quantum-safe/oqs-demos/issues/248","id":1988889418,"node_id":"I_kwDODP--n852jAtK","number":248,"title":"Failed to build httpd on Mac M1","user":{"login":"NomanNasirMinhas","id":28532113,"node_id":"MDQ6VXNlcjI4NTMyMTEz","avatar_url":"https://avatars.githubusercontent.com/u/28532113?v=4","gravatar_id":"","url":"https://api.github.com/users/NomanNasirMinhas","html_url":"https://github.com/NomanNasirMinhas","followers_url":"https://api.github.com/users/NomanNasirMinhas/followers","following_url":"https://api.github.com/users/NomanNasirMinhas/following{/other_user}","gists_url":"https://api.github.com/users/NomanNasirMinhas/gists{/gist_id}","starred_url":"https://api.github.com/users/NomanNasirMinhas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NomanNasirMinhas/subscriptions","organizations_url":"https://api.github.com/users/NomanNasirMinhas/orgs","repos_url":"https://api.github.com/users/NomanNasirMinhas/repos","events_url":"https://api.github.com/users/NomanNasirMinhas/events{/privacy}","received_events_url":"https://api.github.com/users/NomanNasirMinhas/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2023-11-11T10:49:55Z","updated_at":"2023-12-12T06:59:26Z","closed_at":"2023-12-12T06:59:26Z","author_association":"NONE","active_lock_reason":null,"body":"I am building httpd demo on Mac M1 Pro, but is failing with following error trace.\r\n\r\n```\r\ndocker build -t oqs-httpd-img .\r\n\r\n[+] Building 7.4s (17/33)                                                                                                                                                    docker:desktop-linux\r\n => [internal] load build definition from Dockerfile                                                                                                                                         0.0s\r\n => => transferring dockerfile: 6.39kB                                                                                                                                                       0.0s\r\n => [internal] load .dockerignore                                                                                                                                                            0.0s\r\n => => transferring context: 2B                                                                                                                                                              0.0s\r\n => [internal] load metadata for docker.io/library/alpine:3.13                                                                                                                               4.1s\r\n => [auth] library/alpine:pull token for registry-1.docker.io                                                                                                                                0.0s\r\n => [internal] load build context                                                                                                                                                            0.0s\r\n => => transferring context: 119B                                                                                                                                                            0.0s\r\n => [stage-1  1/11] FROM docker.io/library/alpine:3.13@sha256:469b6e04ee185740477efa44ed5bdd64a07bbdd6c7e5f5d169e540889597b911                                                               0.0s\r\n => CACHED [stage-1  2/11] RUN apk add pcre-dev expat-dev                                                                                                                                    0.0s\r\n => CACHED [intermediate  2/18] RUN apk add build-base linux-headers             libtool automake autoconf cmake ninja             make             git wget pcre-dev             expat-dev  0.0s\r\n => CACHED [intermediate  3/18] WORKDIR /opt                                                                                                                                                 0.0s\r\n => CACHED [intermediate  4/18] RUN git clone --depth 1 --branch main https://github.com/open-quantum-safe/liboqs &&     git clone --depth 1 --branch master https://github.com/openssl/ope  0.0s\r\n => CACHED [intermediate  5/18] WORKDIR /opt/ossl-src                                                                                                                                        0.0s\r\n => CACHED [intermediate  6/18] RUN ./config no-shared --prefix=/opt/openssl &&     make -j 2 && make install_sw install_ssldirs &&     ln -s /opt/openssl/lib64 /opt/openssl/lib;           0.0s\r\n => CACHED [intermediate  7/18] WORKDIR /opt/liboqs                                                                                                                                          0.0s\r\n => CACHED [intermediate  8/18] RUN mkdir build && cd build && cmake -G\"Ninja\" .. -DOQS_DIST_BUILD=ON -DBUILD_SHARED_LIBS=ON -DCMAKE_INSTALL_PREFIX=/opt/openssl && ninja && ninja install   0.0s\r\n => CACHED [intermediate  9/18] RUN sed -i \"s/default = default_sect/default = default_sect\\noqsprovider = oqsprovider_sect/g\" /opt/openssl/ssl/openssl.cnf && sed -i \"s/\\[default_sect\\]/\\  0.0s\r\n => CACHED [intermediate 10/18] WORKDIR /opt/oqs-provider                                                                                                                                    0.0s\r\n => ERROR [intermediate 11/18] RUN rm -rf build && cmake -DCMAKE_BUILD_TYPE=Debug -DOPENSSL_ROOT_DIR=/opt/openssl -DCMAKE_PREFIX_PATH=/opt/openssl -S . -B build && cmake --build build &&   3.2s\r\n------\r\n > [intermediate 11/18] RUN rm -rf build && cmake -DCMAKE_BUILD_TYPE=Debug -DOPENSSL_ROOT_DIR=/opt/openssl -DCMAKE_PREFIX_PATH=/opt/openssl -S . -B build && cmake --build build && cp build/lib/oqsprovider.so /opt/openssl/lib64/ossl-modules/oqsprovider.so:\r\n0.260 -- The C compiler identification is GNU 10.2.1\r\n0.271 -- Detecting C compiler ABI info\r\n0.310 -- Detecting C compiler ABI info - done\r\n0.324 -- Check for working C compiler: /usr/bin/cc - skipped\r\n0.324 -- Detecting C compile features\r\n0.325 -- Detecting C compile features - done\r\n0.326 -- Creating Debug build with OQS-Debug env vars enabled\r\n0.326 -- Build will store public keys in PKCS#8 structures\r\n0.326 -- Build will not include external encoding library for SPKI/PKCS#8\r\n0.336 -- Looking for pthread.h\r\n0.372 -- Looking for pthread.h - found\r\n0.373 -- Performing Test CMAKE_HAVE_LIBC_PTHREAD\r\n0.406 -- Performing Test CMAKE_HAVE_LIBC_PTHREAD - Success\r\n0.408 -- Found Threads: TRUE\r\n0.410 -- Found OpenSSL: /opt/openssl/lib/libcrypto.a (found suitable version \"3.3.0\", minimum required is \"3.0\")\r\n0.412 -- liboqs found: Include dir at /opt/openssl/include;/opt/openssl/include/oqs\r\n0.425 -- Building commit 4dac252 in /opt/oqs-provider\r\n0.442 -- Configuring done\r\n0.450 -- Generating done\r\n0.451 -- Build files have been written to: /opt/oqs-provider/build\r\n0.466 Scanning dependencies of target oqsprovider\r\n0.496 [  3%] Building C object oqsprov/CMakeFiles/oqsprovider.dir/oqsprov.c.o\r\n0.576 [  7%] Building C object oqsprov/CMakeFiles/oqsprovider.dir/oqsprov_capabilities.c.o\r\n0.709 [ 10%] Building C object oqsprov/CMakeFiles/oqsprovider.dir/oqsprov_keys.c.o\r\n0.827 [ 14%] Building C object oqsprov/CMakeFiles/oqsprovider.dir/oqs_kmgmt.c.o\r\n0.950 [ 17%] Building C object oqsprov/CMakeFiles/oqsprovider.dir/oqs_sig.c.o\r\n1.051 [ 21%] Building C object oqsprov/CMakeFiles/oqsprovider.dir/oqs_kem.c.o\r\n1.121 [ 25%] Building C object oqsprov/CMakeFiles/oqsprovider.dir/oqs_encode_key2any.c.o\r\n1.557 [ 28%] Building C object oqsprov/CMakeFiles/oqsprovider.dir/oqs_endecoder_common.c.o\r\n1.596 [ 32%] Building C object oqsprov/CMakeFiles/oqsprovider.dir/oqs_decode_der2key.c.o\r\n1.726 [ 35%] Building C object oqsprov/CMakeFiles/oqsprovider.dir/oqsprov_bio.c.o\r\n1.774 [ 39%] Linking C shared module ../lib/oqsprovider.so\r\n1.802 [ 39%] Built target oqsprovider\r\n1.806 Scanning dependencies of target oqs_test_groups\r\n1.817 [ 42%] Building C object test/CMakeFiles/oqs_test_groups.dir/oqs_test_groups.c.o\r\n1.903 [ 46%] Building C object test/CMakeFiles/oqs_test_groups.dir/test_common.c.o\r\n1.934 [ 50%] Building C object test/CMakeFiles/oqs_test_groups.dir/tlstest_helpers.c.o\r\n2.017 [ 53%] Linking C executable oqs_test_groups\r\n2.173 [ 53%] Built target oqs_test_groups\r\n2.176 Scanning dependencies of target oqs_test_kems\r\n2.184 [ 57%] Building C object test/CMakeFiles/oqs_test_kems.dir/oqs_test_kems.c.o\r\n2.243 [ 60%] Building C object test/CMakeFiles/oqs_test_kems.dir/test_common.c.o\r\n2.274 [ 64%] Linking C executable oqs_test_kems\r\n2.385 [ 64%] Built target oqs_test_kems\r\n2.388 Scanning dependencies of target oqs_test_tlssig\r\n2.400 [ 67%] Building C object test/CMakeFiles/oqs_test_tlssig.dir/oqs_test_tlssig.c.o\r\n2.483 [ 71%] Building C object test/CMakeFiles/oqs_test_tlssig.dir/test_common.c.o\r\n2.513 [ 75%] Building C object test/CMakeFiles/oqs_test_tlssig.dir/tlstest_helpers.c.o\r\n2.596 [ 78%] Linking C executable oqs_test_tlssig\r\n2.725 [ 78%] Built target oqs_test_tlssig\r\n2.729 Scanning dependencies of target oqs_test_endecode\r\n2.740 [ 82%] Building C object test/CMakeFiles/oqs_test_endecode.dir/oqs_test_endecode.c.o\r\n2.826 [ 85%] Building C object test/CMakeFiles/oqs_test_endecode.dir/test_common.c.o\r\n2.857 [ 89%] Linking C executable oqs_test_endecode\r\n2.966 [ 89%] Built target oqs_test_endecode\r\n2.969 Scanning dependencies of target oqs_test_signatures\r\n2.977 [ 92%] Building C object test/CMakeFiles/oqs_test_signatures.dir/oqs_test_signatures.c.o\r\n3.039 [ 96%] Building C object test/CMakeFiles/oqs_test_signatures.dir/test_common.c.o\r\n3.069 [100%] Linking C executable oqs_test_signatures\r\n3.180 [100%] Built target oqs_test_signatures\r\n3.185 cp: can't create '/opt/openssl/lib64/ossl-modules/oqsprovider.so': No such file or directory\r\n------\r\nDockerfile:81\r\n--------------------\r\n  79 |     # build oqs-provider\r\n  80 |     WORKDIR /opt/oqs-provider\r\n  81 | >>> RUN rm -rf build && cmake -DCMAKE_BUILD_TYPE=Debug -DOPENSSL_ROOT_DIR=${OPENSSL_PATH} -DCMAKE_PREFIX_PATH=${OPENSSL_PATH} -S . -B build && cmake --build build && cp build/lib/oqsprovider.so ${OPENSSL_PATH}/lib64/ossl-modules/oqsprovider.so\r\n  82 |\r\n  83 |     # build httpd\r\n--------------------\r\nERROR: failed to solve: process \"/bin/sh -c rm -rf build && cmake -DCMAKE_BUILD_TYPE=Debug -DOPENSSL_ROOT_DIR=${OPENSSL_PATH} -DCMAKE_PREFIX_PATH=${OPENSSL_PATH} -S . -B build && cmake --build build && cp build/lib/oqsprovider.so ${OPENSSL_PATH}/lib64/ossl-modules/oqsprovider.so\" did not complete successfully: exit code: 1\r\n```","reactions":{"url":"https://api.github.com/repos/open-quantum-safe/oqs-demos/issues/248/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/open-quantum-safe/oqs-demos/issues/248/timeline","performed_via_github_app":null,"state_reason":"completed"}},"public":true,"created_at":"2023-12-12T06:59:27Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
