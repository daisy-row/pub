{"id":"33002242714","type":"IssuesEvent","actor":{"id":6188943,"login":"vsoftco","display_login":"vsoftco","gravatar_id":"","url":"https://api.github.com/users/vsoftco","avatar_url":"https://avatars.githubusercontent.com/u/6188943?"},"repo":{"id":170719151,"name":"open-quantum-safe/liboqs-cpp","url":"https://api.github.com/repos/open-quantum-safe/liboqs-cpp"},"payload":{"action":"closed","issue":{"url":"https://api.github.com/repos/open-quantum-safe/liboqs-cpp/issues/12","repository_url":"https://api.github.com/repos/open-quantum-safe/liboqs-cpp","labels_url":"https://api.github.com/repos/open-quantum-safe/liboqs-cpp/issues/12/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/liboqs-cpp/issues/12/comments","events_url":"https://api.github.com/repos/open-quantum-safe/liboqs-cpp/issues/12/events","html_url":"https://github.com/open-quantum-safe/liboqs-cpp/issues/12","id":1969504590,"node_id":"I_kwDOCiz3r851ZEFO","number":12,"title":"The project doesn't install anything","user":{"login":"yurivict","id":271906,"node_id":"MDQ6VXNlcjI3MTkwNg==","avatar_url":"https://avatars.githubusercontent.com/u/271906?v=4","gravatar_id":"","url":"https://api.github.com/users/yurivict","html_url":"https://github.com/yurivict","followers_url":"https://api.github.com/users/yurivict/followers","following_url":"https://api.github.com/users/yurivict/following{/other_user}","gists_url":"https://api.github.com/users/yurivict/gists{/gist_id}","starred_url":"https://api.github.com/users/yurivict/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yurivict/subscriptions","organizations_url":"https://api.github.com/users/yurivict/orgs","repos_url":"https://api.github.com/users/yurivict/repos","events_url":"https://api.github.com/users/yurivict/events{/privacy}","received_events_url":"https://api.github.com/users/yurivict/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"vsoftco","id":6188943,"node_id":"MDQ6VXNlcjYxODg5NDM=","avatar_url":"https://avatars.githubusercontent.com/u/6188943?v=4","gravatar_id":"","url":"https://api.github.com/users/vsoftco","html_url":"https://github.com/vsoftco","followers_url":"https://api.github.com/users/vsoftco/followers","following_url":"https://api.github.com/users/vsoftco/following{/other_user}","gists_url":"https://api.github.com/users/vsoftco/gists{/gist_id}","starred_url":"https://api.github.com/users/vsoftco/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vsoftco/subscriptions","organizations_url":"https://api.github.com/users/vsoftco/orgs","repos_url":"https://api.github.com/users/vsoftco/repos","events_url":"https://api.github.com/users/vsoftco/events{/privacy}","received_events_url":"https://api.github.com/users/vsoftco/received_events","type":"User","site_admin":false},"assignees":[{"login":"vsoftco","id":6188943,"node_id":"MDQ6VXNlcjYxODg5NDM=","avatar_url":"https://avatars.githubusercontent.com/u/6188943?v=4","gravatar_id":"","url":"https://api.github.com/users/vsoftco","html_url":"https://github.com/vsoftco","followers_url":"https://api.github.com/users/vsoftco/followers","following_url":"https://api.github.com/users/vsoftco/following{/other_user}","gists_url":"https://api.github.com/users/vsoftco/gists{/gist_id}","starred_url":"https://api.github.com/users/vsoftco/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vsoftco/subscriptions","organizations_url":"https://api.github.com/users/vsoftco/orgs","repos_url":"https://api.github.com/users/vsoftco/repos","events_url":"https://api.github.com/users/vsoftco/events{/privacy}","received_events_url":"https://api.github.com/users/vsoftco/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2023-10-31T02:11:00Z","updated_at":"2023-11-01T05:09:36Z","closed_at":"2023-11-01T05:09:36Z","author_association":"NONE","active_lock_reason":null,"body":"You need to add 'install' instructions to install the headers and cmake files, if any.","reactions":{"url":"https://api.github.com/repos/open-quantum-safe/liboqs-cpp/issues/12/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/open-quantum-safe/liboqs-cpp/issues/12/timeline","performed_via_github_app":null,"state_reason":"completed"}},"public":true,"created_at":"2023-11-01T05:09:37Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
{"id":"33004748376","type":"IssuesEvent","actor":{"id":47549,"login":"ueno","display_login":"ueno","gravatar_id":"","url":"https://api.github.com/users/ueno","avatar_url":"https://avatars.githubusercontent.com/u/47549?"},"repo":{"id":65514205,"name":"open-quantum-safe/liboqs","url":"https://api.github.com/repos/open-quantum-safe/liboqs"},"payload":{"action":"opened","issue":{"url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/1599","repository_url":"https://api.github.com/repos/open-quantum-safe/liboqs","labels_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/1599/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/1599/comments","events_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/1599/events","html_url":"https://github.com/open-quantum-safe/liboqs/issues/1599","id":1971866457,"node_id":"I_kwDOA-eq3c51iEtZ","number":1599,"title":"Make low-level crypto algorithms implementation switchable","user":{"login":"ueno","id":47549,"node_id":"MDQ6VXNlcjQ3NTQ5","avatar_url":"https://avatars.githubusercontent.com/u/47549?v=4","gravatar_id":"","url":"https://api.github.com/users/ueno","html_url":"https://github.com/ueno","followers_url":"https://api.github.com/users/ueno/followers","following_url":"https://api.github.com/users/ueno/following{/other_user}","gists_url":"https://api.github.com/users/ueno/gists{/gist_id}","starred_url":"https://api.github.com/users/ueno/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ueno/subscriptions","organizations_url":"https://api.github.com/users/ueno/orgs","repos_url":"https://api.github.com/users/ueno/repos","events_url":"https://api.github.com/users/ueno/events{/privacy}","received_events_url":"https://api.github.com/users/ueno/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2023-11-01T07:40:45Z","updated_at":"2023-11-01T07:40:45Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"Currently liboqs uses OpenSSL as the default backend for low-level support algorithms, such as AES and SHA3 if the `OQS_USE_OPENSSL` build flag is `ON`; otherwise it will use the bundled implementation of those algorithms. While integrating liboqs in GnuTLS, we found neither of them optimal: it is not desirable to bring in OpenSSL as a dependency[1], while we also don't want to have the same algorithms implemented in multiple places. Therefore I would suggest providing a way to make those algorithm implementation pluggable at either compile time or runtime.\r\n\r\nMore concretely, what I have in mind is something along the following lines:\r\n\r\n* liboqs could provide a build option `OQS_COMMON_CRYPTO`, which takes a combo value, either `OPENSSL`, `DEFAULT`, or `NONE`. `OQS_COMMON_CRYPTO=OPENSSL` is the same as what `OQS_USE_OPENSSL=ON` currently does, `DEFAULT` is equivalent to `OQS_USE_OPENSSL=OFF`, and `NONE` means only a stub implementation (all functions return error) is compiled in\r\n* Consumer applications (such as oqs-provider) could register implementation of those algorithms in their favorite libraries at runtime, maybe through a new API, say `OQS_AES_register_implementation`, `OQS_SHA3_register_implementation`, etc.\r\n* To make the previous step easier, maybe liboqs could provide the default implementation as a static helper library (e.g., `liboqs_openssl.a`, `liboqs_default.a`)\r\n\r\nThis is similar to the approach taken by tpm2-tss[2].\r\n\r\n1. https://gitlab.com/gnutls/gnutls/-/merge_requests/1786#note_1611785601\r\n2. https://github.com/tpm2-software/tpm2-tss/pull/2365","reactions":{"url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/1599/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/1599/timeline","performed_via_github_app":null,"state_reason":null}},"public":true,"created_at":"2023-11-01T07:40:46Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
{"id":"33006637536","type":"IssuesEvent","actor":{"id":57787676,"login":"baentsch","display_login":"baentsch","gravatar_id":"","url":"https://api.github.com/users/baentsch","avatar_url":"https://avatars.githubusercontent.com/u/57787676?"},"repo":{"id":65514205,"name":"open-quantum-safe/liboqs","url":"https://api.github.com/repos/open-quantum-safe/liboqs"},"payload":{"action":"closed","issue":{"url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/1548","repository_url":"https://api.github.com/repos/open-quantum-safe/liboqs","labels_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/1548/labels{/name}","comments_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/1548/comments","events_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/1548/events","html_url":"https://github.com/open-quantum-safe/liboqs/issues/1548","id":1890997143,"node_id":"I_kwDOA-eq3c5wtlOX","number":1548,"title":"Keccak_(X4_)Dispatch Initialize_ptr assignment is thread unsafe","user":{"login":"zxjtan","id":32562011,"node_id":"MDQ6VXNlcjMyNTYyMDEx","avatar_url":"https://avatars.githubusercontent.com/u/32562011?v=4","gravatar_id":"","url":"https://api.github.com/users/zxjtan","html_url":"https://github.com/zxjtan","followers_url":"https://api.github.com/users/zxjtan/followers","following_url":"https://api.github.com/users/zxjtan/following{/other_user}","gists_url":"https://api.github.com/users/zxjtan/gists{/gist_id}","starred_url":"https://api.github.com/users/zxjtan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zxjtan/subscriptions","organizations_url":"https://api.github.com/users/zxjtan/orgs","repos_url":"https://api.github.com/users/zxjtan/repos","events_url":"https://api.github.com/users/zxjtan/events{/privacy}","received_events_url":"https://api.github.com/users/zxjtan/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2023-09-11T18:00:02Z","updated_at":"2023-11-01T09:09:10Z","closed_at":"2023-11-01T09:09:10Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"`Keccak_(X4_)Dispatch` `Initialize_ptr` assignment is thread unsafe due to race condition. `Keccak_Dispatch` in [xkcp_sha3.c](https://github.com/open-quantum-safe/liboqs/blob/main/src/common/sha3/xkcp_sha3.c#L42) and `Keccak_X4_Dispatch` in [xkcp_sha3x4.c](https://github.com/open-quantum-safe/liboqs/blob/main/src/common/sha3/xkcp_sha3x4.c#L36).\r\n\r\nExample execution:\r\n* Thread 0 executes Keccak_X4_Dispatch until and including [this line](https://github.com/open-quantum-safe/liboqs/blob/main/src/common/sha3/xkcp_sha3x4.c#L36), setting `Keccak_X4_Initialize_ptr = &KeccakP1600times4_InitializeAll_avx2;`. Pauses here for the rest of this example.\r\n* Thread 1 calls [`gen_matrix()`](https://github.com/open-quantum-safe/liboqs/blob/main/src/kem/kyber/pqcrystals-kyber_kyber768_avx2/indcpa.c#L173) -> [`shake128x4_inc_init()`](https://github.com/open-quantum-safe/liboqs/blob/main/src/kem/kyber/pqcrystals-kyber_kyber768_avx2/indcpa.c#L245) -> [`keccak_x4_inc_reset()`](https://github.com/open-quantum-safe/liboqs/blob/main/src/common/sha3/xkcp_sha3x4.c#L166) -> [`(*Keccak_X4_Initialize_ptr)()`](https://github.com/open-quantum-safe/liboqs/blob/main/src/common/sha3/xkcp_sha3x4.c#L67).\r\n  * Here, `Keccak_X4_Initialize_ptr` is [`&KeccakP1600times4_InitializeAll_avx2`](https://github.com/open-quantum-safe/liboqs/blob/main/src/common/sha3/xkcp_low/KeccakP-1600times4/avx2/KeccakP-1600-times4-SIMD256.c#L108), which just `memset`s without issue and returns.\r\n* Thread 1 goes back up to `gen_matrix()`, next line is to call [`shake128x4_absorb_once()`](https://github.com/open-quantum-safe/liboqs/blob/main/src/kem/kyber/pqcrystals-kyber_kyber768_avx2/indcpa.c#L246) -> [`shake128x4_inc_absorb()`](https://github.com/open-quantum-safe/liboqs/blob/main/src/common/pqclean_shims/fips202x4.c#L7), which is a [macro](https://github.com/open-quantum-safe/liboqs/blob/main/src/common/pqclean_shims/fips202x4.h#L20) for [`OQS_SHA3_shake128_x4_inc_absorb`](https://github.com/open-quantum-safe/liboqs/blob/main/src/common/sha3/xkcp_sha3x4.c#L169) and a tail call for [`keccak_x4_inc_absorb()`](https://github.com/open-quantum-safe/liboqs/blob/main/src/common/sha3/xkcp_sha3x4.c#L170), which tries to call [`(*Keccak_X4_AddBytes_ptr)()`](https://github.com/open-quantum-safe/liboqs/blob/main/src/common/sha3/xkcp_sha3x4.c#L102).\r\n  * `Keccak_X4_AddBytes_ptr` is still `NULL` because Thread 0 paused before setting it! Hence, calls 0x0 and segfaults.\r\n\r\nMade a fix using `pthread_once` in #1549 but not cross-platform, open to other fixes\r\n\r\n**Environment:**\r\n - OS: CentOS Stream 9 \r\n - OpenSSL 1.1.1\r\n - Clang 12\r\n - liboqs version 0.8.0","reactions":{"url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/1548/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/open-quantum-safe/liboqs/issues/1548/timeline","performed_via_github_app":null,"state_reason":"completed"}},"public":true,"created_at":"2023-11-01T09:09:11Z","org":{"id":20689385,"login":"open-quantum-safe","gravatar_id":"","url":"https://api.github.com/orgs/open-quantum-safe","avatar_url":"https://avatars.githubusercontent.com/u/20689385?"}}
